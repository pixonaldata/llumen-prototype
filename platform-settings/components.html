<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Components - Platform Settings - Crimson</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div id="crimson-app" class="bg-gray-900">
        <header class="bg-gray-800 py-4 px-4 md:px-8 flex items-center justify-between shadow-lg sticky top-0 z-30">
            <!-- Left-aligned group: Logo, divider, client logo, and navigation -->
            <div class="flex items-center">
                <div class="w-8 h-8 flex items-center justify-center rounded-md overflow-hidden">
                    <svg viewBox="0 0 32 32" class="w-full h-full">
                        <circle cx="16" cy="16" r="16" fill="#dc2626" /> <circle cx="16" cy="16" r="8" fill="#ffffff" /> </svg>
                </div>
                <div class="h-6 border-l border-gray-600 ml-4"></div>
                <div class="flex items-center justify-center px-3 py-1 rounded-md bg-[#1a1a1a] text-white text-sm font-semibold h-8 ml-4">
                    <span>Client Logo</span>
                </div>
                <nav class="flex items-center ml-4">
                    <a href="../index.html" class="px-3 py-2 rounded-md text-sm text-gray-400 hover:text-white transition duration-200">My Workspaces</a>
                    <a href="../explore.html" class="px-3 py-2 rounded-md text-sm text-gray-400 hover:text-white transition duration-200">Explore</a>
                </nav>
            </div>

            <!-- Right-aligned group of icons and user dropdown -->
            <div class="flex items-center">
                <!-- Search container -->
                <div id="search-container" class="relative flex items-center">
                    <button id="search-icon-button" class="text-gray-300 hover:text-red-400 p-2 rounded-full transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-red-500 z-10">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                    <div id="search-input-wrapper" class="absolute right-0 flex items-center bg-gray-700 rounded-full overflow-hidden transition-all duration-300 ease-in-out">
                        <svg class="w-5 h-5 text-gray-400 ml-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input type="text" id="header-search-input" placeholder="Search..." class="bg-transparent text-white pl-2 pr-4 py-2 w-full focus:outline-none placeholder-gray-400 text-sm">
                    </div>
                </div>

                <!-- Notification Icon Button -->
                <button class="text-gray-300 hover:text-red-400 p-2 rounded-full transition duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 ml-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                </button>
                
                <!-- User Dropdown -->
                <div class="relative ml-4">
                    <button id="user-dropdown-button" class="flex items-center text-gray-300 hover:text-red-400 transition duration-200 focus:outline-none">
                        <img src="https://placehold.co/32x32/555/fff?text=J" alt="User Avatar" class="rounded-full">
                    </button>
                    <div id="user-dropdown-menu" class="absolute right-0 mt-2 w-48 rounded-md shadow-lg hidden options-dropdown-menu">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Account Settings</a>
                        <a href="overview.html" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Platform Settings</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Help</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Layout with Sidebar and Content -->
        <div class="flex flex-1">
            <!-- Vertical Sidebar Navigation -->
            <aside class="w-56 bg-gray-800 border-r border-gray-700 sidebar-nav">
                <div class="px-4 py-5">
                    <h1 class="text-xl font-bold text-white mb-5">Platform Settings</h1>
                    
                    <!-- Navigation Menu -->
                    <nav class="space-y-3">
                        <a href="overview.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200 mb-0">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">admin_panel_settings</span>
                                Overview
                            </div>
                        </a>
                        
                        <a href="components.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200 active">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">grid_view</span>
                                Components
                            </div>
                        </a>
                        
                        <a href="filters.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">filter_list</span>
                                Filters
                            </div>
                        </a>
                        
                        <a href="ai-models.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">auto_awesome</span>
                                AI Models
                            </div>
                        </a>

                        <a href="data-sources.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">storage</span>
                                Data Sources
                            </div>
                        </a>
                        
                        <a href="workspaces.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">workspaces</span>
                                Workspaces
                            </div>
                        </a>
                        
                        <a href="users.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">group</span>
                                Users
                            </div>
                        </a>
                        
                        <a href="security.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">security</span>
                                Security
                            </div>
                        </a>
                        
                        <a href="reporting.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">analytics</span>
                                Reporting
                            </div>
                        </a>
                        
                        <a href="billing.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">receipt_long</span>
                                Billing
                            </div>
                        </a>
                        
                        <a href="theme.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">palette</span>
                                Theme
                            </div>
                        </a>
                            
                        <a href="organization.html" class="platform-nav-item w-full text-left px-4 py-2 text-sm text-gray-300 hover:text-white transition duration-200">
                            <div class="flex items-center">
                                <span class="material-symbols-outlined mr-3 text-lg">business</span>
                                Organization
                            </div>
                        </a>
                    </nav>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1 main-content-area">
                <!-- Components Tab Content -->
                <div id="components-content" class="tab-content" style="height: calc(100vh - 72px);">
                    <div class="flex w-full">
                        <!-- Main Content Area -->
                        <div class="flex-1 min-w-0 flex justify-center" style="margin-right: 256px;">
                            <div class="p-10 max-w-7xl w-full">
                                <h2 class="text-2xl font-bold text-white mb-5">Component Management</h2>
                                
                                <!-- Component Table -->
                                <div class="bg-gray-800 rounded-lg overflow-hidden">
                                    <div class="px-6 py-4 border-b border-gray-700">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <button id="create-component-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md transition duration-200 text-sm flex items-center">
                                                    <span class="material-symbols-outlined mr-1" style="font-size: 20px;">add</span>
                                                    Create Component
                                                </button>
                                            </div>
                                            <div class="flex items-center">
                                                <div class="relative">
                                                    <input type="text" id="components-search-input" placeholder="Search components..." class="bg-gray-700 text-white rounded-md p-2 pl-3 focus:outline-none focus:ring-2 focus:ring-red-500 w-64 text-sm" style="padding-right: 5rem;" />
                                                    <button id="components-search-clear" type="button" class="absolute right-11 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200 focus:outline-none" style="display: none;" data-tooltip="Clear Search">
                                                        <span class="material-symbols-outlined" style="font-size: 24px;">close</span>
                                                    </button>
                                                    <span class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">search</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Filters Row -->
                                    <div class="px-6 py-4 border-b border-gray-700">
                                        <div class="flex flex-wrap gap-4 justify-between">
                                            <div class="flex flex-wrap gap-4">
                                                <!-- Category Filter -->
                                                <div class="relative">
                                                    <button id="category-filter-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md transition duration-200 text-sm flex items-center">
                                                        <span class="mr-1">Category</span>
                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                        <span id="category-clear-btn" class="ml-2 text-red-400 hover:text-red-300 transition duration-200 hidden cursor-pointer flex items-center" title="Clear Category Filter">
                                                            <span class="material-symbols-outlined" style="font-size: 18px;">cancel</span>
                                                        </span>
                                                    </button>
                                                    <div id="category-filter-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48">
                                                        <div class="p-2">
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Sales" class="mr-2"> Sales
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Marketing" class="mr-2"> Marketing
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Finance" class="mr-2"> Finance
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Operations" class="mr-2"> Operations
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="HR" class="mr-2"> HR
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="IT" class="mr-2"> IT
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Type Filter -->
                                                <div class="relative">
                                                    <button id="type-filter-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md transition duration-200 text-sm flex items-center">
                                                        <span class="mr-1">Type</span>
                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                        <span id="type-clear-btn" class="ml-2 text-red-400 hover:text-red-300 transition duration-200 hidden cursor-pointer flex items-center" title="Clear Type Filter">
                                                            <span class="material-symbols-outlined" style="font-size: 18px;">cancel</span>
                                                        </span>
                                                    </button>
                                                    <div id="type-filter-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48">
                                                        <div class="p-2">
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Chart" class="mr-2"> Chart
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="KPI" class="mr-2"> KPI
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Map" class="mr-2"> Map
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Status Filter -->
                                                <div class="relative">
                                                    <button id="component-status-filter-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded-md transition duration-200 text-sm flex items-center">
                                                        <span class="mr-1">Status</span>
                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                        <span id="component-status-clear-btn" class="ml-2 text-red-400 hover:text-red-300 transition duration-200 hidden cursor-pointer flex items-center" title="Clear Status Filter">
                                                            <span class="material-symbols-outlined" style="font-size: 18px;">cancel</span>
                                                        </span>
                                                    </button>
                                                    <div id="component-status-filter-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48">
                                                        <div class="p-2">
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Active" class="mr-2"> Active
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Pending Review" class="mr-2"> Pending Review
                                                            </label>
                                                            <label class="flex items-center px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer">
                                                                <input type="checkbox" value="Archived" class="mr-2"> Archived
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Clear All Filters Button -->
                                            <button id="clear-all-component-filters-btn" class="text-red-400 hover:text-red-300 transition duration-200 text-sm flex items-center hidden">
                                                <span class="material-symbols-outlined mr-1 text-sm">clear_all</span>
                                                Clear All Filters
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="overflow-x-auto">
                                        <table id="components-table" class="w-full">
                                            <thead class="border-b border-gray-700">
                                                <tr>
                                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-300 tracking-wider">Component</th>
                                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-300 tracking-wider">Category</th>
                                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-300 tracking-wider">Type</th>
                                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-300 tracking-wider">Status</th>
                                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-300 tracking-wider">Last Updated</th>
                                                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-300 tracking-wider w-1"></th>
                                                </tr>
                                            </thead>
                                            <tbody class="bg-gray-800 divide-y divide-gray-700">
                                                <tr class="hover:bg-gray-700 transition duration-200 cursor-pointer">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-10 w-10 rounded-md bg-gray-600 flex items-center justify-center">
                                                                <span class="text-white font-semibold text-sm">SG</span>
                                                            </div>
                                                            <div class="ml-4">
                                                                <div class="text-sm font-medium text-white">Sales Growth</div>
                                                                <div class="text-sm text-gray-400">sales-growth-v1</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Sales</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Chart</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300">Active</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                                        2 hours ago
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div class="relative">
                                                            <button class="options-dropdown-button text-gray-400 hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400" onclick="event.stopPropagation(); toggleDropdown('component-dropdown-1')">
                                                                <span class="material-symbols-outlined text-lg">more_vert</span>
                                                            </button>
                                                            <div id="component-dropdown-1" class="options-dropdown-menu absolute right-0 mt-2 w-50 rounded-md shadow-lg hidden">
                                                                <a href="#" class="edit-component-link block px-4 py-2 text-sm text-gray-200 transition duration-150">Edit Component</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Duplicate</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Export</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-red-400 transition duration-150">Delete Component</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="hover:bg-gray-700 transition duration-200 cursor-pointer">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-10 w-10 rounded-md bg-gray-600 flex items-center justify-center">
                                                                <span class="text-white font-semibold text-sm">ST</span>
                                                            </div>
                                                            <div class="ml-4">
                                                                <div class="text-sm font-medium text-white">Sales Team Performance</div>
                                                                <div class="text-sm text-gray-400">sales-team-perf-v2</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Sales</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Chart</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300">Active</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                                        1 day ago
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div class="relative">
                                                            <button class="options-dropdown-button text-gray-400 hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400" onclick="event.stopPropagation(); toggleDropdown('component-dropdown-2')">
                                                                <span class="material-symbols-outlined text-lg">more_vert</span>
                                                            </button>
                                                            <div id="component-dropdown-2" class="options-dropdown-menu absolute right-0 mt-2 w-50 rounded-md shadow-lg hidden">
                                                                <a href="#" class="edit-component-link block px-4 py-2 text-sm text-gray-200 transition duration-150">Edit Component</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Duplicate</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Export</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-red-400 transition duration-150">Delete Component</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="hover:bg-gray-700 transition duration-200 cursor-pointer">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-10 w-10 rounded-md bg-gray-600 flex items-center justify-center">
                                                                <span class="text-white font-semibold text-sm">LQ</span>
                                                            </div>
                                                            <div class="ml-4">
                                                                <div class="text-sm font-medium text-white">Lead Quality Metrics</div>
                                                                <div class="text-sm text-gray-400">lead-quality-v1</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Sales</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">KPI</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-900 text-yellow-300">Pending Review</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                                        3 days ago
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div class="relative">
                                                            <button class="options-dropdown-button text-gray-400 hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400" onclick="event.stopPropagation(); toggleDropdown('component-dropdown-3')">
                                                                <span class="material-symbols-outlined text-lg">more_vert</span>
                                                            </button>
                                                            <div id="component-dropdown-3" class="options-dropdown-menu absolute right-0 mt-2 w-50 rounded-md shadow-lg hidden">
                                                                <a href="#" class="edit-component-link block px-4 py-2 text-sm text-gray-200 transition duration-150">Edit Component</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Duplicate</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Export</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-red-400 transition duration-150">Delete Component</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="hover:bg-gray-700 transition duration-200 cursor-pointer">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-10 w-10 rounded-md bg-gray-600 flex items-center justify-center">
                                                                <span class="text-white font-semibold text-sm">CP</span>
                                                            </div>
                                                            <div class="ml-4">
                                                                <div class="text-sm font-medium text-white">Campaign Performance</div>
                                                                <div class="text-sm text-gray-400">campaign-perf-v1</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Marketing</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">KPI</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300">Active</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                                        5 hours ago
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div class="relative">
                                                            <button class="options-dropdown-button text-gray-400 hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400" onclick="event.stopPropagation(); toggleDropdown('component-dropdown-4')">
                                                                <span class="material-symbols-outlined text-lg">more_vert</span>
                                                            </button>
                                                            <div id="component-dropdown-4" class="options-dropdown-menu absolute right-0 mt-2 w-50 rounded-md shadow-lg hidden">
                                                                <a href="#" class="edit-component-link block px-4 py-2 text-sm text-gray-200 transition duration-150">Edit Component</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Duplicate</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Export</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-red-400 transition duration-150">Delete Component</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="hover:bg-gray-700 transition duration-200 cursor-pointer">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-10 w-10 rounded-md bg-gray-600 flex items-center justify-center">
                                                                <span class="text-white font-semibold text-sm">EM</span>
                                                            </div>
                                                            <div class="ml-4">
                                                                <div class="text-sm font-medium text-white">Email Marketing Analytics</div>
                                                                <div class="text-sm text-gray-400">email-marketing-v2</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Marketing</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Chart</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-900 text-gray-300">Archived</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                                        1 week ago
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div class="relative">
                                                            <button class="options-dropdown-button text-gray-400 hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400" onclick="event.stopPropagation(); toggleDropdown('component-dropdown-5')">
                                                                <span class="material-symbols-outlined text-lg">more_vert</span>
                                                            </button>
                                                            <div id="component-dropdown-5" class="options-dropdown-menu absolute right-0 mt-2 w-50 rounded-md shadow-lg hidden">
                                                                <a href="#" class="edit-component-link block px-4 py-2 text-sm text-gray-200 transition duration-150">Edit Component</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Duplicate</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Export</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-red-400 transition duration-150">Delete Component</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="hover:bg-gray-700 transition duration-200 cursor-pointer">
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <div class="flex items-center">
                                                            <div class="h-10 w-10 rounded-md bg-gray-600 flex items-center justify-center">
                                                                <span class="text-white font-semibold text-sm">GM</span>
                                                            </div>
                                                            <div class="ml-4">
                                                                <div class="text-sm font-medium text-white">Geographic Market Analysis</div>
                                                                <div class="text-sm text-gray-400">geo-market-v1</div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Sales</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="text-sm text-gray-300">Map</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300">Active</span>
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                                        1 day ago
                                                    </td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                        <div class="relative">
                                                            <button class="options-dropdown-button text-gray-400 hover:text-white p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400" onclick="event.stopPropagation(); toggleDropdown('component-dropdown-6')">
                                                                <span class="material-symbols-outlined text-lg">more_vert</span>
                                                            </button>
                                                            <div id="component-dropdown-6" class="options-dropdown-menu absolute right-0 mt-2 w-50 rounded-md shadow-lg hidden">
                                                                <a href="#" class="edit-component-link block px-4 py-2 text-sm text-gray-200 transition duration-150">Edit Component</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Duplicate</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-gray-200 transition duration-150">Export</a>
                                                                <a href="#" class="block px-4 py-2 text-sm text-red-400 transition duration-150">Delete Component</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- No matches found message -->
                                    <div id="no-component-matches-message" class="hidden px-6 py-8 text-center">
                                        <div class="flex flex-col items-center">
                                            <span class="material-symbols-outlined text-gray-400 text-4xl mb-3">grid_view</span>
                                            <h3 class="text-lg font-medium text-gray-300 mb-2">No components found</h3>
                                            <p class="text-gray-400 text-sm">Try adjusting your search terms or filters</p>
                                                    </div>
        </div>
    </div>



    <!-- Component Details Modal -->
                                <div id="component-modal" class="fixed inset-0 p-10 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                                    <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-full max-w-[1520px] flex flex-col">
                                        <!-- Modal Header -->
                                        <div class="py-4 px-6 border-b border-gray-700">
                                            <div class="flex items-center justify-between">
                                                <h2 class="text-xl font-semibold text-white">Sales Growth</h2>
                                                <button id="close-component-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                                                    <span class="material-symbols-outlined text-2xl">close</span>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Modal Content -->
                                        <div class="flex flex-1 overflow-hidden">
                                            <!-- Left Column - Component Data -->
                                            <div class="w-7/12 flex flex-col border-r border-gray-700">
                                                <!-- Fixed Content (Description, Metadata, Tabs) -->
                                                <div class="flex-shrink-0">
                                                    <!-- Description -->
                                                    <div class="py-4 px-6">
                                                        <div class="text-sm">
                                                            <div class="text-gray-500 mb-1">Description</div>
                                                            <div class="text-gray-300">Visualizes Year-Over-Year growth in sales since 2012.</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Metadata -->
                                                    <div class="pb-4 px-6">
                                                        <div class="grid grid-cols-3 gap-4 text-sm">
                                                            <div>
                                                                <div class="text-gray-500 mb-1">Category</div>
                                                                <div class="text-gray-300">Sales</div>
                                                            </div>
                                                            <div>
                                                                <div class="text-gray-500 mb-1">Type</div>
                                                                <div class="text-gray-300">Chart</div>
                                                            </div>
                                                            <div>
                                                                <div class="text-gray-500 mb-1">Status</div>
                                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-900 text-green-300">Active</span>
                                                            </div>
                                                            <div>
                                                                <div class="text-gray-500 mb-1">Update Frequency</div>
                                                                <div class="text-gray-300">Every Year</div>
                                                            </div>
                                                            <div>
                                                                <div class="text-gray-500 mb-1">Created</div>
                                                                <div class="text-gray-300">May 15, 2024 <span class="text-gray-500">(John Doe)</span></div>
                                                            </div>
                                                            <div>
                                                                <div class="text-gray-500 mb-1">Last Updated</div>
                                                                <div class="text-gray-300">Aug 23, 2024 <span class="text-gray-500">(John Doe)</span></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Navigation Tabs -->
                                                    <div class="border-b border-gray-700 px-6 mt-2">
                                                        <nav class="flex space-x-6">
                                                            <button class="internal-tab-item pb-2 px-1 border-b-2 border-red-500 text-white font-medium text-sm" data-tab="query">Query</button>
                                                            <button class="internal-tab-item pb-2 px-1 border-b-2 border-transparent text-gray-400 hover:text-white font-medium text-sm" data-tab="data-binding">Data Binding</button>
                                                            <button class="internal-tab-item pb-2 px-1 border-b-2 border-transparent text-gray-400 hover:text-white font-medium text-sm" data-tab="usage-analytics">Usage Analytics</button>
                                                            <button class="internal-tab-item pb-2 px-1 border-b-2 border-transparent text-gray-400 hover:text-white font-medium text-sm" data-tab="permissions">Permissions</button>
                                                        </nav>
                                                    </div>
                                                </div>
                                                
                                                <!-- Scrollable Tab Content Container -->
                                                <div class="flex-1 overflow-y-auto">
                                                    <!-- Query Tab -->
                                                    <div id="query-tab" class="component-tab-content p-6">
                                                        <!-- Query Editor with Floating Controls -->
                                                        <div class="bg-gray-800 rounded-lg p-4 relative">
                                                            <!-- Floating Controls -->
                                                            <div class="absolute top-4 right-4 flex items-center space-x-4 z-10">
                                                                <div class="flex items-center space-x-1">
                                                                    <span class="material-symbols-outlined text-gray-400 text-sm">schedule</span>
                                                                    <span class="text-sm text-gray-400">2 hrs ago</span>
                                                                </div>
                                                                <button class="border border-green-600 text-green-600 hover:bg-green-600 hover:text-white px-3 h-8 rounded-md text-sm font-medium transition duration-200 flex items-center">
                                                                    <span class="material-symbols-outlined text-md mr-1">play_arrow</span>
                                                                    Run
                                                                </button>
                                                                <div class="flex items-center">
                                                                    <button class="bg-blue-600 text-white px-3 py-1.5 text-sm transition duration-200 rounded-l-md border-r border-gray-600">SQL</button>
                                                                    <button class="bg-gray-700 hover:bg-gray-600 text-gray-400 px-3 py-1.5 text-sm transition duration-200 rounded-r-md">Python</button>
                                                                </div>
                                                            </div>
                                                                <pre class="text-sm text-gray-300 font-mono">
<code>SELECT 
    g.grid_id,
    g.longitude,
    g.latitude,
    g.area_size_km2,
    p.population_count,
    p.population_count / g.area_size_km2 as population_density
FROM grid g
JOIN population_data p ON g.grid_id = p.grid_id
WHERE g.district_name = 'Abu Dhabi Island'
    AND p.date BETWEEN '2024-04-10 00:00:00' 
    AND '2024-04-12 23:59:59'
ORDER BY population_density DESC;</code></pre>
                                                            </div>
                                                            
                                                        <!-- Results Tabs -->
                                                        <div class="mt-6 mb-4">
                                                            <div class="flex items-center">
                                                                <button class="results-tab bg-blue-600 text-white px-3 py-1.5 text-sm transition duration-200 rounded-l-md border-r border-gray-600" data-results-tab="query-result">Query Result</button>
                                                                <button class="results-tab bg-gray-700 hover:bg-gray-600 text-gray-400 px-3 py-1.5 text-sm transition duration-200 rounded-r-md" data-results-tab="datapoints-summary">Datapoints Summary</button>
                                                            </div>
                                                        </div>
                                                            
                                                            <!-- Query Result Tab Content -->
                                                            <div id="query-result-content" class="results-tab-content">
                                                                <div class="bg-gray-800 rounded-lg overflow-x-auto">
                                                                <table class="w-full">
                                                                    <thead class="border-b border-gray-700">
                                                                        <tr>
                                                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-300 flex items-center">
                                                                                grid_id
                                                                                <span class="material-symbols-outlined text-sm ml-1 text-blue-400">arrow_upward</span>
                                                                            </th>
                                                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">longitude</th>
                                                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">latitude</th>
                                                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">area_size_km2</th>
                                                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">population_count</th>
                                                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">population_density</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody class="divide-y divide-gray-700">
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">1</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.363716</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.488927</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">11.1</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">120,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">10,810</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">2</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.369329</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.481558</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">13.4</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">100,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">7,462</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">3</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.408431</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.430092</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">35.3</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">41,696</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">1,181</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">4</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.516095</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.403521</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">20.3</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">80,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">3,940</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">5</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.578195</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.419918</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">15.8</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">60,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">3,797</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">6</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.635928</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.321339</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">18.5</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">90,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">4,864</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">7</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.502884</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.3472</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">12.3</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">110,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">8,943</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">8</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">54.588875</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.286284</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">10.8</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">50,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">4,629</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">9</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">55.765832</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.225859</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">14.5</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">70,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">4,827</td>
                                                                        </tr>
                                                                        <tr class="hover:bg-gray-700">
                                                                            <td class="px-4 py-2 text-sm text-gray-300">10</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">55.704869</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">24.259183</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">19.2</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">85,000</td>
                                                                            <td class="px-4 py-2 text-sm text-gray-300">4,427</td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Datapoints Summary Tab Content -->
                                                        <div id="datapoints-summary-content" class="results-tab-content hidden">
                                                            <!-- GRIDS Section -->
                                                            <div class="mb-6">
                                                                <h3 class="text-sm font-medium text-gray-300 mb-4">GRIDS, with columns:</h3>
                                                                <div class="overflow-x-auto">
                                                                    <div class="flex gap-4 min-w-max">
                                                                    <!-- grid_id -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">grid_id</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">1</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">50.5</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- longitude -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">longitude</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">54.350</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">54.449</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">54.400</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- latitude -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">latitude</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">24.450</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">24.549</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">24.500</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- area_size_km2 -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">area_size_km2</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">1</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">50.5</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- district_name -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">district_name</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">VARCHAR(255)                                                                        </div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">9.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">0</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">19</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">9.5</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- POPULATION_DATA Section -->
                                                            <div>
                                                                <h3 class="text-sm font-medium text-gray-300 mb-4">POPULATION_DATA, with columns:</h3>
                                                                <div class="overflow-x-auto">
                                                                    <div class="flex gap-4 min-w-max">
                                                                    <!-- population_id -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">population_id</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">1</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">50.5</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- grid_id -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">grid_id</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">1</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">50.5</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- population_count -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">population_count</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">24.450</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">24.549</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">24.500</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <!-- date -->
                                                                    <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                                        <div class="text-sm font-medium text-white mb-2">date_time</div>
                                                                        <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">DATETIME</div>
                                                                        <div class="grid grid-cols-3 gap-4 text-xs">
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Count</div>
                                                                                <div class="text-gray-300">100</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Missing</div>
                                                                                <div class="text-gray-300">0.0%</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Zeroes</div>
                                                                                <div class="text-gray-300">NA</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Min</div>
                                                                                <div class="text-gray-300">-</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Max</div>
                                                                                <div class="text-gray-300">-</div>
                                                                            </div>
                                                                            <div class="space-y-1">
                                                                                <div class="text-gray-400">Median</div>
                                                                                <div class="text-gray-300">NA</div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                    
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                        
                                                    <!-- Data Binding Tab -->
                                                    <div id="data-binding-tab" class="component-tab-content p-6 h-full hidden">
                                                        <div class="space-y-6 h-full">

                                                            <div class="flex border border-gray-700 rounded-lg h-full overflow-hidden">

                                                                <!-- Visual Property Tabs -->
                                                                <div class="flex flex-col w-52 p-3 bg-gray-800 border-r border-gray-700">
                                                                    <div class="flex-1 space-y-2">
                                                                        <div class="visual-property-tab flex items-center py-1 px-3 bg-blue-600 text-white rounded-lg transition duration-200 cursor-pointer" data-visual-tab="color">
                                                                            <span class="material-symbols-outlined text-xl mr-3">palette</span>
                                                                            <span class="text-sm font-medium">Color</span>
                                                                        </div>
                                                                        <div class="visual-property-tab flex items-center py-1 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200" data-visual-tab="height">
                                                                            <span class="material-symbols-outlined text-xl mr-3">straighten</span>
                                                                            <span class="text-sm font-medium">Height</span>
                                                                        </div>
                                                                        <div class="visual-property-tab flex items-center py-1 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200" data-visual-tab="opacity">
                                                                            <span class="material-symbols-outlined text-xl mr-3">opacity</span>
                                                                            <span class="text-sm font-medium">Opacity</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Visual Property Tab Content -->
                                                                <div class="flex-1 p-4 overflow-auto">
                                                                    <!-- Color Tab Content -->
                                                                    <div id="color-tab-content" class="visual-tab-content space-y-6">
                                                                        <!-- Data Field -->
                                                                        <div>

                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Data Field</label>

                                                                            <div class="max-w-md">
                                                                                <div class="relative">
                                                                                    <button id="color-data-field-btn" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                                                                                        <span id="color-data-field-selected">population_density</span>
                                                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                                                    </button>
                                                                                    <div id="color-data-field-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48 w-full">
                                                                                        <div class="p-2">
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="population_density">population_density</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="population_count">population_count</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="heatmap_value">heatmap_value</div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Fill Color -->
                                                                        <div>
                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Fill Color</label>
                                                                            <div class="max-w-md">
                                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                                    <div class="relative">
                                                                                        <div class="h-2 bg-gradient-to-r from-gray-600 to-teal-400 rounded-full mb-2"></div>
                                                                                        <div class="flex justify-between text-xs text-gray-400">
                                                                                            <span>1K</span>
                                                                                            <span>10K</span>
                                                                                            <span>50K</span>
                                                                                            <span>100K</span>
                                                                                            <span>500K</span>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <!-- Rate of Change -->
                                                                        <div>
                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Rate of Change</label>
                                                                            <div class="max-w-md">
                                                                                <div class="relative">
                                                                                    <button id="color-rate-of-change-btn" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                                                                                        <span id="color-rate-of-change-selected">Exponential</span>
                                                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                                                    </button>
                                                                                    <div id="color-rate-of-change-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48 w-full">
                                                                                        <div class="p-2">
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="Linear">Linear</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="Exponential">Exponential</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="Logarithmic">Logarithmic</div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <!-- Color Stops -->
                                                                        <div>

                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Color Stops</label>

                                                                            <div class="max-w-md">
                                                                                <div class="bg-gray-800 rounded-lg">
                                                                                    <div>
                                                                                        <div class="flex items-center space-x-4 py-2 pl-2 pr-4 border-b border-gray-700">
                                                                                            <div class="flex items-center flex-1 space-x-2">
                                                                                                <button class="text-red-400 hover:text-red-300 p-2">
                                                                                                    <span class="material-symbols-outlined text-sm">delete</span>
                                                                                                </button>
                                                                                                <div>
                                                                                                    <input type="text" value="2,000" class="flex-1 bg-gray-800 border border-gray-700 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="w-4 h-4 bg-blue-500 rounded"></div>
                                                                                        </div>
                                                                                        <div class="flex items-center space-x-4 py-2 pl-2 pr-4 border-b border-gray-700">
                                                                                            <div class="flex items-center flex-1 space-x-2">
                                                                                                <button class="text-red-400 hover:text-red-300 p-2">
                                                                                                    <span class="material-symbols-outlined text-sm">delete</span>
                                                                                                </button>
                                                                                                <div>
                                                                                                    <input type="text" value="500,000" class="flex-1 bg-gray-800 border border-gray-700 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="w-4 h-4 bg-green-500 rounded"></div>
                                                                                        </div>
                                                                                        <div class="flex items-center">
                                                                                            <button class="text-blue-400 hover:bg-gray-700 rounded-b-lg transition duration-200 text-xs flex items-center w-full py-1 pl-2 pr-4 space-x-2">
                                                                                                <span class="material-symbols-outlined text-sm p-2">add</span>
                                                                                                <span>Add Stop</span>
                                                                                            </button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                        </div>
                                                                        
                                                                    </div>

                                                                    <!-- Height Tab Content -->
                                                                    <div id="height-tab-content" class="visual-tab-content hidden space-y-6">
                                                                        <!-- Data Field -->
                                                                        <div>

                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Data Field</label>

                                                                            <div class="max-w-md">
                                                                                <div class="relative">
                                                                                    <button id="height-data-field-btn" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                                                                                        <span id="height-data-field-selected">heatmap_value</span>
                                                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                                                    </button>
                                                                                    <div id="height-data-field-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48 w-full">
                                                                                        <div class="p-2">
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="population_density">population_density</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="population_count">population_count</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="heatmap_value">heatmap_value</div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- Fill Height -->
                                                                        <div>
                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Fill Height</label>
                                                                            <div class="max-w-md">
                                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                                    <div class="relative">
                                                                                        <!-- Chart Container -->
                                                                                        <div class="bg-gray-900 rounded relative" style="height: 200px;">
                                                                                            <!-- Chart Line -->
                                                                                            <svg class="w-full h-full absolute inset-0" viewBox="-15 0 230 115" preserveAspectRatio="xMidYMid meet">
                                                                                                <!-- Vertical grid lines -->
                                                                                                <line x1="0" y1="10" x2="0" y2="90" stroke="#374151" stroke-width="0.5" opacity="0.3"/>
                                                                                                <line x1="50" y1="10" x2="50" y2="90" stroke="#374151" stroke-width="0.5" opacity="0.3"/>
                                                                                                <line x1="100" y1="10" x2="100" y2="90" stroke="#374151" stroke-width="0.5" opacity="0.3"/>
                                                                                                <line x1="150" y1="10" x2="150" y2="90" stroke="#374151" stroke-width="0.5" opacity="0.3"/>
                                                                                                <line x1="200" y1="10" x2="200" y2="90" stroke="#374151" stroke-width="0.5" opacity="0.3"/>
                                                                                                
                                                                                                <!-- Main line -->
                                                                                                <line x1="0" y1="90" x2="200" y2="10" stroke="#14b8a6" stroke-width="1" fill="none"/>
                                                                                                
                                                                                                <!-- Data points -->
                                                                                                <circle cx="0" cy="90" r="2.5" fill="#14b8a6" stroke="#14b8a6" stroke-width="1"/>
                                                                                                <circle cx="200" cy="10" r="2.5" fill="#14b8a6" stroke="#14b8a6" stroke-width="1"/>
                                                                                                
                                                                                                <!-- X-axis labels -->
                                                                                                <text x="0" y="105" text-anchor="middle" fill="#9ca3af" font-size="6" font-family="Inter, sans-serif">1K</text>
                                                                                                <text x="50" y="105" text-anchor="middle" fill="#9ca3af" font-size="6" font-family="Inter, sans-serif">10K</text>
                                                                                                <text x="100" y="105" text-anchor="middle" fill="#9ca3af" font-size="6" font-family="Inter, sans-serif">50K</text>
                                                                                                <text x="150" y="105" text-anchor="middle" fill="#9ca3af" font-size="6" font-family="Inter, sans-serif">100K</text>
                                                                                                <text x="200" y="105" text-anchor="middle" fill="#9ca3af" font-size="6" font-family="Inter, sans-serif">500K</text>
                                                                                            </svg>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <!-- Rate of Change -->
                                                                        <div>
                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Rate of Change</label>
                                                                            <div class="max-w-md">
                                                                                <div class="relative">
                                                                                    <button id="height-rate-of-change-btn" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                                                                                        <span id="height-rate-of-change-selected">Linear</span>
                                                                                        <span class="material-symbols-outlined" style="font-size: 18px;">expand_more</span>
                                                                                    </button>
                                                                                    <div id="height-rate-of-change-dropdown" class="absolute top-full left-0 mt-2 bg-gray-700 rounded-md shadow-lg hidden z-50 min-w-48 w-full">
                                                                                        <div class="p-2">
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="Linear">Linear</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="Exponential">Exponential</div>
                                                                                            <div class="px-2 py-1 text-sm text-gray-300 hover:bg-gray-600 rounded cursor-pointer" data-value="Logarithmic">Logarithmic</div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <!-- Height Stops -->
                                                                        <div>

                                                                            <label class="text-sm font-medium text-gray-300 block mb-2">Height Stops</label>

                                                                            <div class="max-w-md">
                                                                                <div class="bg-gray-800 rounded-lg">
                                                                                    <div>
                                                                                        <div class="flex items-center space-x-4 py-2 pl-2 pr-4 border-b border-gray-700">
                                                                                            <div class="flex items-center flex-1 space-x-2">
                                                                                                <button class="text-red-400 hover:text-red-300 p-2">
                                                                                                    <span class="material-symbols-outlined text-sm">delete</span>
                                                                                                </button>
                                                                                                <div>
                                                                                                    <input type="text" value="2,000" class="flex-1 bg-gray-800 border border-gray-700 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="text-sm">0 meters</div>
                                                                                        </div>
                                                                                        <div class="flex items-center space-x-4 py-2 pl-2 pr-4 border-b border-gray-700">
                                                                                            <div class="flex items-center flex-1 space-x-2">
                                                                                                <button class="text-red-400 hover:text-red-300 p-2">
                                                                                                    <span class="material-symbols-outlined text-sm">delete</span>
                                                                                                </button>
                                                                                                <div>
                                                                                                    <input type="text" value="500,000" class="flex-1 bg-gray-800 border border-gray-700 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500">
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="text-sm">1,000 meters</div>
                                                                                        </div>
                                                                                        <div class="flex items-center">
                                                                                            <button class="text-blue-400 hover:bg-gray-700 rounded-b-lg transition duration-200 text-xs flex items-center w-full py-1 pl-2 pr-4 space-x-2">
                                                                                                <span class="material-symbols-outlined text-sm p-2">add</span>
                                                                                                <span>Add Stop</span>
                                                                                            </button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                        </div>
                                                                    </div>

                                                                    <!-- Opacity Tab Content -->
                                                                    <div id="opacity-tab-content" class="visual-tab-content hidden space-y-6">
                                                                        <div class="flex items-center justify-center h-64">
                                                                            <div class="text-center">
                                                                                <span class="material-symbols-outlined text-gray-400 text-4xl mb-3">opacity</span>
                                                                                <h3 class="text-lg font-medium text-gray-300 mb-2">Opacity Configuration</h3>
                                                                                <p class="text-gray-400 text-sm">Opacity property configuration will be implemented here</p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                </div>
                                                                    
                                                            </div>
                                                        </div>
                                                        
                                                    </div>
                                                    
                                                    <!-- Usage Analytics Tab -->
                                                    <div id="usage-analytics-tab" class="component-tab-content p-6 hidden">
                                                        <div class="space-y-6">
                                                            <!-- Key Metrics -->
                                                            <div class="grid grid-cols-2 gap-4">
                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                    <div class="text-sm text-gray-400">Usage Over Time</div>
                                                                    <div class="text-2xl font-bold text-white">3.4K</div>
                                                                </div>
                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                    <div class="text-sm text-gray-400">No. of Users</div>
                                                                    <div class="text-2xl font-bold text-white">244</div>
                                                                </div>
                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                    <div class="text-sm text-gray-400">No. of Edits</div>
                                                                    <div class="text-2xl font-bold text-white">12</div>
                                                                </div>
                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                    <div class="text-sm text-gray-400">Run Time</div>
                                                                    <div class="text-2xl font-bold text-white">120 Days</div>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Charts -->
                                                            <div class="grid grid-cols-2 gap-6">
                                                                <!-- Usage Breakdown Chart -->
                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                    <h3 class="text-sm font-medium text-gray-300 mb-4">Usage Breakdown</h3>
                                                                    <div class="h-32 flex items-end justify-between">
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 30%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 45%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 60%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 80%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 50%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 70%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 90%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 40%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 65%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 35%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 55%"></div>
                                                                        <div class="w-4 bg-teal-400 rounded-t" style="height: 75%"></div>
                                                                    </div>
                                                                    <div class="flex justify-between text-xs text-gray-400 mt-2">
                                                                        <span>Jan</span>
                                                                        <span>Feb</span>
                                                                        <span>Mar</span>
                                                                        <span>Apr</span>
                                                                        <span>May</span>
                                                                        <span>Jun</span>
                                                                        <span>Jul</span>
                                                                        <span>Aug</span>
                                                                        <span>Sep</span>
                                                                        <span>Oct</span>
                                                                        <span>Nov</span>
                                                                        <span>Dec</span>
                                                                    </div>
                                                                </div>
                                                                
                                                                <!-- Volume Profile Chart -->
                                                                <div class="bg-gray-800 rounded-lg p-4">
                                                                    <h3 class="text-sm font-medium text-gray-300 mb-4">Volume Profile</h3>
                                                                    <div class="h-32 relative">
                                                                        <svg class="w-full h-full" viewBox="0 0 200 100">
                                                                            <path d="M0,80 L50,20 L100,70 L150,30 L200,60" stroke="#14b8a6" stroke-width="2" fill="none"/>
                                                                            <circle cx="50" cy="20" r="2" fill="#14b8a6"/>
                                                                            <circle cx="100" cy="70" r="2" fill="#14b8a6"/>
                                                                            <circle cx="150" cy="30" r="2" fill="#14b8a6"/>
                                                                            <circle cx="200" cy="60" r="2" fill="#14b8a6"/>
                                                                        </svg>
                                                                        <div class="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-gray-400">
                                                                            <span>12:00 am</span>
                                                                            <span>6:00 am</span>
                                                                            <span>12:00 pm</span>
                                                                            <span>6:00 pm</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Permissions Tab -->
                                                    <div id="permissions-tab" class="component-tab-content p-6 hidden">
                                                        <div class="space-y-4">
                                                            <!-- Planning Section -->
                                                            <div>
                                                                <h3 class="text-sm font-medium text-gray-300 mb-3">Planning</h3>
                                                                <div class="space-y-3">
                                                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                                                        <div class="flex items-center space-x-3">
                                                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=JD" alt="">
                                                                            <div>
                                                                                <div class="text-sm font-medium text-white flex items-center space-x-2">
                                                                                    <span>John Doe</span>
                                                                                    <span class="text-xs bg-gray-900 text-gray-300 px-2 py-1 rounded">Admin</span>
                                                                                </div>
                                                                                <div class="text-xs text-gray-400">john.doe@company.com</div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex items-center space-x-2">
                                                                            <span class="text-xs text-gray-400">Full access</span>
                                                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                                                        <div class="flex items-center space-x-3">
                                                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=JS" alt="">
                                                                            <div>
                                                                                <div class="text-sm font-medium text-white">Jane Smith</div>
                                                                                <div class="text-xs text-gray-400">jane.smith@company.com</div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex items-center space-x-2">
                                                                            <span class="text-xs text-gray-400">Limited access</span>
                                                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Chairman Office Section -->
                                                            <div>
                                                                <h3 class="text-sm font-medium text-gray-300 mb-3">Chairman Office</h3>
                                                                <div class="space-y-3">
                                                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                                                        <div class="flex items-center space-x-3">
                                                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=MB" alt="">
                                                                            <div>
                                                                                <div class="text-sm font-medium text-white">Mike Brown</div>
                                                                                <div class="text-xs text-gray-400">mike.brown@company.com</div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex items-center space-x-2">
                                                                            <span class="text-xs text-gray-400">Limited access</span>
                                                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                                                        <div class="flex items-center space-x-3">
                                                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=SW" alt="">
                                                                            <div>
                                                                                <div class="text-sm font-medium text-white">Sarah Wilson</div>
                                                                                <div class="text-xs text-gray-400">sarah.wilson@company.com</div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex items-center space-x-2">
                                                                            <span class="text-xs text-gray-400">View only</span>
                                                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                            <!-- Right Column - Component Preview -->
                                            <div class="w-5/12 bg-gray-800 p-6">
                                                <h3 class="text-md font-semibold text-white mb-4">Component Preview</h3>
                                                <div class="bg-gray-700 rounded-lg p-4">
                                                    <div class="h-48 relative">
                                                        <svg class="w-full h-full" viewBox="0 0 200 100">
                                                            <path d="M0,80 L50,20 L100,70 L150,30 L200,60" stroke="#14b8a6" stroke-width="2" fill="none"/>
                                                            <circle cx="50" cy="20" r="2" fill="#14b8a6"/>
                                                            <circle cx="100" cy="70" r="2" fill="#14b8a6"/>
                                                            <circle cx="150" cy="30" r="2" fill="#14b8a6"/>
                                                            <circle cx="200" cy="60" r="2" fill="#14b8a6"/>
                                                        </svg>
                                                        <div class="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-gray-400">
                                                            <span>12:00 am</span>
                                                            <span>6:00 am</span>
                                                            <span>12:00 pm</span>
                                                            <span>6:00 pm</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        
                                    </div>
                                </div><!-- CLOSING Components Details Modal -->

                            </div>
                        </div>
                
                        <!-- Right Column - Component Statistics -->
                        <div class="w-64 bg-gray-800 border-l border-gray-700 h-full fixed right-0 top-0 overflow-y-auto" style="height: calc(100vh - 72px); margin-top: 72px;">
                            <div class="p-4">
                                <h3 class="text-md font-semibold text-white mb-4">Quick Stats</h3>
                                <div class="space-y-4">
                            <!-- Total Components -->
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 flex items-center justify-center bg-blue-600 rounded-lg">
                                        <span class="material-symbols-outlined text-white text-xl">grid_view</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm font-medium text-gray-400">Total Components</p>
                                        <p class="text-lg font-bold text-white">67</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Active Components -->
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 flex items-center justify-center bg-green-600 rounded-lg">
                                        <span class="material-symbols-outlined text-white text-xl">check_circle</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm font-medium text-gray-400">Active Components</p>
                                        <p class="text-lg font-bold text-white">54</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pending Review -->
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 flex items-center justify-center bg-yellow-600 rounded-lg">
                                        <span class="material-symbols-outlined text-white text-xl">schedule</span>
                                    </div>
                                    <div class="ml-4">
                                        <p class="text-sm font-medium text-gray-400">Pending Review</p>
                                        <p class="text-lg font-bold text-white">13</p>
                                    </div>
                                </div>
                            </div>
                        </div><!-- CLOSING Right Column - Component Statistics -->

                    </div><!-- CLOSING <div class="flex w-full"> -->
                </div><!-- CLOSING Components Tab Content -->
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // Search functionality
            const searchIconButton = document.getElementById('search-icon-button');
            const searchInputWrapper = document.getElementById('search-input-wrapper');
            const headerSearchInput = document.getElementById('header-search-input');

            searchIconButton.addEventListener('click', () => {
                searchInputWrapper.classList.toggle('is-active');
                if (searchInputWrapper.classList.contains('is-active')) {
                    headerSearchInput.focus();
                }
            });

            // User dropdown functionality
            const userDropdownButton = document.getElementById('user-dropdown-button');
            const userDropdownMenu = document.getElementById('user-dropdown-menu');

            userDropdownButton.addEventListener('click', (event) => {
                event.stopPropagation();
                userDropdownMenu.classList.toggle('hidden');
            });

            document.addEventListener('click', (event) => {
                if (!userDropdownButton.contains(event.target) && !userDropdownMenu.contains(event.target)) {
                    userDropdownMenu.classList.add('hidden');
                }
            });

            // Close search when clicking outside
            document.addEventListener('click', (event) => {
                if (!searchIconButton.contains(event.target) && !searchInputWrapper.contains(event.target)) {
                    searchInputWrapper.classList.remove('is-active');
                }
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                if (!event.target.closest('[id^="dropdown-"]') && !event.target.closest('button[onclick*="toggleDropdown"]')) {
                    document.querySelectorAll('[id^="dropdown-"]').forEach(dropdown => {
                        dropdown.classList.add('hidden');
                    });
                }
            });

            // Close component dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                if (!event.target.closest('[id^="component-dropdown-"]') && !event.target.closest('button[onclick*="toggleDropdown"]') && !event.target.closest('a[onclick*="openComponentModal"]')) {
                    document.querySelectorAll('[id^="component-dropdown-"]').forEach(dropdown => {
                        dropdown.classList.add('hidden');
                    });
                }
            });
            
            // Close filter dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                if (!event.target.closest('[id^="filter-dropdown-"]') && !event.target.closest('button[onclick*="toggleDropdown"]') && !event.target.closest('a[onclick*="openFilterModal"]')) {
                    document.querySelectorAll('[id^="filter-dropdown-"]').forEach(dropdown => {
                        dropdown.classList.add('hidden');
                    });
                }
            });

            // Handle checkbox changes
            document.querySelectorAll('#role-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateFilterState('role', checkbox.value, checkbox.checked);
                    updateFilterButton('role-filter-btn', filterStates.role);
                });
            });

            document.querySelectorAll('#workspace-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateFilterState('workspace', checkbox.value, checkbox.checked);
                    updateFilterButton('workspace-filter-btn', filterStates.workspace);
                });
            });

            document.querySelectorAll('#status-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateFilterState('status', checkbox.value, checkbox.checked);
                    updateFilterButton('status-filter-btn', filterStates.status);
                });
            });

            function updateFilterState(filterType, value, checked) {
                if (checked) {
                    if (!filterStates[filterType].includes(value)) {
                        filterStates[filterType].push(value);
                    }
                } else {
                    filterStates[filterType] = filterStates[filterType].filter(item => item !== value);
                }
            }

            function updateFilterButton(buttonId, selectedValues) {
                const button = document.getElementById(buttonId);
                const buttonText = button.querySelector('span:first-child');
                const filterType = buttonId.split('-')[0];
                const clearBtn = document.getElementById(filterType + '-clear-btn');
                
                if (selectedValues.length === 0) {
                    buttonText.textContent = filterType.charAt(0).toUpperCase() + filterType.slice(1);
                    clearBtn.classList.add('hidden');
                } else {
                    buttonText.textContent = selectedValues.join(', ');
                    clearBtn.classList.remove('hidden');
                }
                
                // Update "Clear All Filters" button visibility
                updateClearAllFiltersButton();
            }

            function updateClearAllFiltersButton() {
                const clearAllBtn = document.getElementById('clear-all-filters-btn');
                const hasAnyFilters = filterStates.role.length > 0 || filterStates.workspace.length > 0 || filterStates.status.length > 0;
                
                if (hasAnyFilters) {
                    clearAllBtn.classList.remove('hidden');
                } else {
                    clearAllBtn.classList.add('hidden');
                }
            }

            

            function clearFilter(filterType) {
                // Clear the filter state
                filterStates[filterType] = [];
                
                // Uncheck all checkboxes in the dropdown
                document.querySelectorAll(`#${filterType}-filter-dropdown input[type="checkbox"]`).forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Update the button text
                updateFilterButton(`${filterType}-filter-btn`, []);
                
                // Close the dropdown
                const dropdown = document.getElementById(`${filterType}-filter-dropdown`);
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
            }

            function clearAllFilters() {
                // Clear all filter states
                Object.keys(filterStates).forEach(filterType => {
                    filterStates[filterType] = [];
                    
                    // Uncheck all checkboxes in each dropdown
                    document.querySelectorAll(`#${filterType}-filter-dropdown input[type="checkbox"]`).forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    // Update each button text
                    updateFilterButton(`${filterType}-filter-btn`, []);
                });
                
                // Close all filter dropdowns
                filterDropdowns.forEach(dropdownId => {
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                    }
                });
            }

            // Close component filter dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                // Don't close if clicking on checkboxes or their labels inside component filter dropdowns
                if (event.target.type === 'checkbox' || event.target.closest('label')) {
                    return;
                }
                
                if (!event.target.closest('[id^="category-filter-"]') && !event.target.closest('[id^="type-filter-"]') && !event.target.closest('[id^="component-status-filter-"]') && !event.target.closest('button[id*="filter"]')) {
                    componentFilterDropdowns.forEach(dropdownId => {
                        const dropdown = document.getElementById(dropdownId);
                        if (dropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                }
            });

            // Components search functionality
            const componentsSearchInput = document.getElementById('components-search-input');
            const componentsSearchClear = document.getElementById('components-search-clear');
            
            if (componentsSearchInput && componentsSearchClear) {
                componentsSearchInput.addEventListener('input', (event) => {
                    const searchTerm = event.target.value.toLowerCase();
                    filterComponents();
                    
                    // Show/hide clear button based on input value
                    if (searchTerm.length > 0) {
                        componentsSearchClear.style.display = 'flex';
                    } else {
                        componentsSearchClear.style.display = 'none';
                    }
                });

                // Clear button functionality
                componentsSearchClear.addEventListener('click', () => {
                    componentsSearchInput.value = '';
                    componentsSearchClear.style.display = 'none';
                    filterComponents();
                    componentsSearchInput.focus();
                });
            }

            function filterComponents() {
                const searchTerm = componentsSearchInput ? componentsSearchInput.value.toLowerCase() : '';
                const rows = document.querySelectorAll('#components-content tbody tr');
                const noMatchesMessage = document.getElementById('no-component-matches-message');
                let visibleCount = 0;
                
                rows.forEach(row => {
                    const componentText = row.textContent.toLowerCase();
                    const matchesSearch = searchTerm === '' || componentText.includes(searchTerm);
                    
                    // Additional filter logic can be added here
                    row.style.display = matchesSearch ? '' : 'none';
                    if (matchesSearch) visibleCount++;
                });
                
                // Show/hide no matches message
                if (searchTerm.length > 0 && visibleCount === 0) {
                    noMatchesMessage.classList.remove('hidden');
                } else {
                    noMatchesMessage.classList.add('hidden');
                }
            }

            // Components filter functionality
            const componentFilterButtons = ['category-filter-btn', 'type-filter-btn', 'component-status-filter-btn'];
            const componentFilterDropdowns = ['category-filter-dropdown', 'type-filter-dropdown', 'component-status-filter-dropdown'];

            // Initialize component filter states
            const componentFilterStates = {
                category: [],
                type: [],
                status: []
            };

            // Toggle component filter dropdowns
            componentFilterButtons.forEach((btnId, index) => {
                const button = document.getElementById(btnId);
                if (button) {
                    const dropdown = document.getElementById(componentFilterDropdowns[index]);
                    
                    button.addEventListener('click', (event) => {
                        event.stopPropagation();
                        
                        // Close other dropdowns
                        componentFilterDropdowns.forEach((dropdownId, i) => {
                            if (i !== index) {
                                const otherDropdown = document.getElementById(dropdownId);
                                if (otherDropdown) {
                                    otherDropdown.classList.add('hidden');
                                }
                            }
                        });
                        
                        dropdown.classList.toggle('hidden');
                    });
                }
            });

            // Handle component filter checkbox changes
            document.querySelectorAll('#category-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateComponentFilterState('category', checkbox.value, checkbox.checked);
                    updateComponentFilterButton('category-filter-btn', componentFilterStates.category);
                });
            });

            document.querySelectorAll('#type-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateComponentFilterState('type', checkbox.value, checkbox.checked);
                    updateComponentFilterButton('type-filter-btn', componentFilterStates.type);
                });
            });

            document.querySelectorAll('#component-status-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateComponentFilterState('status', checkbox.value, checkbox.checked);
                    updateComponentFilterButton('component-status-filter-btn', componentFilterStates.status);
                });
            });

            function updateComponentFilterState(filterType, value, checked) {
                if (checked) {
                    if (!componentFilterStates[filterType].includes(value)) {
                        componentFilterStates[filterType].push(value);
                    }
                } else {
                    componentFilterStates[filterType] = componentFilterStates[filterType].filter(item => item !== value);
                }
            }

            function updateComponentFilterButton(buttonId, selectedValues) {
                const button = document.getElementById(buttonId);
                if (!button) return;
                
                const buttonText = button.querySelector('span:first-child');
                
                // Handle different filter types with proper clear button IDs
                let clearBtnId;
                let defaultText;
                
                if (buttonId === 'category-filter-btn') {
                    clearBtnId = 'category-clear-btn';
                    defaultText = 'Category';
                } else if (buttonId === 'type-filter-btn') {
                    clearBtnId = 'type-clear-btn';
                    defaultText = 'Type';
                } else if (buttonId === 'component-status-filter-btn') {
                    clearBtnId = 'component-status-clear-btn';
                    defaultText = 'Status';
                }
                
                const clearBtn = document.getElementById(clearBtnId);
                
                if (selectedValues.length === 0) {
                    buttonText.textContent = defaultText;
                    if (clearBtn) clearBtn.classList.add('hidden');
                } else {
                    buttonText.textContent = selectedValues.join(', ');
                    if (clearBtn) clearBtn.classList.remove('hidden');
                }
                
                // Update "Clear All Filters" button visibility
                updateComponentClearAllFiltersButton();
            }

            function updateComponentClearAllFiltersButton() {
                const clearAllBtn = document.getElementById('clear-all-component-filters-btn');
                if (!clearAllBtn) return;
                
                const hasAnyFilters = componentFilterStates.category.length > 0 || componentFilterStates.type.length > 0 || componentFilterStates.status.length > 0;
                
                if (hasAnyFilters) {
                    clearAllBtn.classList.remove('hidden');
                } else {
                    clearAllBtn.classList.add('hidden');
                }
            }

            // Clear individual component filter buttons
            const categoryClearBtn = document.getElementById('category-clear-btn');
            if (categoryClearBtn) {
                categoryClearBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    clearComponentFilter('category');
                });
            }

            const typeClearBtn = document.getElementById('type-clear-btn');
            if (typeClearBtn) {
                typeClearBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    clearComponentFilter('type');
                });
            }

            const componentStatusClearBtn = document.getElementById('component-status-clear-btn');
            if (componentStatusClearBtn) {
                componentStatusClearBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    clearComponentFilter('status');
                });
            }

            // Clear all component filters button
            const clearAllComponentFiltersBtn = document.getElementById('clear-all-component-filters-btn');
            if (clearAllComponentFiltersBtn) {
                clearAllComponentFiltersBtn.addEventListener('click', () => {
                    clearAllComponentFilters();
                });
            }

            function clearComponentFilter(filterType) {
                // Clear the filter state
                componentFilterStates[filterType] = [];
                
                // Uncheck all checkboxes in the dropdown
                let dropdownId;
                let buttonId;
                
                if (filterType === 'category') {
                    dropdownId = 'category-filter-dropdown';
                    buttonId = 'category-filter-btn';
                } else if (filterType === 'type') {
                    dropdownId = 'type-filter-dropdown';
                    buttonId = 'type-filter-btn';
                } else if (filterType === 'status') {
                    dropdownId = 'component-status-filter-dropdown';
                    buttonId = 'component-status-filter-btn';
                }
                
                document.querySelectorAll(`#${dropdownId} input[type="checkbox"]`).forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Update the button text
                updateComponentFilterButton(buttonId, []);
                
                // Close the dropdown
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
            }

            function clearAllComponentFilters() {
                // Clear all filter states
                componentFilterStates.category = [];
                componentFilterStates.type = [];
                componentFilterStates.status = [];
                
                // Uncheck all checkboxes in each dropdown
                document.querySelectorAll('#category-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                document.querySelectorAll('#type-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                document.querySelectorAll('#component-status-filter-dropdown input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Update each button text
                updateComponentFilterButton('category-filter-btn', []);
                updateComponentFilterButton('type-filter-btn', []);
                updateComponentFilterButton('component-status-filter-btn', []);
                
                // Close all component filter dropdowns
                componentFilterDropdowns.forEach(dropdownId => {
                    const dropdown = document.getElementById(dropdownId);
                    if (dropdown) {
                        dropdown.classList.add('hidden');
                    }
                });
            }

            // Component Modal Functionality
            const componentModal = document.getElementById('component-modal');
            const closeComponentModal = document.getElementById('close-component-modal');
            const componentTableRows = document.querySelectorAll('#components-table tbody tr');

            // Function to open component modal
            function openComponentModal() {
                
                // Check if modal exists
                if (!componentModal) {
                    return;
                }
                
                // Close all component dropdowns first
                document.querySelectorAll('[id^="component-dropdown-"]').forEach(dropdown => {
                    dropdown.classList.add('hidden');
                });
                
                // Open modal immediately
                componentModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
                
                // Reset modal tabs to show Query tab by default
                const componentModalTabs = document.querySelectorAll('#component-modal .internal-tab-item[data-tab]');
                const componentTabContents = document.querySelectorAll('.component-tab-content');
                
                // Reset all tabs to inactive state
                componentModalTabs.forEach(tab => {
                    tab.classList.remove('border-red-500', 'text-white');
                    tab.classList.add('border-transparent', 'text-gray-400');
                });
                
                // Hide all tab contents
                componentTabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Activate Query tab
                const queryTab = document.querySelector('#component-modal .internal-tab-item[data-tab="query"]');
                const queryTabContent = document.getElementById('query-tab');
                
                if (queryTab && queryTabContent) {
                    queryTab.classList.add('border-red-500', 'text-white');
                    queryTab.classList.remove('border-transparent', 'text-gray-400');
                    queryTabContent.classList.remove('hidden');
                }
            }

            // Add event listeners for Edit Component links
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('edit-component-link')) {
                    event.preventDefault();
                    event.stopPropagation();
                    openComponentModal();
                }
            });

            // Open modal when clicking on component table rows
            componentTableRows.forEach(row => {
                row.addEventListener('click', (event) => {
                    // Don't open modal if clicking on dropdown button
                    if (event.target.closest('.options-dropdown-button')) {
                        return;
                    }
                    openComponentModal();
                });
            });

            // Close modal
            closeComponentModal.addEventListener('click', () => {
                componentModal.classList.add('hidden');
                document.body.style.overflow = ''; // Restore scrolling
            });

            // Close modal when clicking outside
            componentModal.addEventListener('click', (event) => {
                if (event.target === componentModal) {
                    componentModal.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            });

            // Component Modal Tab Switching
            const componentModalTabs = document.querySelectorAll('#component-modal .internal-tab-item[data-tab]');
            const componentTabContents = document.querySelectorAll('.component-tab-content');

            componentModalTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.getAttribute('data-tab');
                    
                    // Update tab styling to match internal tab style
                    componentModalTabs.forEach(t => {
                        t.classList.remove('border-red-500', 'text-white');
                        t.classList.add('border-transparent', 'text-gray-400');
                    });
                    tab.classList.add('border-red-500', 'text-white');
                    tab.classList.remove('border-transparent', 'text-gray-400');
                    
                    // Show target content
                    componentTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(targetTab + '-tab').classList.remove('hidden');
                });
            });

            // Results Tab Switching (within Query tab)
            const resultsTabs = document.querySelectorAll('.results-tab');
            const resultsTabContents = document.querySelectorAll('.results-tab-content');
            
            resultsTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetResultsTab = tab.getAttribute('data-results-tab');
                    
                    // Reset all tabs to inactive state
                    resultsTabs.forEach(t => {
                        t.classList.remove('bg-blue-600', 'text-white');
                        t.classList.add('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                        t.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        t.classList.add('rounded-r-md');
                    });
                    
                    // Set the clicked tab to active state
                    tab.classList.add('bg-blue-600', 'text-white');
                    tab.classList.remove('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                    
                    // Handle border styling for button group based on which tab is active
                    if (targetResultsTab === 'query-result') {
                        // Query Result is active - it should be left rounded with border
                        tab.classList.add('rounded-l-md', 'border-r', 'border-gray-600');
                        tab.classList.remove('rounded-r-md');
                        
                        // Datapoints Summary should be right rounded without border
                        const datapointsTab = document.querySelector('[data-results-tab="datapoints-summary"]');
                        if (datapointsTab) {
                            datapointsTab.classList.add('rounded-r-md');
                            datapointsTab.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        }
                    } else {
                        // Datapoints Summary is active - it should be right rounded without border
                        tab.classList.add('rounded-r-md');
                        tab.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        
                        // Query Result should be left rounded with border
                        const queryTab = document.querySelector('[data-results-tab="query-result"]');
                        if (queryTab) {
                            queryTab.classList.add('rounded-l-md', 'border-r', 'border-gray-600');
                            queryTab.classList.remove('rounded-r-md');
                        }
                    }
                    
                    // Hide all results tab content
                    resultsTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target results tab content
                    const targetContent = document.getElementById(targetResultsTab + '-content');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });

        });

        // Global dropdown functionality for user table
        function toggleDropdown(dropdownId) {
            // Close all other dropdowns (user, component, and filter dropdowns)
            document.querySelectorAll('[id^="dropdown-"], [id^="component-dropdown-"], [id^="filter-dropdown-"]').forEach(dropdown => {
                if (dropdown.id !== dropdownId) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // Get the dropdown and button
            const dropdown = document.getElementById(dropdownId);
            const button = window.event ? window.event.target.closest('button') : event.target.closest('button');
            
            if (!dropdown) {
                return;
            }
            
            // Toggle the clicked dropdown
            dropdown.classList.toggle('hidden');
            
            if (!dropdown.classList.contains('hidden')) {
                // Ensure dropdown is appended to body if not already
                if (dropdown.parentElement !== document.body) {
                    document.body.appendChild(dropdown);
                }
                
                // Position the dropdown relative to the button
                const buttonRect = button.getBoundingClientRect();
                dropdown.style.position = 'fixed';
                dropdown.style.top = (buttonRect.bottom + 8) + 'px';
                dropdown.style.right = (window.innerWidth - buttonRect.right) + 'px';
            }
        }

        // Single-selection dropdown functionality for Data Binding tab
        document.addEventListener('DOMContentLoaded', function() {
            // Color tab dropdowns
            const colorRateOfChangeBtn = document.getElementById('color-rate-of-change-btn');
            const colorRateOfChangeDropdown = document.getElementById('color-rate-of-change-dropdown');
            const colorRateOfChangeSelected = document.getElementById('color-rate-of-change-selected');

            if (colorRateOfChangeBtn && colorRateOfChangeDropdown) {
                colorRateOfChangeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close all other dropdowns first
                    document.querySelectorAll('[id$="-dropdown"]').forEach(dropdown => {
                        if (dropdown !== colorRateOfChangeDropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                    colorRateOfChangeDropdown.classList.toggle('hidden');
                });

                // Handle option selection
                colorRateOfChangeDropdown.querySelectorAll('[data-value]').forEach(option => {
                    option.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        colorRateOfChangeSelected.textContent = value;
                        colorRateOfChangeDropdown.classList.add('hidden');
                    });
                });
            }

            const colorDataFieldBtn = document.getElementById('color-data-field-btn');
            const colorDataFieldDropdown = document.getElementById('color-data-field-dropdown');
            const colorDataFieldSelected = document.getElementById('color-data-field-selected');

            if (colorDataFieldBtn && colorDataFieldDropdown) {
                colorDataFieldBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close all other dropdowns first
                    document.querySelectorAll('[id$="-dropdown"]').forEach(dropdown => {
                        if (dropdown !== colorDataFieldDropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                    colorDataFieldDropdown.classList.toggle('hidden');
                });

                // Handle option selection
                colorDataFieldDropdown.querySelectorAll('[data-value]').forEach(option => {
                    option.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        colorDataFieldSelected.textContent = value;
                        colorDataFieldDropdown.classList.add('hidden');
                    });
                });
            }

            // Height tab dropdowns
            const heightRateOfChangeBtn = document.getElementById('height-rate-of-change-btn');
            const heightRateOfChangeDropdown = document.getElementById('height-rate-of-change-dropdown');
            const heightRateOfChangeSelected = document.getElementById('height-rate-of-change-selected');

            if (heightRateOfChangeBtn && heightRateOfChangeDropdown) {
                heightRateOfChangeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close all other dropdowns first
                    document.querySelectorAll('[id$="-dropdown"]').forEach(dropdown => {
                        if (dropdown !== heightRateOfChangeDropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                    heightRateOfChangeDropdown.classList.toggle('hidden');
                });

                // Handle option selection
                heightRateOfChangeDropdown.querySelectorAll('[data-value]').forEach(option => {
                    option.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        heightRateOfChangeSelected.textContent = value;
                        heightRateOfChangeDropdown.classList.add('hidden');
                    });
                });
            }

            const heightDataFieldBtn = document.getElementById('height-data-field-btn');
            const heightDataFieldDropdown = document.getElementById('height-data-field-dropdown');
            const heightDataFieldSelected = document.getElementById('height-data-field-selected');

            if (heightDataFieldBtn && heightDataFieldDropdown) {
                heightDataFieldBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Close all other dropdowns first
                    document.querySelectorAll('[id$="-dropdown"]').forEach(dropdown => {
                        if (dropdown !== heightDataFieldDropdown) {
                            dropdown.classList.add('hidden');
                        }
                    });
                    heightDataFieldDropdown.classList.toggle('hidden');
                });

                // Handle option selection
                heightDataFieldDropdown.querySelectorAll('[data-value]').forEach(option => {
                    option.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        heightDataFieldSelected.textContent = value;
                        heightDataFieldDropdown.classList.add('hidden');
                    });
                });
            }

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                const allDropdowns = document.querySelectorAll('[id$="-dropdown"]');
                const allButtons = document.querySelectorAll('[id$="-btn"]');
                
                let clickedInsideDropdown = false;
                let clickedInsideButton = false;
                
                allDropdowns.forEach(dropdown => {
                    if (dropdown.contains(e.target)) {
                        clickedInsideDropdown = true;
                    }
                });
                
                allButtons.forEach(button => {
                    if (button.contains(e.target)) {
                        clickedInsideButton = true;
                    }
                });
                
                if (!clickedInsideDropdown && !clickedInsideButton) {
                    allDropdowns.forEach(dropdown => {
                        dropdown.classList.add('hidden');
                    });
                }
            });

            // Visual Property Tab Switching
            const visualPropertyTabs = document.querySelectorAll('.visual-property-tab');
            const visualTabContents = document.querySelectorAll('.visual-tab-content');

            visualPropertyTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetVisualTab = tab.getAttribute('data-visual-tab');
                    
                    // Update tab styling
                    visualPropertyTabs.forEach(t => {
                        t.classList.remove('bg-blue-600', 'text-white');
                        t.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                    });
                    tab.classList.add('bg-blue-600', 'text-white');
                    tab.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
                    
                    // Hide all visual tab content
                    visualTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target visual tab content
                    const targetContent = document.getElementById(targetVisualTab + '-tab-content');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });
        });

        // Global variables for shared functionality
        let selectedDataSourceType = null;
        let selectedAiModel = null;
        let selectedDatabase = null;
        let selectedApi = null;
        let tempSelectedAiModel = null;
        let tempSelectedDatabase = null;
        let tempSelectedApi = null;
        let databases = [
            { id: 'mysql-prod', name: 'Production MySQL', type: 'mysql', host: 'mysql.prod.company.com', port: '3306', dbname: 'production_db', username: 'app_user', description: 'Production database for live application' },
            { id: 'postgres-analytics', name: 'Analytics PostgreSQL', type: 'postgresql', host: 'analytics.company.com', port: '5432', dbname: 'analytics_db', username: 'analytics_user', description: 'Analytics and reporting database' },
            { id: 'sqlserver-warehouse', name: 'Data Warehouse', type: 'sqlserver', host: 'warehouse.company.com', port: '1433', dbname: 'warehouse_db', username: 'warehouse_user', description: 'Data warehouse for business intelligence' },
            { id: 'oracle-finance', name: 'Finance Oracle', type: 'oracle', host: 'finance.company.com', port: '1521', dbname: 'finance_db', username: 'finance_user', description: 'Financial data and transactions' },
            { id: 'sqlite-local', name: 'Local Development', type: 'sqlite', host: 'localhost', port: '', dbname: 'dev.db', username: '', description: 'Local development database' }
        ];
        let apis = [
            { id: 'customer-portal-api', name: 'Customer Portal API', url: 'https://api.customerportal.company.com/v1', auth: 'bearer', method: 'GET', description: 'Internal customer data and account information' },
            { id: 'inventory-management-api', name: 'Inventory Management API', url: 'https://api.inventory.company.com/v2', auth: 'api-key', method: 'POST', description: 'Real-time inventory tracking and stock management' },
            { id: 'hr-system-api', name: 'HR System API', url: 'https://api.hr.company.com/employees', auth: 'bearer', method: 'GET', description: 'Employee data and organizational structure' },
            { id: 'financial-reporting-api', name: 'Financial Reporting API', url: 'https://api.finance.company.com/reports', auth: 'api-key', method: 'GET', description: 'Financial data and reporting metrics' },
            { id: 'logistics-tracking-api', name: 'Logistics Tracking API', url: 'https://api.logistics.company.com/tracking', auth: 'none', method: 'POST', description: 'Shipment tracking and delivery status updates' }
        ];
        let filteredDatabases = [...databases];
        let filteredApis = [...apis];
        let aiModels = [
            { id: 'energy-demand-forecast', name: 'Energy Demand Forecast', description: 'Predicts energy consumption based on weather patterns and historical usage data', provider: 'utility', type: 'predictive' },
            { id: 'customer-feedback-nlp', name: 'Customer Feedback Analyzer', description: 'Categorizes and analyzes customer feedback for sentiment and topic classification', provider: 'retail', type: 'nlp' },
            { id: 'traffic-policy-simulator', name: 'Traffic Policy Simulator', description: 'Simulates traffic flow changes and congestion impact of new traffic policies', provider: 'municipal', type: 'simulation' },
            { id: 'inventory-optimization', name: 'Inventory Optimization Model', description: 'Optimizes inventory levels based on demand forecasting and supply chain constraints', provider: 'logistics', type: 'optimization' },
            { id: 'fraud-detection-finance', name: 'Financial Fraud Detector', description: 'Detects fraudulent transactions using pattern recognition and behavioral analysis', provider: 'finance', type: 'anomaly' },
            { id: 'crop-yield-predictor', name: 'Crop Yield Predictor', description: 'Predicts crop yields based on soil conditions, weather data, and farming practices', provider: 'agriculture', type: 'predictive' },
            { id: 'patient-diagnosis-assistant', name: 'Medical Diagnosis Assistant', description: 'Assists in medical diagnosis by analyzing patient symptoms and medical history', provider: 'healthcare', type: 'diagnostic' },
            { id: 'supply-chain-optimizer', name: 'Supply Chain Optimizer', description: 'Optimizes supply chain routes and inventory distribution across multiple locations', provider: 'manufacturing', type: 'optimization' },
            { id: 'real-estate-valuation', name: 'Real Estate Valuation Model', description: 'Estimates property values based on market trends, location data, and property features', provider: 'real-estate', type: 'predictive' },
            { id: 'quality-control-inspector', name: 'Quality Control Inspector', description: 'Automated quality inspection using computer vision to detect manufacturing defects', provider: 'manufacturing', type: 'computer-vision' },
            { id: 'customer-churn-predictor', name: 'Customer Churn Predictor', description: 'Predicts customer churn likelihood based on usage patterns and service interactions', provider: 'telecom', type: 'predictive' },
            { id: 'energy-grid-optimizer', name: 'Smart Grid Optimizer', description: 'Optimizes energy distribution across the grid based on demand and renewable energy availability', provider: 'utility', type: 'optimization' },
            { id: 'logistics-route-planner', name: 'Logistics Route Planner', description: 'Plans optimal delivery routes considering traffic, weather, and delivery constraints', provider: 'logistics', type: 'optimization' },
            { id: 'market-trend-analyzer', name: 'Market Trend Analyzer', description: 'Analyzes market trends and provides investment recommendations based on historical data', provider: 'finance', type: 'analytics' },
            { id: 'maintenance-predictor', name: 'Predictive Maintenance Model', description: 'Predicts equipment maintenance needs based on sensor data and operational patterns', provider: 'manufacturing', type: 'predictive' },
            { id: 'risk-assessment-model', name: 'Risk Assessment Model', description: 'Assesses risk levels for insurance policies based on demographic and behavioral data', provider: 'insurance', type: 'predictive' }
        ];
        let filteredAiModels = [...aiModels];
        let currentStep = 1;
        
        // Visualization step variables
        let selectedVisualizationType = null;
        let selectedChartSubtype = null;
        let selectedMapLayerSubtype = null;
        
        // Data mapping variables
        let selectedXAxisField = null;
        let selectedYAxisField = null;
        let selectedValueField = null;
        let selectedKpiField = null;
        let selectedSeriesFields = [];
        let selectedFilterFields = [];
        let selectedYAxisFields = [];
        let selectedLabelField = null;

        // Global functions for shared functionality
        function updateSelectedDatabaseDisplay() {
            if (selectedDatabase) {
                const db = databases.find(d => d.id === selectedDatabase);
                if (db) {
                    const nameElement = document.getElementById('selected-database-name');
                    const detailsElement = document.getElementById('selected-database-details');
                    const iconElement = document.getElementById('selected-database-icon');
                    const databaseSelectionContainer = document.getElementById('database-selection-container');
                    const selectedDatabaseDisplay = document.getElementById('selected-database-display');
                    
                    if (nameElement) nameElement.textContent = db.name;
                    if (detailsElement) detailsElement.textContent = `${db.host}:${db.port} - ${db.dbname}`;
                    if (iconElement) iconElement.textContent = 'storage';
                    
                    if (databaseSelectionContainer && selectedDatabaseDisplay) {
                        databaseSelectionContainer.classList.add('hidden');
                        selectedDatabaseDisplay.classList.remove('hidden');
                    }
                }
            } else {
                const databaseSelectionContainer = document.getElementById('database-selection-container');
                const selectedDatabaseDisplay = document.getElementById('selected-database-display');
                if (databaseSelectionContainer && selectedDatabaseDisplay) {
                    databaseSelectionContainer.classList.remove('hidden');
                    selectedDatabaseDisplay.classList.add('hidden');
                }
            }
        }

        function updateSelectedApiDisplay() {
            if (selectedApi) {
                const api = apis.find(a => a.id === selectedApi);
                if (api) {
                    const nameElement = document.getElementById('selected-api-name');
                    const detailsElement = document.getElementById('selected-api-details');
                    const iconElement = document.getElementById('selected-api-icon');
                    const apiSelectionContainer = document.getElementById('api-selection-container');
                    const selectedApiDisplay = document.getElementById('selected-api-display');
                    
                    if (nameElement) nameElement.textContent = api.name;
                    if (detailsElement) detailsElement.textContent = `${api.url} - ${api.method}`;
                    if (iconElement) iconElement.textContent = 'api';
                    
                    if (apiSelectionContainer && selectedApiDisplay) {
                        apiSelectionContainer.classList.add('hidden');
                        selectedApiDisplay.classList.remove('hidden');
                    }
                }
            } else {
                const apiSelectionContainer = document.getElementById('api-selection-container');
                const selectedApiDisplay = document.getElementById('selected-api-display');
                if (apiSelectionContainer && selectedApiDisplay) {
                    apiSelectionContainer.classList.remove('hidden');
                    selectedApiDisplay.classList.add('hidden');
                }
            }
        }

        function showDatabaseConnectionStatus() {
            const statusContainer = document.getElementById('database-connection-status');
            const loadingStatus = document.getElementById('database-loading-status');
            const successStatus = document.getElementById('database-success-status');
            const queryField = document.getElementById('database-query-field');
            
            if (statusContainer && loadingStatus && successStatus) {
                // Show loading status
                statusContainer.classList.remove('hidden');
                loadingStatus.classList.remove('hidden');
                successStatus.classList.add('hidden');
                
                // After 3 seconds, show success status and query field
                setTimeout(() => {
                    loadingStatus.classList.add('hidden');
                    successStatus.classList.remove('hidden');
                    
                    // Show query field
                    if (queryField) {
                        queryField.classList.remove('hidden');
                        // Initialize the database results tabs
                        initializeDatabaseResultsTabs();
                    }
                }, 3000);
            }
        }

        function showApiConnectionStatus() {
            const statusContainer = document.getElementById('api-connection-status');
            const loadingStatus = document.getElementById('api-loading-status');
            const successStatus = document.getElementById('api-success-status');
            const apiParametersField = document.getElementById('api-parameters-field');
            
            if (statusContainer && loadingStatus && successStatus) {
                // Show loading status
                statusContainer.classList.remove('hidden');
                loadingStatus.classList.remove('hidden');
                successStatus.classList.add('hidden');
                
                // After 3 seconds, show success status and API parameters field
                setTimeout(() => {
                    loadingStatus.classList.add('hidden');
                    successStatus.classList.remove('hidden');
                    
                    // Show API parameters field
                    if (apiParametersField) {
                        apiParametersField.classList.remove('hidden');
                        // Initialize API results tabs
                        initializeApiResultsTabs();
                    }
                }, 3000);
            }
        }

        // API Results Tab Switching (within API Parameters field)
        function initializeApiResultsTabs() {
            const apiResultsTabs = document.querySelectorAll('.api-results-tab');
            const apiResultsTabContents = document.querySelectorAll('.api-results-tab-content');
            
            apiResultsTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetApiResultsTab = tab.getAttribute('data-api-results-tab');
                    
                    // Reset all API results tabs to inactive state
                    apiResultsTabs.forEach(t => {
                        t.classList.remove('bg-blue-600', 'text-white');
                        t.classList.add('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                        t.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        t.classList.add('rounded-r-md');
                    });
                    
                    // Set the clicked tab to active state
                    tab.classList.add('bg-blue-600', 'text-white');
                    tab.classList.remove('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                    
                    // Handle border styling for button group based on which tab is active
                    if (targetApiResultsTab === 'api-call-result') {
                        // API Call Result is active - it should be left rounded with border
                        tab.classList.add('rounded-l-md', 'border-r', 'border-gray-600');
                        tab.classList.remove('rounded-r-md');
                        
                        // API Datapoints Summary should be right rounded without border
                        const apiDatapointsTab = document.querySelector('[data-api-results-tab="api-datapoints-summary"]');
                        if (apiDatapointsTab) {
                            apiDatapointsTab.classList.add('rounded-r-md');
                            apiDatapointsTab.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        }
                    } else {
                        // API Datapoints Summary is active - it should be right rounded without border
                        tab.classList.add('rounded-r-md');
                        tab.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        
                        // API Call Result should be left rounded with border
                        const apiCallTab = document.querySelector('[data-api-results-tab="api-call-result"]');
                        if (apiCallTab) {
                            apiCallTab.classList.add('rounded-l-md', 'border-r', 'border-gray-600');
                            apiCallTab.classList.remove('rounded-r-md');
                        }
                    }
                    
                    // Hide all API results tab content
                    apiResultsTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target API results tab content
                    const targetContent = document.getElementById(targetApiResultsTab + '-content');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });
        }

        // Database Results Tab Switching (within Database Query field)
        function initializeDatabaseResultsTabs() {
            const databaseResultsTabs = document.querySelectorAll('.database-results-tab');
            const databaseResultsTabContents = document.querySelectorAll('.database-results-tab-content');
            
            databaseResultsTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetDatabaseResultsTab = tab.getAttribute('data-database-results-tab');
                    
                    // Reset all database results tabs to inactive state
                    databaseResultsTabs.forEach(t => {
                        t.classList.remove('bg-blue-600', 'text-white');
                        t.classList.add('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                        t.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        t.classList.add('rounded-r-md');
                    });
                    
                    // Set the clicked tab to active state
                    tab.classList.add('bg-blue-600', 'text-white');
                    tab.classList.remove('bg-gray-700', 'text-gray-400', 'hover:bg-gray-600');
                    
                    // Handle border styling for button group based on which tab is active
                    if (targetDatabaseResultsTab === 'database-query-result') {
                        // Database Query Result is active - it should be left rounded with border
                        tab.classList.add('rounded-l-md', 'border-r', 'border-gray-600');
                        tab.classList.remove('rounded-r-md');
                        
                        // Database Datapoints Summary should be right rounded without border
                        const databaseDatapointsTab = document.querySelector('[data-database-results-tab="database-datapoints-summary"]');
                        if (databaseDatapointsTab) {
                            databaseDatapointsTab.classList.add('rounded-r-md');
                            databaseDatapointsTab.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        }
                    } else {
                        // Database Datapoints Summary is active - it should be right rounded without border
                        tab.classList.add('rounded-r-md');
                        tab.classList.remove('rounded-l-md', 'border-r', 'border-gray-600');
                        
                        // Database Query Result should be left rounded with border
                        const databaseQueryTab = document.querySelector('[data-database-results-tab="database-query-result"]');
                        if (databaseQueryTab) {
                            databaseQueryTab.classList.add('rounded-l-md', 'border-r', 'border-gray-600');
                            databaseQueryTab.classList.remove('rounded-r-md');
                        }
                    }
                    
                    // Hide all database results tab content
                    databaseResultsTabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target database results tab content
                    const targetContent = document.getElementById(targetDatabaseResultsTab + '-content');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });
        }

        // Global validation function
        function validateStep2() {
            // Get the current data source configuration based on selected type
            
            if (!selectedDataSourceType) {
                // No data source type selected
                const nextStepBtn = document.getElementById('next-step-btn');
                if (nextStepBtn) {
                    nextStepBtn.disabled = true;
                    nextStepBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
                return;
            }

            let isStep2Valid = false;

            if (selectedDataSourceType === 'database') {
                // For database, check if a database is selected
                isStep2Valid = selectedDatabase !== null && selectedDatabase !== '';
            } else if (selectedDataSourceType === 'api') {
                // For API, check if an API is selected
                isStep2Valid = selectedApi !== null && selectedApi !== '';
            } else if (selectedDataSourceType === 'file') {
                // For file upload, we'll consider it valid if a file is selected
                // Since this is a drag & drop area, we'll set it as valid by default
                // In a real implementation, you'd check if a file is actually uploaded
                isStep2Valid = true;
            } else if (selectedDataSourceType === 'ai-model') {
                // For AI model, check if a model is selected
                isStep2Valid = selectedAiModel !== null && selectedAiModel !== '';
            }
            
            // Update Next button state only if we're on step 2
            const nextStepBtn = document.getElementById('next-step-btn');
            if (nextStepBtn) {
                nextStepBtn.disabled = !isStep2Valid;
                nextStepBtn.classList.toggle('opacity-50', !isStep2Valid);
                nextStepBtn.classList.toggle('cursor-not-allowed', !isStep2Valid);
            }
        }

        function validateStep3() {
            // Get the current visualization configuration based on selected type
            
            if (!selectedVisualizationType) {
                // No visualization type selected
                const nextStepBtn = document.getElementById('next-step-btn');
                if (nextStepBtn) {
                    nextStepBtn.disabled = true;
                    nextStepBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
                return;
            }

            let isStep3Valid = false;

            if (selectedVisualizationType === 'chart') {
                // For chart, check if a subtype is selected
                isStep3Valid = selectedChartSubtype !== null && selectedChartSubtype !== '';
            } else if (selectedVisualizationType === 'map-layer') {
                // For map layer, check if a subtype is selected
                isStep3Valid = selectedMapLayerSubtype !== null && selectedMapLayerSubtype !== '';
            } else if (selectedVisualizationType === 'kpi') {
                // For KPI, no subtype needed, so it's valid if the type is selected
                isStep3Valid = true;
            }
            
            // Also check if data mapping is complete
            if (isStep3Valid) {
                isStep3Valid = validateStep3DataMapping();
            }
            
            // Update Next button state only if we're on step 3
            const nextStepBtn = document.getElementById('next-step-btn');
            if (nextStepBtn) {
                nextStepBtn.disabled = !isStep3Valid;
                nextStepBtn.classList.toggle('opacity-50', !isStep3Valid);
                nextStepBtn.classList.toggle('cursor-not-allowed', !isStep3Valid);
            }
        }

        // Global validation functions
        function validateStep1Fields() {
            const componentName = document.getElementById('component-name');
            const componentDescription = document.getElementById('component-description');
            const componentCategory = document.getElementById('component-category');
            
            if (componentName && componentDescription && componentCategory) {
                const isNameValid = componentName.value.trim() !== '';
                const isDescriptionValid = componentDescription.value.trim() !== '';
                const isCategoryValid = componentCategory.value !== '';
                
                return isNameValid && isDescriptionValid && isCategoryValid;
            }
            return false;
        }

        function validateStep2Fields() {
            // Check if a data source type is selected
            
            if (!selectedDataSourceType) {
                return false;
            }

            // Validate based on selected type
            if (selectedDataSourceType === 'database') {
                return selectedDatabase !== null;
            } else if (selectedDataSourceType === 'api') {
                return selectedApi !== null;
            } else if (selectedDataSourceType === 'file-upload') {
                // For file upload, we'll consider it valid if a file is selected
                // Since this is a drag & drop area, we'll set it as valid by default
                return true;
            } else if (selectedDataSourceType === 'ai-model') {
                // For AI model, check if a model is selected
                const isValid = selectedAiModel !== null && selectedAiModel !== '';
                return isValid;
            }
            
            return false;
        }

        function validateStep3Fields() {
            // Check if a visualization type is selected
            if (!selectedVisualizationType) {
                return false;
            }

            // Validate based on selected type
            if (selectedVisualizationType === 'chart') {
                return selectedChartSubtype !== null && selectedChartSubtype !== '';
            } else if (selectedVisualizationType === 'map-layer') {
                return selectedMapLayerSubtype !== null && selectedMapLayerSubtype !== '';
            } else if (selectedVisualizationType === 'kpi') {
                // KPI doesn't need a subtype, so it's valid if the type is selected
                return true;
            }
            
            return false;
        }

        function validateStep3DataMapping() {
            // Check if data mapping fields are selected based on visualization type
            if (selectedVisualizationType === 'chart') {
                if (selectedChartSubtype === 'horizontal-bar') {
                    return selectedYAxisField !== null && selectedYAxisField !== '' && 
                           selectedSeriesFields.length > 0;
                } else if (selectedChartSubtype === 'vertical-bar') {
                    return selectedXAxisField !== null && selectedXAxisField !== '' && 
                           selectedSeriesFields.length > 0;
                } else if (selectedChartSubtype === 'line' || selectedChartSubtype === 'area' || selectedChartSubtype === 'scatter-plot') {
                    return selectedXAxisField !== null && selectedXAxisField !== '' && 
                           selectedSeriesFields.length > 0;
                } else if (selectedChartSubtype === 'donut' || selectedChartSubtype === 'radial') {
                    return selectedLabelField !== null && selectedLabelField !== '' && 
                           selectedValueField !== null && selectedValueField !== '';
                }
            } else if (selectedVisualizationType === 'map-layer') {
                return selectedXAxisField !== null && selectedXAxisField !== '' && 
                       selectedYAxisField !== null && selectedYAxisField !== '';
            } else if (selectedVisualizationType === 'kpi') {
                return selectedKpiField !== null && selectedKpiField !== '';
            }
            return false;
        }

        function validateStep4Fields() {
            // Step 4 validation - Filters
            // If no filters are added, it's valid (optional)
            if (selectedFilterFields.length === 0) {
                return true;
            }
            
            // If filters are added, check that all have mappings
            const filterItems = document.querySelectorAll('.filter-item');
            for (let item of filterItems) {
                const mappedField = item.getAttribute('data-mapped-field');
                if (!mappedField || mappedField === '') {
                    return false;
                }
            }
            
            return true;
        }

        function validateStep5Fields() {
            // Step 5 validation - Access (always valid as it's optional)
            return true;
        }

        // Filter Functions
        function updateFilterDropdown(id) {
            const dropdown = document.getElementById(id + '-dropdown');
            if (!dropdown) return;

            // Clear existing options
            dropdown.innerHTML = '';

            const options = JSON.parse(dropdown.dataset.options || '[]');

            options.forEach(option => {
                const optionDiv = document.createElement('div');
                const isSelected = selectedFilterFields.includes(option.id);
                
                if (isSelected) {
                    optionDiv.className = 'px-4 py-3 text-sm text-gray-500 cursor-not-allowed';
                    optionDiv.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="h-8 w-8 rounded-md bg-gray-600 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-gray-400 text-lg">${option.icon}</span>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-400">${option.name}</div>
                                    <div class="text-xs text-gray-500">${option.namespace}</div>
                                </div>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-700 text-gray-500">${option.type}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-xs text-gray-500">Already added</span>
                            </div>
                        </div>
                    `;
                } else {
                    optionDiv.className = 'px-4 py-3 hover:bg-gray-700 cursor-pointer text-sm text-white transition duration-200';
                    optionDiv.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="h-8 w-8 rounded-md bg-gray-600 flex items-center justify-center">
                                    <span class="material-symbols-outlined text-white text-lg">${option.icon}</span>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-white">${option.name}</div>
                                    <div class="text-xs text-gray-400">${option.namespace}</div>
                                </div>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-600 text-gray-300">${option.type}</span>
                            </div>
                        </div>
                    `;
                    optionDiv.addEventListener('click', function() {
                        selectedFilterFields.push(option.id);
                        updateFilterList();
                        updateFilterDropdown(id);
                        toggleFilterDropdown(id);
                        validateStep4Fields();
                        updateWizardState();
                    });
                }
                
                dropdown.appendChild(optionDiv);
            });
        }

        function toggleFilterDropdown(id) {
            const dropdown = document.getElementById(id + '-dropdown');
            const button = document.getElementById(id + '-btn');
            
            if (dropdown.classList.contains('hidden')) {
                // Close any other open dropdowns
                document.querySelectorAll('[id$="-dropdown"]').forEach(d => {
                    if (d !== dropdown) {
                        d.classList.add('hidden');
                    }
                });
                
                // Update dropdown options before showing
                updateFilterDropdown(id);
                
                // Show this dropdown
                dropdown.classList.remove('hidden');
            } else {
                // Hide dropdown
                dropdown.classList.add('hidden');
            }
        }

        function updateFilterList() {
            const listContainer = document.getElementById('filter-field-list');
            const removeAllBtn = document.getElementById('filter-field-remove-all');
            if (!listContainer) return;

            // Store current mapping values before clearing
            const currentMappings = {};
            const existingItems = listContainer.querySelectorAll('.filter-item');
            existingItems.forEach((item, index) => {
                const mappedField = item.getAttribute('data-mapped-field');
                if (mappedField && mappedField !== '') {
                    currentMappings[index] = mappedField;
                }
            });

            // Clear existing list
            listContainer.innerHTML = '';

            if (selectedFilterFields.length === 0) {
                // Hide Remove All button
                if (removeAllBtn) {
                    removeAllBtn.classList.add('hidden');
                }
                return;
            }

            // Show Remove All button
            if (removeAllBtn) {
                removeAllBtn.classList.remove('hidden');
            }

            // Create list items
            selectedFilterFields.forEach((field, index) => {
                const listItem = createFilterListItem(field, index);
                
                // Restore mapping value if it exists
                if (currentMappings[index]) {
                    const selectElement = listItem.querySelector('select');
                    if (selectElement) {
                        selectElement.value = currentMappings[index];
                        listItem.setAttribute('data-mapped-field', currentMappings[index]);
                    }
                }
                
                listContainer.appendChild(listItem);
            });

            // Add drag and drop functionality
            makeFilterListSortable(listContainer);
        }

        function createFilterListItem(field, index) {
            // Map filter IDs to their metadata
            const filterMetadata = {
                'date_range_filter': {
                    name: 'Date Range Filter',
                    type: 'DateRange',
                    icon: 'date_range',
                    namespace: 'date_range_filter'
                },
                'location_filter': {
                    name: 'Location Filter',
                    type: 'Lookup',
                    icon: 'location_on',
                    namespace: 'location_filter'
                },
                'category_filter': {
                    name: 'Category Filter',
                    type: 'Dropdown',
                    icon: 'category',
                    namespace: 'category_filter'
                },
                'range_slider_filter': {
                    name: 'Range Slider Filter',
                    type: 'Slider',
                    icon: 'tune',
                    namespace: 'range_slider_filter'
                },
                'user_filter': {
                    name: 'User Filter',
                    type: 'Text',
                    icon: 'person',
                    namespace: 'user_filter'
                }
            };

            const metadata = filterMetadata[field] || { name: field, type: 'Unknown', icon: 'filter_list', namespace: field };

            const itemDiv = document.createElement('div');
            itemDiv.className = 'filter-item flex items-center justify-between bg-gray-700 border border-gray-600 rounded-md px-3 py-2 cursor-move hover:bg-gray-600 transition duration-200';
            itemDiv.setAttribute('data-index', index);
            itemDiv.setAttribute('draggable', 'true');
            itemDiv.setAttribute('data-mapped-field', '');
            
            const gripIcon = document.createElement('span');
            gripIcon.className = 'material-symbols-outlined text-gray-400 text-sm mr-2 cursor-move';
            gripIcon.textContent = 'drag_indicator';
            
            const filterInfo = document.createElement('div');
            filterInfo.className = 'flex items-center space-x-3 flex-1';
            filterInfo.innerHTML = `
                <div class="h-8 w-8 rounded-md bg-gray-600 flex items-center justify-center">
                    <span class="material-symbols-outlined text-white text-lg">${metadata.icon}</span>
                </div>
                <div class="flex-1">
                    <div class="flex items-center">
                        <div class="mr-3">
                            <div class="text-sm font-medium text-white">${metadata.name}</div>
                            <div class="text-xs text-gray-400">${metadata.namespace}</div>
                        </div>
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-600 text-gray-300">${metadata.type}</span>
                    </div>
                </div>
            `;
            
            // Add data field mapping dropdown
            const mappingContainer = document.createElement('div');
            mappingContainer.className = 'flex items-center space-x-2 ml-4 relative';
            
            const mappingLabel = document.createElement('label');
            mappingLabel.className = 'text-xs text-gray-400 whitespace-nowrap';
            mappingLabel.textContent = 'Map to:';
            
            const mappingSelect = document.createElement('select');
            mappingSelect.className = 'bg-gray-800 border border-gray-600 rounded-md px-2 py-1 pr-8 text-xs text-white focus:outline-none focus:ring-1 focus:ring-red-500 appearance-none';
            mappingSelect.style.minWidth = '120px';
            
            // Add options to the dropdown
            const dataFields = [
                { value: '', label: 'Select field' },
                { value: 'date', label: 'Date' },
                { value: 'time', label: 'Time' },
                { value: 'timestamp', label: 'Timestamp' },
                { value: 'category', label: 'Category' },
                { value: 'region', label: 'Region' },
                { value: 'grid_id', label: 'Grid ID' },
                { value: 'longitude', label: 'Longitude' },
                { value: 'latitude', label: 'Latitude' },
                { value: 'population_count', label: 'Population Count' },
                { value: 'area_size_km2', label: 'Area Size (km)' },
                { value: 'population_density', label: 'Population Density' },
                { value: 'sales', label: 'Sales' },
                { value: 'revenue', label: 'Revenue' },
                { value: 'quantity', label: 'Quantity' },
                { value: 'end_longitude', label: 'End Longitude' },
                { value: 'end_latitude', label: 'End Latitude' },
                { value: 'distance', label: 'Distance' }
            ];
            
            dataFields.forEach(field => {
                const option = document.createElement('option');
                option.value = field.value;
                option.textContent = field.label;
                mappingSelect.appendChild(option);
            });
            
            // Add change event listener to store the mapping
            mappingSelect.addEventListener('change', function() {
                itemDiv.setAttribute('data-mapped-field', this.value);
                validateStep4Fields();
                updateWizardState();
            });
            
            mappingContainer.appendChild(mappingLabel);
            mappingContainer.appendChild(mappingSelect);
            
            // Add chevron icon container
            const chevronContainer = document.createElement('div');
            chevronContainer.className = 'absolute inset-y-0 right-0 flex items-center pr-1 pointer-events-none';
            chevronContainer.innerHTML = '<span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>';
            

            
            // Add the chevron to the mapping container
            mappingContainer.appendChild(chevronContainer);
            
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'text-red-400 hover:text-red-300 transition duration-200 ml-3';
            removeBtn.innerHTML = '<span class="material-symbols-outlined text-sm">close</span>';
            removeBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                selectedFilterFields.splice(index, 1);
                updateFilterList();
                validateStep4Fields();
                updateWizardState();
            });
            
            itemDiv.appendChild(gripIcon);
            itemDiv.appendChild(filterInfo);
            itemDiv.appendChild(mappingContainer);
            itemDiv.appendChild(removeBtn);
            
            return itemDiv;
        }

        function makeFilterListSortable(container) {
            let draggedItem = null;
            let draggedIndex = null;

            container.addEventListener('dragstart', function(e) {
                draggedItem = e.target;
                draggedIndex = parseInt(e.target.getAttribute('data-index'));
                e.target.style.opacity = '0.5';
            });

            container.addEventListener('dragend', function(e) {
                e.target.style.opacity = '';
                draggedItem = null;
                draggedIndex = null;
            });

            container.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                if (afterElement == null) {
                    container.appendChild(draggedItem);
                } else {
                    container.insertBefore(draggedItem, afterElement);
                }
            });

            container.addEventListener('drop', function(e) {
                e.preventDefault();
                const dropIndex = parseInt(e.target.closest('.filter-item').getAttribute('data-index'));
                
                if (draggedIndex !== null && dropIndex !== null && draggedIndex !== dropIndex) {
                    const item = selectedFilterFields[draggedIndex];
                    selectedFilterFields.splice(draggedIndex, 1);
                    selectedFilterFields.splice(dropIndex, 0, item);
                    
                    // Update data-index attributes
                    container.querySelectorAll('.filter-item').forEach((item, index) => {
                        item.setAttribute('data-index', index);
                    });
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.filter-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function generateDataMappingFields() {
            const fieldsContainer = document.getElementById('data-mapping-fields');
            if (!fieldsContainer) return;

            // Clear existing fields
            fieldsContainer.innerHTML = '';

            if (selectedVisualizationType === 'chart') {
                generateChartMappingFields(fieldsContainer);
            } else if (selectedVisualizationType === 'map-layer') {
                generateMapLayerMappingFields(fieldsContainer);
            } else if (selectedVisualizationType === 'kpi') {
                generateKpiMappingFields(fieldsContainer);
            }
        }

        function generateChartMappingFields(container) {
            const chartFields = {
                'horizontal-bar': {
                    yAxis: 'Y-Axis',
                    series: 'Series',
                    yOptions: ['category', 'region', 'date', 'grid_id'],
                    seriesOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']
                },
                'vertical-bar': {
                    xAxis: 'X-Axis',
                    series: 'Series',
                    xOptions: ['category', 'region', 'date', 'grid_id'],
                    seriesOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']
                },
                'line': {
                    xAxis: 'X-Axis',
                    series: 'Series',
                    xOptions: ['date', 'time', 'timestamp', 'category', 'region'],
                    seriesOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']
                },
                'area': {
                    xAxis: 'X-Axis',
                    series: 'Series',
                    xOptions: ['date', 'time', 'timestamp', 'category', 'region'],
                    seriesOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']
                },
                'scatter-plot': {
                    xAxis: 'X-Axis',
                    series: 'Series',
                    xOptions: ['longitude', 'latitude', 'population_count', 'area_size_km2', 'sales', 'revenue'],
                    seriesOptions: ['latitude', 'longitude', 'population_density', 'quantity', 'sales', 'revenue']
                },
                'donut': {
                    label: 'Label',
                    value: 'Value',
                    labelOptions: ['category', 'region', 'grid_id'],
                    valueOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']
                },
                'radial': {
                    label: 'Label',
                    value: 'Value',
                    labelOptions: ['category', 'region', 'grid_id'],
                    valueOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']
                }
            };

            const config = chartFields[selectedChartSubtype];
            if (!config) return;

            if (selectedChartSubtype === 'horizontal-bar') {
                // Create tabs structure for Horizontal Bar
                const tabsContainer = document.createElement('div');
                tabsContainer.className = 'flex border border-gray-700 rounded-lg h-full overflow-hidden';
                tabsContainer.style.minHeight = '400px';

                // Visual Property Tabs
                const tabsSidebar = document.createElement('div');
                tabsSidebar.className = 'flex flex-col w-52 p-3 bg-gray-800 border-r border-gray-700';
                
                const tabsList = document.createElement('div');
                tabsList.className = 'flex-1 space-y-2';

                // Y-Axis Tab
                const yAxisTab = document.createElement('div');
                yAxisTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-blue-600 text-white rounded-lg transition duration-200 cursor-pointer';
                yAxisTab.setAttribute('data-visual-tab', 'y-axis');
                yAxisTab.innerHTML = `
                    <span class="text-sm font-medium">Y-Axis</span>
                `;
                tabsList.appendChild(yAxisTab);

                // Series Tab
                const seriesTab = document.createElement('div');
                seriesTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200';
                seriesTab.setAttribute('data-visual-tab', 'series');
                seriesTab.innerHTML = `
                    <span class="text-sm font-medium">Series</span>
                `;
                tabsList.appendChild(seriesTab);

                // Legend Tab
                const legendTab = document.createElement('div');
                legendTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200';
                legendTab.setAttribute('data-visual-tab', 'legend');
                legendTab.innerHTML = `
                    <span class="text-sm font-medium">Legend</span>
                `;
                tabsList.appendChild(legendTab);

                tabsSidebar.appendChild(tabsList);
                tabsContainer.appendChild(tabsSidebar);

                // Tab Content Container
                const tabContentContainer = document.createElement('div');
                tabContentContainer.className = 'flex-1 p-4 overflow-auto';

                // Y-Axis Tab Content
                const yAxisContent = document.createElement('div');
                yAxisContent.id = 'y-axis-tab-content';
                yAxisContent.className = 'visual-tab-content space-y-6';
                yAxisContent.innerHTML = `
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Data Field</label>
                        <div class="max-w-md">
                            <div class="relative">
                                <select id="y-axis-data-field-select" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none" onchange="selectYAxisDataField(this.value)">
                                    <option value="">Select data field</option>
                                    ${config.yOptions.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Axis Order</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="y-axis-reverse-order" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Reverse Order</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Gridlines</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="y-axis-major-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Gridlines</span>
                            </label>
                        </div>
                    </div>
                `;
                tabContentContainer.appendChild(yAxisContent);

                // Series Tab Content
                const seriesContent = document.createElement('div');
                seriesContent.id = 'series-tab-content';
                seriesContent.className = 'visual-tab-content hidden space-y-6';
                
                // Create the Add Series field structure
                const seriesFieldDiv = document.createElement('div');
                seriesFieldDiv.className = 'relative';
                
                // Header with label and remove all button
                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex items-center justify-between mb-3';
                
                const label = document.createElement('label');
                label.className = 'text-sm font-medium text-gray-300';
                label.textContent = 'Series Fields';
                
                const removeAllBtn = document.createElement('button');
                removeAllBtn.type = 'button';
                removeAllBtn.id = 'series-field-remove-all';
                removeAllBtn.className = 'text-red-400 hover:text-red-300 text-xs font-medium transition duration-200 hidden';
                removeAllBtn.textContent = 'Remove All';
                removeAllBtn.addEventListener('click', function() {
                    selectedSeriesFields = [];
                    updateSeriesList();
                    validateStep3();
                    updateWizardState();
                });
                
                headerDiv.appendChild(label);
                headerDiv.appendChild(removeAllBtn);
                seriesFieldDiv.appendChild(headerDiv);
                
                // Series list container
                const listContainer = document.createElement('div');
                listContainer.id = 'series-field-list';
                listContainer.className = 'space-y-2 mb-3';
                seriesFieldDiv.appendChild(listContainer);
                
                // Add Series dropdown button
                const addSeriesBtn = document.createElement('button');
                addSeriesBtn.type = 'button';
                addSeriesBtn.id = 'series-field-btn';
                addSeriesBtn.className = 'bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md transition duration-200 flex items-center space-x-2 text-sm';
                addSeriesBtn.innerHTML = '<span class="material-symbols-outlined">add</span><span>Add Series Field</span>';
                addSeriesBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleSeriesDropdown('series-field');
                });
                
                // Dropdown container
                const dropdownContainer = document.createElement('div');
                dropdownContainer.id = 'series-field-dropdown';
                dropdownContainer.className = 'absolute z-50 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto hidden mt-2';
                dropdownContainer.style.width = '100%';
                dropdownContainer.style.maxWidth = '400px';
                
                // Store options for later use
                dropdownContainer.dataset.options = JSON.stringify(config.seriesOptions);
                
                // Position the dropdown relative to the button
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'relative';
                buttonContainer.appendChild(addSeriesBtn);
                buttonContainer.appendChild(dropdownContainer);
                seriesFieldDiv.appendChild(buttonContainer);
                
                seriesContent.appendChild(seriesFieldDiv);
                
                // Add configuration fields to Series tab
                const configDiv = document.createElement('div');
                configDiv.className = 'space-y-6';
                configDiv.innerHTML = `
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Color Palette</label>
                        <div class="relative">
                            <button id="series-color-palette-btn" class="w-full bg-gray-800 border border-gray-600 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div id="series-color-palette-preview" class="w-8 h-4 rounded bg-gradient-to-r from-teal-400 via-orange-400 to-pink-400"></div>
                                    <span id="series-color-palette-selected">Default</span>
                                </div>
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </button>
                            <div id="series-color-palette-dropdown" class="absolute top-full left-0 mt-2 bg-gray-800 border border-gray-600 rounded-md shadow-lg hidden z-50 min-w-64 w-full">
                                <div class="p-2 space-y-1">
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="default">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-teal-400 via-orange-400 to-pink-400"></div>
                                        <span class="text-sm text-white">Default</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="red">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-red-300 via-red-500 to-red-700"></div>
                                        <span class="text-sm text-white">Red Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="blue">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-blue-300 via-blue-500 to-blue-700"></div>
                                        <span class="text-sm text-white">Blue Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="green">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-green-300 via-green-500 to-green-700"></div>
                                        <span class="text-sm text-white">Green Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="purple">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-purple-300 via-purple-500 to-purple-700"></div>
                                        <span class="text-sm text-white">Purple Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="orange">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-orange-300 via-orange-500 to-orange-700"></div>
                                        <span class="text-sm text-white">Orange Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="teal">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-teal-300 via-teal-500 to-teal-700"></div>
                                        <span class="text-sm text-white">Teal Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="pink">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-pink-300 via-pink-500 to-pink-700"></div>
                                        <span class="text-sm text-white">Pink Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="gray">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-gray-300 via-gray-500 to-gray-700"></div>
                                        <span class="text-sm text-white">Gray Theme</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-300 block mb-2">Minimum Value</label>
                                <input type="number" id="series-min-value" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0">
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-300 block mb-2">Maximum Value</label>
                                <input type="number" id="series-max-value" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="100">
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Scale Factor</label>
                        <div class="relative">
                            <select id="series-scale-factor" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="1">1x (No scaling)</option>
                                <option value="0.001">0.001x (Thousands)</option>
                                <option value="0.01">0.01x (Hundreds)</option>
                                <option value="0.1">0.1x (Tens)</option>
                                <option value="10">10x</option>
                                <option value="100">100x</option>
                                <option value="1000">1000x</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Number Format</label>
                        <div class="relative">
                            <select id="series-number-format" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="number">Number (1,234.56)</option>
                                <option value="currency">Currency ($1,234.56)</option>
                                <option value="percentage">Percentage (123.46%)</option>
                                <option value="decimal">Decimal (1234.56)</option>
                                <option value="integer">Integer (1235)</option>
                                <option value="scientific">Scientific (1.23e+3)</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Gridlines & Ticks</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="series-major-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Gridlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-minor-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Minor Gridlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-major-ticks" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Ticks</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-minor-ticks" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Minor Ticks</span>
                            </label>
                        </div>
                    </div>
                `;
                seriesContent.appendChild(configDiv);
                tabContentContainer.appendChild(seriesContent);

                // Legend Tab Content
                const legendContent = document.createElement('div');
                legendContent.id = 'legend-tab-content';
                legendContent.className = 'visual-tab-content hidden space-y-6';
                legendContent.innerHTML = `
                    <div class="max-w-md">
                        <div class="flex items-center space-x-3">
                            <button id="legend-show-legend" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-900" role="switch" aria-checked="false">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 translate-x-1"></span>
                            </button>
                            <span class="text-sm text-gray-300 cursor-pointer hover:text-gray-200">Show Legend</span>
                        </div>
                    </div>
                    
                    <div class="max-w-md" id="legend-position-container" style="display: none;">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Legend Position</label>
                        <div class="relative">
                            <select id="legend-position" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="auto">Auto</option>
                                <option value="top">Top</option>
                                <option value="bottom">Bottom</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                `;
                tabContentContainer.appendChild(legendContent);

                tabsContainer.appendChild(tabContentContainer);
                container.appendChild(tabsContainer);

                // Add event listeners for tab switching
                setTimeout(() => {
                    const tabButtons = tabsContainer.querySelectorAll('.visual-property-tab');
                    const tabContents = tabsContainer.querySelectorAll('.visual-tab-content');

                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const targetTab = button.getAttribute('data-visual-tab');
                            
                            // Update active tab button
                            tabButtons.forEach(btn => {
                                btn.className = btn.className.replace('bg-blue-600 text-white', 'bg-gray-700 hover:bg-gray-600 text-gray-300');
                            });
                            button.className = button.className.replace('bg-gray-700 hover:bg-gray-600 text-gray-300', 'bg-blue-600 text-white');
                            
                            // Show target tab content
                            tabContents.forEach(content => {
                                content.classList.add('hidden');
                            });
                            const targetContent = tabsContainer.querySelector(`#${targetTab}-tab-content`);
                            if (targetContent) {
                                targetContent.classList.remove('hidden');
                            }
                        });
                    });

                    // Initialize the Series list
                    updateSeriesDropdown('series-field');
                    updateSeriesList();

                    // Initialize Color Palette dropdown functionality
                    const colorPaletteBtn = document.getElementById('series-color-palette-btn');
                    const colorPaletteDropdown = document.getElementById('series-color-palette-dropdown');
                    const colorPaletteOptions = document.querySelectorAll('.color-palette-option');

                    if (colorPaletteBtn && colorPaletteDropdown) {
                        colorPaletteBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            colorPaletteDropdown.classList.toggle('hidden');
                        });

                        // Handle color palette option selection
                        colorPaletteOptions.forEach(option => {
                            option.addEventListener('click', function(e) {
                                e.stopPropagation();
                                const value = this.getAttribute('data-value');
                                const name = this.querySelector('span').textContent;
                                const preview = this.querySelector('div').cloneNode(true);
                                
                                // Update the button display
                                const selectedSpan = document.getElementById('series-color-palette-selected');
                                const previewDiv = document.getElementById('series-color-palette-preview');
                                
                                if (selectedSpan) selectedSpan.textContent = name;
                                if (previewDiv) {
                                    previewDiv.innerHTML = '';
                                    previewDiv.appendChild(preview);
                                }
                                
                                // Hide dropdown
                                colorPaletteDropdown.classList.add('hidden');
                            });
                        });

                        // Close dropdown when clicking outside
                        document.addEventListener('click', function(e) {
                            if (!colorPaletteBtn.contains(e.target) && !colorPaletteDropdown.contains(e.target)) {
                                colorPaletteDropdown.classList.add('hidden');
                            }
                        });
                    }

                    // Initialize Legend functionality
                    const showLegendToggle = document.getElementById('legend-show-legend');
                    const legendPositionContainer = document.getElementById('legend-position-container');

                    if (showLegendToggle && legendPositionContainer) {
                        // Function to toggle legend state
                        function toggleLegendState() {
                            const isChecked = showLegendToggle.getAttribute('aria-checked') === 'true';
                            const newState = !isChecked;
                            
                            // Update toggle state
                            showLegendToggle.setAttribute('aria-checked', newState.toString());
                            
                            // Update toggle appearance
                            const toggleCircle = showLegendToggle.querySelector('span');
                            if (newState) {
                                showLegendToggle.classList.remove('bg-gray-700');
                                showLegendToggle.classList.add('bg-red-500');
                                toggleCircle.classList.remove('translate-x-1');
                                toggleCircle.classList.add('translate-x-6');
                                legendPositionContainer.style.display = 'block';
                            } else {
                                showLegendToggle.classList.remove('bg-red-500');
                                showLegendToggle.classList.add('bg-gray-700');
                                toggleCircle.classList.remove('translate-x-6');
                                toggleCircle.classList.add('translate-x-1');
                                legendPositionContainer.style.display = 'none';
                            }
                        }

                        // Add click event to toggle button
                        showLegendToggle.addEventListener('click', toggleLegendState);

                        // Add click event to the label text
                        const legendLabel = showLegendToggle.nextElementSibling;
                        if (legendLabel) {
                            legendLabel.addEventListener('click', toggleLegendState);
                        }
                    }

                }, 100);

            } else if (selectedChartSubtype === 'vertical-bar') {
                // Create tabs structure for Vertical Bar
                const tabsContainer = document.createElement('div');
                tabsContainer.className = 'flex border border-gray-700 rounded-lg h-full overflow-hidden';
                tabsContainer.style.minHeight = '400px';

                // Visual Property Tabs
                const tabsSidebar = document.createElement('div');
                tabsSidebar.className = 'flex flex-col w-52 p-3 bg-gray-800 border-r border-gray-700';
                
                const tabsList = document.createElement('div');
                tabsList.className = 'flex-1 space-y-2';

                // X-Axis Tab
                const xAxisTab = document.createElement('div');
                xAxisTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-blue-600 text-white rounded-lg transition duration-200 cursor-pointer';
                xAxisTab.setAttribute('data-visual-tab', 'x-axis');
                xAxisTab.innerHTML = `
                    <span class="text-sm font-medium">X-Axis</span>
                `;
                tabsList.appendChild(xAxisTab);

                // Series Tab
                const seriesTab = document.createElement('div');
                seriesTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200';
                seriesTab.setAttribute('data-visual-tab', 'series');
                seriesTab.innerHTML = `
                    <span class="text-sm font-medium">Series</span>
                `;
                tabsList.appendChild(seriesTab);

                // Legend Tab
                const legendTab = document.createElement('div');
                legendTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200';
                legendTab.setAttribute('data-visual-tab', 'legend');
                legendTab.innerHTML = `
                    <span class="text-sm font-medium">Legend</span>
                `;
                tabsList.appendChild(legendTab);

                tabsSidebar.appendChild(tabsList);
                tabsContainer.appendChild(tabsSidebar);

                // Tab Content Container
                const tabContentContainer = document.createElement('div');
                tabContentContainer.className = 'flex-1 p-4 overflow-auto';

                // X-Axis Tab Content
                const xAxisContent = document.createElement('div');
                xAxisContent.id = 'x-axis-tab-content';
                xAxisContent.className = 'visual-tab-content space-y-6';
                xAxisContent.innerHTML = `
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Data Field</label>
                        <div class="max-w-md">
                            <div class="relative">
                                <select id="x-axis-data-field-select" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none" onchange="selectXAxisDataField(this.value)">
                                    <option value="">Select data field</option>
                                    ${config.xOptions.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Axis Order</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="x-axis-reverse-order" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Reverse Order</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Gridlines</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="x-axis-major-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Gridlines</span>
                            </label>
                        </div>
                    </div>
                `;
                tabContentContainer.appendChild(xAxisContent);

                // Series Tab Content
                const seriesContent = document.createElement('div');
                seriesContent.id = 'series-tab-content';
                seriesContent.className = 'visual-tab-content hidden space-y-6';
                
                // Create the Add Series field structure
                const seriesFieldDiv = document.createElement('div');
                seriesFieldDiv.className = 'relative';
                
                // Header with label and remove all button
                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex items-center justify-between mb-3';
                
                const label = document.createElement('label');
                label.className = 'text-sm font-medium text-gray-300';
                label.textContent = 'Series Fields';
                
                const removeAllBtn = document.createElement('button');
                removeAllBtn.type = 'button';
                removeAllBtn.id = 'series-field-remove-all';
                removeAllBtn.className = 'text-red-400 hover:text-red-300 text-xs font-medium transition duration-200 hidden';
                removeAllBtn.textContent = 'Remove All';
                removeAllBtn.addEventListener('click', function() {
                    selectedSeriesFields = [];
                    updateSeriesList();
                    validateStep3();
                    updateWizardState();
                });
                
                headerDiv.appendChild(label);
                headerDiv.appendChild(removeAllBtn);
                seriesFieldDiv.appendChild(headerDiv);
                
                // Series list container
                const listContainer = document.createElement('div');
                listContainer.id = 'series-field-list';
                listContainer.className = 'space-y-2 mb-3';
                seriesFieldDiv.appendChild(listContainer);
                
                // Add Series dropdown button
                const addSeriesBtn = document.createElement('button');
                addSeriesBtn.type = 'button';
                addSeriesBtn.id = 'series-field-btn';
                addSeriesBtn.className = 'bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md transition duration-200 flex items-center space-x-2 text-sm';
                addSeriesBtn.innerHTML = '<span class="material-symbols-outlined">add</span><span>Add Series Field</span>';
                addSeriesBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleSeriesDropdown('series-field');
                });
                
                // Dropdown container
                const dropdownContainer = document.createElement('div');
                dropdownContainer.id = 'series-field-dropdown';
                dropdownContainer.className = 'absolute z-50 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto hidden mt-2';
                dropdownContainer.style.width = '100%';
                dropdownContainer.style.maxWidth = '400px';
                
                // Store options for later use
                dropdownContainer.dataset.options = JSON.stringify(config.seriesOptions);
                
                // Position the dropdown relative to the button
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'relative';
                buttonContainer.appendChild(addSeriesBtn);
                buttonContainer.appendChild(dropdownContainer);
                seriesFieldDiv.appendChild(buttonContainer);
                
                seriesContent.appendChild(seriesFieldDiv);
                
                // Add configuration fields to Series tab
                const configDiv = document.createElement('div');
                configDiv.className = 'space-y-6';
                configDiv.innerHTML = `
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Color Palette</label>
                        <div class="relative">
                            <button id="series-color-palette-btn" class="w-full bg-gray-800 border border-gray-600 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div id="series-color-palette-preview" class="w-8 h-4 rounded bg-gradient-to-r from-teal-400 via-orange-400 to-pink-400"></div>
                                    <span id="series-color-palette-selected">Default</span>
                                </div>
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </button>
                            <div id="series-color-palette-dropdown" class="absolute top-full left-0 mt-2 bg-gray-800 border border-gray-600 rounded-md shadow-lg hidden z-50 min-w-64 w-full">
                                <div class="p-2 space-y-1">
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="default">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-teal-400 via-orange-400 to-pink-400"></div>
                                        <span class="text-sm text-white">Default</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="red">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-red-300 via-red-500 to-red-700"></div>
                                        <span class="text-sm text-white">Red Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="blue">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-blue-300 via-blue-500 to-blue-700"></div>
                                        <span class="text-sm text-white">Blue Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="green">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-green-300 via-green-500 to-green-700"></div>
                                        <span class="text-sm text-white">Green Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="purple">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-purple-300 via-purple-500 to-purple-700"></div>
                                        <span class="text-sm text-white">Purple Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="orange">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-orange-300 via-orange-500 to-orange-700"></div>
                                        <span class="text-sm text-white">Orange Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="teal">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-teal-300 via-teal-500 to-teal-700"></div>
                                        <span class="text-sm text-white">Teal Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="pink">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-pink-300 via-pink-500 to-pink-700"></div>
                                        <span class="text-sm text-white">Pink Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="gray">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-gray-300 via-gray-500 to-gray-700"></div>
                                        <span class="text-sm text-white">Gray Theme</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-300 block mb-2">Minimum Value</label>
                                <input type="number" id="series-min-value" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0">
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-300 block mb-2">Maximum Value</label>
                                <input type="number" id="series-max-value" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="100">
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Scale Factor</label>
                        <div class="relative">
                            <select id="series-scale-factor" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="1">1x (No scaling)</option>
                                <option value="0.001">0.001x (Thousands)</option>
                                <option value="0.01">0.01x (Hundreds)</option>
                                <option value="0.1">0.1x (Tens)</option>
                                <option value="10">10x</option>
                                <option value="100">100x</option>
                                <option value="1000">1000x</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Number Format</label>
                        <div class="relative">
                            <select id="series-number-format" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="number">Number (1,234.56)</option>
                                <option value="currency">Currency ($1,234.56)</option>
                                <option value="percentage">Percentage (123.46%)</option>
                                <option value="decimal">Decimal (1234.56)</option>
                                <option value="integer">Integer (1235)</option>
                                <option value="scientific">Scientific (1.23e+3)</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Gridlines & Ticks</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="series-major-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Gridlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-minor-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Minor Gridlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-major-ticks" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Ticks</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-minor-ticks" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Minor Ticks</span>
                            </label>
                        </div>
                    </div>
                `;
                seriesContent.appendChild(configDiv);
                tabContentContainer.appendChild(seriesContent);


                // Legend Tab Content
                const legendContent = document.createElement('div');
                legendContent.id = 'legend-tab-content';
                legendContent.className = 'visual-tab-content hidden space-y-6';
                legendContent.innerHTML = `
                    <div class="max-w-md">
                        <div class="flex items-center space-x-3">
                            <button id="legend-show-legend" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-900" role="switch" aria-checked="false">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 translate-x-1"></span>
                            </button>
                            <span class="text-sm text-gray-300 cursor-pointer hover:text-gray-200">Show Legend</span>
                        </div>
                    </div>
                    
                    <div class="max-w-md" id="legend-position-container" style="display: none;">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Legend Position</label>
                        <div class="relative">
                            <select id="legend-position" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="auto">Auto</option>
                                <option value="top">Top</option>
                                <option value="bottom">Bottom</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                `;
                tabContentContainer.appendChild(legendContent);
                tabsContainer.appendChild(tabContentContainer);
                container.appendChild(tabsContainer);

                // Add event listeners for tab switching
                setTimeout(() => {
                    const tabButtons = tabsContainer.querySelectorAll('.visual-property-tab');
                    const tabContents = tabsContainer.querySelectorAll('.visual-tab-content');

                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const targetTab = button.getAttribute('data-visual-tab');
                            
                            // Update active tab button
                            tabButtons.forEach(btn => {
                                btn.className = btn.className.replace('bg-blue-600 text-white', 'bg-gray-700 hover:bg-gray-600 text-gray-300');
                            });
                            button.className = button.className.replace('bg-gray-700 hover:bg-gray-600 text-gray-300', 'bg-blue-600 text-white');
                            
                            // Show target tab content
                            tabContents.forEach(content => {
                                content.classList.add('hidden');
                            });
                            const targetContent = tabsContainer.querySelector(`#${targetTab}-tab-content`);
                            if (targetContent) {
                                targetContent.classList.remove('hidden');
                            }
                        });
                    });

                    // Initialize the Series list
                    updateSeriesDropdown('series-field');
                    updateSeriesList();

                    // Initialize Color Palette dropdown functionality
                    const colorPaletteBtn = document.getElementById('series-color-palette-btn');
                    const colorPaletteDropdown = document.getElementById('series-color-palette-dropdown');
                    const colorPaletteOptions = document.querySelectorAll('.color-palette-option');

                    if (colorPaletteBtn && colorPaletteDropdown) {
                        colorPaletteBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            colorPaletteDropdown.classList.toggle('hidden');
                        });

                        // Handle color palette option selection
                        colorPaletteOptions.forEach(option => {
                            option.addEventListener('click', function(e) {
                                e.stopPropagation();
                                const value = this.getAttribute('data-value');
                                const name = this.querySelector('span').textContent;
                                const preview = this.querySelector('div').cloneNode(true);
                                
                                // Update the button display
                                const selectedSpan = document.getElementById('series-color-palette-selected');
                                const previewDiv = document.getElementById('series-color-palette-preview');
                                
                                if (selectedSpan) selectedSpan.textContent = name;
                                if (previewDiv) {
                                    previewDiv.innerHTML = '';
                                    previewDiv.appendChild(preview);
                                }
                                
                                // Hide dropdown
                                colorPaletteDropdown.classList.add('hidden');
                            });
                        });

                        // Close dropdown when clicking outside
                        document.addEventListener('click', function(e) {
                            if (!colorPaletteBtn.contains(e.target) && !colorPaletteDropdown.contains(e.target)) {
                                colorPaletteDropdown.classList.add('hidden');
                            }
                        });
                    }

                    // Initialize Legend functionality  
                    const showLegendToggle = document.getElementById('legend-show-legend');
                    const legendPositionContainer = document.getElementById('legend-position-container');

                    if (showLegendToggle && legendPositionContainer) {
                        // Function to toggle legend state
                        function toggleLegendState() {
                            const isChecked = showLegendToggle.getAttribute('aria-checked') === 'true';
                            const newState = !isChecked;
                            
                            // Update toggle state
                            showLegendToggle.setAttribute('aria-checked', newState.toString());
                            
                            // Update toggle appearance
                            const toggleCircle = showLegendToggle.querySelector('span');
                            if (newState) {
                                showLegendToggle.classList.remove('bg-gray-700');
                                showLegendToggle.classList.add('bg-red-500');
                                toggleCircle.classList.remove('translate-x-1');
                                toggleCircle.classList.add('translate-x-6');
                                legendPositionContainer.style.display = 'block';
                            } else {
                                showLegendToggle.classList.remove('bg-red-500');
                                showLegendToggle.classList.add('bg-gray-700');
                                toggleCircle.classList.remove('translate-x-6');
                                toggleCircle.classList.add('translate-x-1');
                                legendPositionContainer.style.display = 'none';
                            }
                        }

                        // Add click event to toggle button
                        showLegendToggle.addEventListener('click', toggleLegendState);

                        // Add click event to the label text
                        const legendLabel = showLegendToggle.nextElementSibling;
                        if (legendLabel) {
                            legendLabel.addEventListener('click', toggleLegendState);
                        }
                    }
                }, 100);

            } else if (selectedChartSubtype === 'line' || selectedChartSubtype === 'area' || selectedChartSubtype === 'scatter-plot') {
                // Create tabs structure for Line, Area, and Scatter Plot
                const tabsContainer = document.createElement('div');
                tabsContainer.className = 'flex border border-gray-700 rounded-lg h-full overflow-hidden';
                tabsContainer.style.minHeight = '400px';

                // Visual Property Tabs
                const tabsSidebar = document.createElement('div');
                tabsSidebar.className = 'flex flex-col w-52 p-3 bg-gray-800 border-r border-gray-700';
                
                const tabsList = document.createElement('div');
                tabsList.className = 'flex-1 space-y-2';

                // X-Axis Tab
                const xAxisTab = document.createElement('div');
                xAxisTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-blue-600 text-white rounded-lg transition duration-200 cursor-pointer';
                xAxisTab.setAttribute('data-visual-tab', 'x-axis');
                xAxisTab.innerHTML = `
                    <span class="text-sm font-medium">X-Axis</span>
                `;
                tabsList.appendChild(xAxisTab);

                // Series Tab
                const seriesTab = document.createElement('div');
                seriesTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200';
                seriesTab.setAttribute('data-visual-tab', 'series');
                seriesTab.innerHTML = `
                    <span class="text-sm font-medium">Series</span>
                `;
                tabsList.appendChild(seriesTab);

                // Legend Tab
                const legendTab = document.createElement('div');
                legendTab.className = 'visual-property-tab flex items-center py-2 px-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg cursor-pointer transition duration-200';
                legendTab.setAttribute('data-visual-tab', 'legend');
                legendTab.innerHTML = `
                    <span class="text-sm font-medium">Legend</span>
                `;
                tabsList.appendChild(legendTab);

                tabsSidebar.appendChild(tabsList);
                tabsContainer.appendChild(tabsSidebar);

                // Tab Content Container
                const tabContentContainer = document.createElement('div');
                tabContentContainer.className = 'flex-1 p-4 overflow-auto';

                // X-Axis Tab Content
                const xAxisContent = document.createElement('div');
                xAxisContent.id = 'x-axis-tab-content';
                xAxisContent.className = 'visual-tab-content space-y-6';
                xAxisContent.innerHTML = `
                    <div>
                        <label class="text-sm font-medium text-gray-300 block mb-2">Data Field</label>
                    <div class="max-w-md">
                            <div class="relative">
                                <select id="x-axis-data-field-select" class="w-full bg-gray-800 border border-gray-700 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none" onchange="selectXAxisDataField(this.value)">
                                    <option value="">Select data field</option>
                                    ${config.xOptions.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Axis Order</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="x-axis-reverse-order" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Reverse Order</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Gridlines</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="x-axis-major-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Gridlines</span>
                            </label>
                        </div>
                    </div>
                `;
                tabContentContainer.appendChild(xAxisContent);

                // Series Tab Content
                const seriesContent = document.createElement('div');
                seriesContent.id = 'series-tab-content';
                seriesContent.className = 'visual-tab-content hidden space-y-6';
                
                // Create the Add Series field structure
                const seriesFieldDiv = document.createElement('div');
                seriesFieldDiv.className = 'relative';
                
                // Header with label and remove all button
                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex items-center justify-between mb-3';
                
                const label = document.createElement('label');
                label.className = 'text-sm font-medium text-gray-300';
                label.textContent = 'Series Fields';
                
                const removeAllBtn = document.createElement('button');
                removeAllBtn.type = 'button';
                removeAllBtn.id = 'series-field-remove-all';
                removeAllBtn.className = 'text-red-400 hover:text-red-300 text-xs font-medium transition duration-200 hidden';
                removeAllBtn.textContent = 'Remove All';
                removeAllBtn.addEventListener('click', function() {
                    selectedSeriesFields = [];
                    updateSeriesList();
                    validateStep3();
                    updateWizardState();
                });
                
                headerDiv.appendChild(label);
                headerDiv.appendChild(removeAllBtn);
                seriesFieldDiv.appendChild(headerDiv);
                
                // Series list container
                const listContainer = document.createElement('div');
                listContainer.id = 'series-field-list';
                listContainer.className = 'space-y-2 mb-3';
                seriesFieldDiv.appendChild(listContainer);
                
                // Add Series dropdown button
                const addSeriesBtn = document.createElement('button');
                addSeriesBtn.type = 'button';
                addSeriesBtn.id = 'series-field-btn';
                addSeriesBtn.className = 'bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md transition duration-200 flex items-center space-x-2 text-sm';
                addSeriesBtn.innerHTML = '<span class="material-symbols-outlined">add</span><span>Add Series Field</span>';
                addSeriesBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleSeriesDropdown('series-field');
                });
                
                // Dropdown container
                const dropdownContainer = document.createElement('div');
                dropdownContainer.id = 'series-field-dropdown';
                dropdownContainer.className = 'absolute z-50 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto hidden mt-2';
                dropdownContainer.style.width = '100%';
                dropdownContainer.style.maxWidth = '400px';
                
                // Store options for later use
                dropdownContainer.dataset.options = JSON.stringify(config.seriesOptions);
                
                // Position the dropdown relative to the button
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'relative';
                buttonContainer.appendChild(addSeriesBtn);
                buttonContainer.appendChild(dropdownContainer);
                seriesFieldDiv.appendChild(buttonContainer);
                
                seriesContent.appendChild(seriesFieldDiv);
                
                // Add configuration fields to Series tab
                const configDiv = document.createElement('div');
                configDiv.className = 'space-y-6';
                configDiv.innerHTML = `
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Color Palette</label>
                        <div class="relative">
                            <button id="series-color-palette-btn" class="w-full bg-gray-800 border border-gray-600 hover:bg-gray-700 transition duration-200 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                                    <div id="series-color-palette-preview" class="w-8 h-4 rounded bg-gradient-to-r from-teal-400 via-orange-400 to-pink-400"></div>
                                    <span id="series-color-palette-selected">Default</span>
                                </div>
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </button>
                            <div id="series-color-palette-dropdown" class="absolute top-full left-0 mt-2 bg-gray-800 border border-gray-600 rounded-md shadow-lg hidden z-50 min-w-64 w-full">
                                <div class="p-2 space-y-1">
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="default">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-teal-400 via-orange-400 to-pink-400"></div>
                                        <span class="text-sm text-white">Default</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="red">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-red-300 via-red-500 to-red-700"></div>
                                        <span class="text-sm text-white">Red Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="blue">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-blue-300 via-blue-500 to-blue-700"></div>
                                        <span class="text-sm text-white">Blue Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="green">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-green-300 via-green-500 to-green-700"></div>
                                        <span class="text-sm text-white">Green Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="purple">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-purple-300 via-purple-500 to-purple-700"></div>
                                        <span class="text-sm text-white">Purple Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="orange">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-orange-300 via-orange-500 to-orange-700"></div>
                                        <span class="text-sm text-white">Orange Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="teal">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-teal-300 via-teal-500 to-teal-700"></div>
                                        <span class="text-sm text-white">Teal Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="pink">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-pink-300 via-pink-500 to-pink-700"></div>
                                        <span class="text-sm text-white">Pink Theme</span>
                                    </div>
                                    <div class="color-palette-option flex items-center space-x-3 px-3 py-2 hover:bg-gray-700 rounded cursor-pointer transition duration-200" data-value="gray">
                                        <div class="w-8 h-4 rounded bg-gradient-to-r from-gray-300 via-gray-500 to-gray-700"></div>
                                        <span class="text-sm text-white">Gray Theme</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm font-medium text-gray-300 block mb-2">Minimum Value</label>
                                <input type="number" id="series-min-value" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0">
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-300 block mb-2">Maximum Value</label>
                                <input type="number" id="series-max-value" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="100">
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Scale Factor</label>
                        <div class="relative">
                            <select id="series-scale-factor" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="1">1x (No scaling)</option>
                                <option value="0.001">0.001x (Thousands)</option>
                                <option value="0.01">0.01x (Hundreds)</option>
                                <option value="0.1">0.1x (Tens)</option>
                                <option value="10">10x</option>
                                <option value="100">100x</option>
                                <option value="1000">1000x</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Number Format</label>
                        <div class="relative">
                            <select id="series-number-format" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="number">Number (1,234.56)</option>
                                <option value="currency">Currency ($1,234.56)</option>
                                <option value="percentage">Percentage (123.46%)</option>
                                <option value="decimal">Decimal (1234.56)</option>
                                <option value="integer">Integer (1235)</option>
                                <option value="scientific">Scientific (1.23e+3)</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-6"></div>
                    
                    <div class="max-w-md">
                        <label class="text-sm font-medium text-gray-300 block mb-3">Gridlines & Ticks</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="series-major-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Gridlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-minor-gridlines" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Minor Gridlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-major-ticks" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Major Ticks</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="series-minor-ticks" class="mr-3 bg-gray-800 border border-gray-600 rounded text-red-500 focus:ring-red-500 focus:ring-2">
                                <span class="text-sm text-gray-300">Minor Ticks</span>
                            </label>
                        </div>
                    </div>
                `;
                seriesContent.appendChild(configDiv);
                tabContentContainer.appendChild(seriesContent);

                // Legend Tab Content
                const legendContent = document.createElement('div');
                legendContent.id = 'legend-tab-content';
                legendContent.className = 'visual-tab-content hidden space-y-6';
                legendContent.innerHTML = `
                    <div class="max-w-md">
                        <div class="flex items-center space-x-3">
                            <button id="legend-show-legend" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-900" role="switch" aria-checked="false">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 translate-x-1"></span>
                            </button>
                            <span class="text-sm text-gray-300 cursor-pointer hover:text-gray-200">Show Legend</span>
                        </div>
                    </div>
                    
                    <div class="max-w-md" id="legend-position-container" style="display: none;">
                        <label class="text-sm font-medium text-gray-300 block mb-2">Legend Position</label>
                        <div class="relative">
                            <select id="legend-position" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="auto">Auto</option>
                                <option value="top">Top</option>
                                <option value="bottom">Bottom</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                `;
                tabContentContainer.appendChild(legendContent);

                tabsContainer.appendChild(tabContentContainer);
                container.appendChild(tabsContainer);

                // Add event listeners for tab switching
                setTimeout(() => {
                    const tabButtons = tabsContainer.querySelectorAll('.visual-property-tab');
                    const tabContents = tabsContainer.querySelectorAll('.visual-tab-content');

                    tabButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const targetTab = button.getAttribute('data-visual-tab');
                            
                            // Update active tab button
                            tabButtons.forEach(btn => {
                                btn.className = btn.className.replace('bg-blue-600 text-white', 'bg-gray-700 hover:bg-gray-600 text-gray-300');
                            });
                            button.className = button.className.replace('bg-gray-700 hover:bg-gray-600 text-gray-300', 'bg-blue-600 text-white');
                            
                            // Show target tab content
                            tabContents.forEach(content => {
                                content.classList.add('hidden');
                            });
                            const targetContent = tabsContainer.querySelector(`#${targetTab}-tab-content`);
                            if (targetContent) {
                                targetContent.classList.remove('hidden');
                            }
                        });
                    });

                    // Initialize the Series list
                    updateSeriesDropdown('series-field');
                    updateSeriesList();

                    // Initialize Color Palette dropdown functionality
                    const colorPaletteBtn = document.getElementById('series-color-palette-btn');
                    const colorPaletteDropdown = document.getElementById('series-color-palette-dropdown');
                    const colorPaletteOptions = document.querySelectorAll('.color-palette-option');

                    if (colorPaletteBtn && colorPaletteDropdown) {
                        colorPaletteBtn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            colorPaletteDropdown.classList.toggle('hidden');
                        });

                        // Handle color palette option selection
                        colorPaletteOptions.forEach(option => {
                            option.addEventListener('click', function(e) {
                                e.stopPropagation();
                                const value = this.getAttribute('data-value');
                                const name = this.querySelector('span').textContent;
                                const preview = this.querySelector('div').cloneNode(true);
                                
                                // Update the button display
                                const selectedSpan = document.getElementById('series-color-palette-selected');
                                const previewDiv = document.getElementById('series-color-palette-preview');
                                
                                if (selectedSpan) selectedSpan.textContent = name;
                                if (previewDiv) {
                                    previewDiv.innerHTML = '';
                                    previewDiv.appendChild(preview);
                                }
                                
                                // Hide dropdown
                                colorPaletteDropdown.classList.add('hidden');
                            });
                        });

                        // Close dropdown when clicking outside
                        document.addEventListener('click', function(e) {
                            if (!colorPaletteBtn.contains(e.target) && !colorPaletteDropdown.contains(e.target)) {
                                colorPaletteDropdown.classList.add('hidden');
                            }
                        });
                    }

                    // Initialize Legend functionality
                    const showLegendToggle = document.getElementById('legend-show-legend');
                    const legendPositionContainer = document.getElementById('legend-position-container');

                    if (showLegendToggle && legendPositionContainer) {
                        // Function to toggle legend state
                        function toggleLegendState() {
                            const isChecked = showLegendToggle.getAttribute('aria-checked') === 'true';
                            const newState = !isChecked;
                            
                            // Update toggle state
                            showLegendToggle.setAttribute('aria-checked', newState.toString());
                            
                            // Update toggle appearance
                            const toggleCircle = showLegendToggle.querySelector('span');
                            if (newState) {
                                showLegendToggle.classList.remove('bg-gray-700');
                                showLegendToggle.classList.add('bg-red-500');
                                toggleCircle.classList.remove('translate-x-1');
                                toggleCircle.classList.add('translate-x-6');
                                legendPositionContainer.style.display = 'block';
                            } else {
                                showLegendToggle.classList.remove('bg-red-500');
                                showLegendToggle.classList.add('bg-gray-700');
                                toggleCircle.classList.remove('translate-x-6');
                                toggleCircle.classList.add('translate-x-1');
                                legendPositionContainer.style.display = 'none';
                            }
                        }

                        // Add click event to toggle button
                        showLegendToggle.addEventListener('click', toggleLegendState);

                        // Add click event to the label text
                        const legendLabel = showLegendToggle.nextElementSibling;
                        if (legendLabel) {
                            legendLabel.addEventListener('click', toggleLegendState);
                        }
                    }
                }, 100);

            } else if (selectedChartSubtype === 'donut' || selectedChartSubtype === 'radial') {
                // Label Field
                const labelField = createSelectField('label-field', config.label, config.labelOptions);
                container.appendChild(labelField);

                // Value Field
                const valueField = createSelectField('value-field', config.value, config.valueOptions);
                container.appendChild(valueField);
            }
        }

        function generateMapLayerMappingFields(container) {
            const mapFields = {
                'heatmap': {
                    xAxis: 'Longitude',
                    yAxis: 'Latitude',
                    value: 'Intensity',
                    xOptions: ['longitude', 'grid_id'],
                    yOptions: ['latitude', 'grid_id'],
                    valueOptions: ['population_density', 'population_count', 'area_size_km2', 'sales', 'revenue']
                },
                'area': {
                    xAxis: 'Longitude',
                    yAxis: 'Latitude',
                    value: 'Area Value',
                    xOptions: ['longitude', 'grid_id'],
                    yOptions: ['latitude', 'grid_id'],
                    valueOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue']
                },
                'disc': {
                    xAxis: 'Longitude',
                    yAxis: 'Latitude',
                    value: 'Size',
                    xOptions: ['longitude', 'grid_id'],
                    yOptions: ['latitude', 'grid_id'],
                    valueOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue']
                },
                'pillar': {
                    xAxis: 'Longitude',
                    yAxis: 'Latitude',
                    value: 'Height',
                    xOptions: ['longitude', 'grid_id'],
                    yOptions: ['latitude', 'grid_id'],
                    valueOptions: ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue']
                },
                'arcs': {
                    xAxis: 'Start Longitude',
                    yAxis: 'Start Latitude',
                    value: 'End Coordinates',
                    xOptions: ['longitude', 'grid_id'],
                    yOptions: ['latitude', 'grid_id'],
                    valueOptions: ['end_longitude', 'end_latitude', 'distance', 'population_count']
                }
            };

            const config = mapFields[selectedMapLayerSubtype];
            if (!config) return;

            // X-Axis Field
            const xAxisField = createSelectField('x-axis-field', config.xAxis, config.xOptions);
            container.appendChild(xAxisField);

            // Y-Axis Field
            const yAxisField = createSelectField('y-axis-field', config.yAxis, config.yOptions);
            container.appendChild(yAxisField);

            // Value Field (for map layers)
            const valueField = createSelectField('value-field', config.value, config.valueOptions);
            container.appendChild(valueField);
        }

        function generateKpiMappingFields(container) {
            const kpiField = createSelectField('kpi-field', 'KPI Value', ['population_count', 'area_size_km2', 'population_density', 'sales', 'revenue', 'quantity']);
            container.appendChild(kpiField);
        }

        function createSelectField(id, label, options) {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'space-y-2';

            const labelElement = document.createElement('label');
            labelElement.className = 'block text-sm font-medium text-gray-300 mb-2';
            labelElement.innerHTML = `${label} <span class="text-red-400">*</span>`;

            const selectDiv = document.createElement('div');
            selectDiv.className = 'relative';

            const select = document.createElement('select');
            select.id = id;
            select.className = 'w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none';

            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = `Select ${label.toLowerCase()}`;
            select.appendChild(defaultOption);

            // Add options
            const optionLabels = {
                'date': 'Date',
                'time': 'Time',
                'timestamp': 'Timestamp',
                'category': 'Category',
                'region': 'Region',
                'grid_id': 'Grid ID',
                'longitude': 'Longitude',
                'latitude': 'Latitude',
                'population_count': 'Population Count',
                'area_size_km2': 'Area Size (km)',
                'population_density': 'Population Density',
                'sales': 'Sales',
                'revenue': 'Revenue',
                'quantity': 'Quantity',
                'end_longitude': 'End Longitude',
                'end_latitude': 'End Latitude',
                'distance': 'Distance'
            };

            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = optionLabels[option] || option;
                select.appendChild(optionElement);
            });

            // Add custom arrow
            const arrowDiv = document.createElement('div');
            arrowDiv.className = 'absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none';
            arrowDiv.innerHTML = '<span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>';

            selectDiv.appendChild(select);
            selectDiv.appendChild(arrowDiv);
            fieldDiv.appendChild(labelElement);
            fieldDiv.appendChild(selectDiv);

            // Add event listener
            select.addEventListener('change', function() {
                if (id === 'x-axis-field') {
                    selectedXAxisField = this.value;
                } else if (id === 'y-axis-field') {
                    selectedYAxisField = this.value;
                } else if (id === 'value-field') {
                    selectedValueField = this.value;
                } else if (id === 'kpi-field') {
                    selectedKpiField = this.value;
                } else if (id === 'label-field') {
                    selectedLabelField = this.value;
                }
                validateStep3();
                updateWizardState();
            });

            return fieldDiv;
        }

        function createSeriesField(id, label, options) {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'space-y-3';

            // Header with label and Remove All button
            const headerDiv = document.createElement('div');
            headerDiv.className = 'flex items-center justify-between';

            const labelElement = document.createElement('label');
            labelElement.className = 'block text-sm font-medium text-gray-300';
            labelElement.innerHTML = `${label} <span class="text-red-400">*</span>`;

            const removeAllBtn = document.createElement('button');
            removeAllBtn.type = 'button';
            removeAllBtn.id = id + '-remove-all';
            removeAllBtn.className = 'text-red-400 hover:text-red-300 text-sm font-medium transition duration-200 hidden';
            removeAllBtn.textContent = 'Remove All';
            removeAllBtn.addEventListener('click', function() {
                selectedSeriesFields = [];
                updateSeriesList();
                validateStep3();
                updateWizardState();
            });

            headerDiv.appendChild(labelElement);
            headerDiv.appendChild(removeAllBtn);
            fieldDiv.appendChild(headerDiv);

            // Series list container
            const listContainer = document.createElement('div');
            listContainer.id = id + '-list';
            listContainer.className = 'space-y-2';
            fieldDiv.appendChild(listContainer);

            // Add Series dropdown button
            const addSeriesBtn = document.createElement('button');
            addSeriesBtn.type = 'button';
            addSeriesBtn.id = id + '-btn';
            addSeriesBtn.className = 'bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md transition duration-200 flex items-center space-x-2 text-sm';
            addSeriesBtn.innerHTML = '<span class="material-symbols-outlined">add</span><span>Add Series</span>';
            addSeriesBtn.addEventListener('click', function() {
                toggleSeriesDropdown(id);
            });

            fieldDiv.appendChild(addSeriesBtn);

            // Dropdown container
            const dropdownContainer = document.createElement('div');
            dropdownContainer.id = id + '-dropdown';
            dropdownContainer.className = 'absolute z-50 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto hidden mt-2';
            dropdownContainer.style.width = '100%';
            dropdownContainer.style.maxWidth = '400px';

            // Store options for later use
            dropdownContainer.dataset.options = JSON.stringify(options);

            // Add options to dropdown
            updateSeriesDropdown(id);

            // Position the dropdown relative to the button
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'relative';
            buttonContainer.appendChild(addSeriesBtn);
            buttonContainer.appendChild(dropdownContainer);
            fieldDiv.appendChild(buttonContainer);

            // Initialize the list
            setTimeout(() => {
                updateSeriesList();
            }, 0);

            return fieldDiv;
        }

        function updateSeriesDropdown(id) {
            const dropdown = document.getElementById(id + '-dropdown');
            if (!dropdown) return;

            // Clear existing options
            dropdown.innerHTML = '';

            const options = JSON.parse(dropdown.dataset.options || '[]');
            const optionLabels = {
                'date': 'Date',
                'time': 'Time',
                'timestamp': 'Timestamp',
                'category': 'Category',
                'region': 'Region',
                'grid_id': 'Grid ID',
                'longitude': 'Longitude',
                'latitude': 'Latitude',
                'population_count': 'Population Count',
                'area_size_km2': 'Area Size (km)',
                'population_density': 'Population Density',
                'sales': 'Sales',
                'revenue': 'Revenue',
                'quantity': 'Quantity',
                'end_longitude': 'End Longitude',
                'end_latitude': 'End Latitude',
                'distance': 'Distance'
            };

            options.forEach(option => {
                const optionDiv = document.createElement('div');
                const isSelected = selectedSeriesFields.includes(option);
                
                if (isSelected) {
                    optionDiv.className = 'px-3 py-2 text-sm text-gray-500 cursor-not-allowed flex items-center justify-between';
                    optionDiv.innerHTML = `
                        <span>${optionLabels[option] || option}</span>
                        <span class="text-xs text-gray-400">Already added</span>
                    `;
                } else {
                    optionDiv.className = 'px-3 py-2 hover:bg-gray-700 cursor-pointer text-sm text-white transition duration-200';
                    optionDiv.textContent = optionLabels[option] || option;
                    optionDiv.addEventListener('click', function() {
                        selectedSeriesFields.push(option);
                        updateSeriesList();
                        updateSeriesDropdown(id);
                        toggleSeriesDropdown(id);
                        validateStep3();
                        updateWizardState();
                    });
                }
                
                dropdown.appendChild(optionDiv);
            });
        }

        function toggleSeriesDropdown(id) {
            const dropdown = document.getElementById(id + '-dropdown');
            const button = document.getElementById(id + '-btn');
            
            if (dropdown.classList.contains('hidden')) {
                // Close any other open dropdowns
                document.querySelectorAll('[id$="-dropdown"]').forEach(d => {
                    if (d !== dropdown) {
                        d.classList.add('hidden');
                    }
                });
                
                // Update dropdown options before showing
                updateSeriesDropdown(id);
                
                // Show this dropdown
                dropdown.classList.remove('hidden');
            } else {
                // Hide dropdown
                dropdown.classList.add('hidden');
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('[id$="-btn"]') && !e.target.closest('[id$="-dropdown"]')) {
                document.querySelectorAll('[id$="-dropdown"]').forEach(dropdown => {
                    dropdown.classList.add('hidden');
                });
            }
        });

        function updateSeriesList() {
            const listContainer = document.getElementById('series-field-list');
            const removeAllBtn = document.getElementById('series-field-remove-all');
            if (!listContainer) return;

            // Clear existing list
            listContainer.innerHTML = '';



            if (selectedSeriesFields.length === 0) {
                // Hide Remove All button
                if (removeAllBtn) {
                    removeAllBtn.classList.add('hidden');
                }
                return;
            }

            // Show Remove All button
            if (removeAllBtn) {
                removeAllBtn.classList.remove('hidden');
            }

            // Create list items
            selectedSeriesFields.forEach((field, index) => {
                const listItem = createSeriesListItem(field, index);
                listContainer.appendChild(listItem);
            });

            // Add drag and drop functionality
            makeListSortable(listContainer);
        }

        function createSeriesListItem(field, index) {
            const optionLabels = {
                'date': 'Date',
                'time': 'Time',
                'timestamp': 'Timestamp',
                'category': 'Category',
                'region': 'Region',
                'grid_id': 'Grid ID',
                'longitude': 'Longitude',
                'latitude': 'Latitude',
                'population_count': 'Population Count',
                'area_size_km2': 'Area Size (km)',
                'population_density': 'Population Density',
                'sales': 'Sales',
                'revenue': 'Revenue',
                'quantity': 'Quantity',
                'end_longitude': 'End Longitude',
                'end_latitude': 'End Latitude',
                'distance': 'Distance'
            };

            const itemDiv = document.createElement('div');
            itemDiv.className = 'series-item flex items-center justify-between bg-gray-700 border border-gray-600 rounded-md px-3 py-2 cursor-move hover:bg-gray-600 transition duration-200';
            itemDiv.draggable = true;
            itemDiv.dataset.index = index;

            const dragHandle = document.createElement('span');
            dragHandle.className = 'material-symbols-outlined text-gray-400 text-sm mr-2 cursor-move';
            dragHandle.textContent = 'drag_indicator';

            const fieldLabel = document.createElement('span');
            fieldLabel.className = 'text-sm text-white flex-1';
            fieldLabel.textContent = optionLabels[field] || field;

            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'text-red-400 hover:text-red-300 transition duration-200';
            removeBtn.innerHTML = '<span class="material-symbols-outlined text-sm">close</span>';
            removeBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                selectedSeriesFields.splice(index, 1);
                updateSeriesList();
                validateStep3();
                updateWizardState();
            });

            itemDiv.appendChild(dragHandle);
            itemDiv.appendChild(fieldLabel);
            itemDiv.appendChild(removeBtn);

            return itemDiv;
        }

        function makeListSortable(container) {
            let draggedItem = null;
            let draggedIndex = null;

            // Add drag events to each item
            function addDragEvents(item) {
                item.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    draggedIndex = parseInt(this.dataset.index);
                    this.style.opacity = '0.5';
                    e.dataTransfer.effectAllowed = 'move';
                });

                item.addEventListener('dragend', function(e) {
                    this.style.opacity = '1';
                    draggedItem = null;
                    draggedIndex = null;
                });

                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });

                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (draggedItem && draggedIndex !== null) {
                        const dropIndex = parseInt(this.dataset.index);
                        
                        if (dropIndex !== draggedIndex) {
                            // Reorder the array
                            const item = selectedSeriesFields[draggedIndex];
                            selectedSeriesFields.splice(draggedIndex, 1);
                            selectedSeriesFields.splice(dropIndex, 0, item);
                            
                            // Update the list
                            updateSeriesList();
                            validateStep3();
                            updateWizardState();
                        }
                    }
                });
            }

            // Add drag events to existing items
            container.querySelectorAll('.series-item').forEach(addDragEvents);

            // Add container drop zone for dropping at the end
            container.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });

            container.addEventListener('drop', function(e) {
                e.preventDefault();
                
                if (draggedItem && draggedIndex !== null) {
                    const items = container.querySelectorAll('.series-item');
                    const lastItem = items[items.length - 1];
                    
                    if (lastItem && e.clientY > lastItem.getBoundingClientRect().bottom) {
                        // Drop at the end
                        const item = selectedSeriesFields[draggedIndex];
                        selectedSeriesFields.splice(draggedIndex, 1);
                        selectedSeriesFields.push(item);
                        
                        // Update the list
                        updateSeriesList();
                        validateStep3();
                        updateWizardState();
                    }
                }
            });
        }

        // Y-Axis field functions
        function updateYAxisDropdown(id) {
            const dropdown = document.getElementById(id + '-dropdown');
            if (!dropdown) return;

            // Clear existing options
            dropdown.innerHTML = '';

            const options = JSON.parse(dropdown.dataset.options || '[]');
            const optionLabels = {
                'date': 'Date',
                'time': 'Time',
                'timestamp': 'Timestamp',
                'category': 'Category',
                'region': 'Region',
                'grid_id': 'Grid ID',
                'longitude': 'Longitude',
                'latitude': 'Latitude',
                'population_count': 'Population Count',
                'area_size_km2': 'Area Size (km)',
                'population_density': 'Population Density',
                'sales': 'Sales',
                'revenue': 'Revenue',
                'quantity': 'Quantity',
                'end_longitude': 'End Longitude',
                'end_latitude': 'End Latitude',
                'distance': 'Distance'
            };

            options.forEach(option => {
                const optionDiv = document.createElement('div');
                const isSelected = selectedYAxisFields.includes(option);
                
                if (isSelected) {
                    optionDiv.className = 'px-3 py-2 text-sm text-gray-500 cursor-not-allowed flex items-center justify-between';
                    optionDiv.innerHTML = `
                        <span>${optionLabels[option] || option}</span>
                        <span class="text-xs text-gray-400">Already added</span>
                    `;
                } else {
                    optionDiv.className = 'px-3 py-2 hover:bg-gray-700 cursor-pointer text-sm text-white transition duration-200';
                    optionDiv.textContent = optionLabels[option] || option;
                    optionDiv.addEventListener('click', function() {
                        selectedYAxisFields.push(option);
                        updateYAxisList();
                        updateYAxisDropdown(id);
                        toggleYAxisDropdown(id);
                        validateStep3();
                        updateWizardState();
                    });
                }
                
                dropdown.appendChild(optionDiv);
            });
        }



        function selectYAxisDataField(value) {
            if (value === '') {
                selectedYAxisField = null;
            } else {
                selectedYAxisField = value;
            }
            
            // Update validation
            validateStep3();
            updateWizardState();
        }



        function selectXAxisDataField(value) {
            if (value === '') {
                selectedXAxisField = null;
            } else {
                selectedXAxisField = value;
            }
            
            // Update validation
            validateStep3();
            updateWizardState();
        }

        function toggleYAxisDropdown(id) {
            const dropdown = document.getElementById(id + '-dropdown');
            const button = document.getElementById(id + '-btn');
            
            if (dropdown.classList.contains('hidden')) {
                // Close any other open dropdowns
                document.querySelectorAll('[id$="-dropdown"]').forEach(d => {
                    if (d !== dropdown) {
                        d.classList.add('hidden');
                    }
                });
                
                // Update dropdown options before showing
                updateYAxisDropdown(id);
                
                // Show this dropdown
                dropdown.classList.remove('hidden');
            } else {
                // Hide dropdown
                dropdown.classList.add('hidden');
            }
        }

        function updateYAxisList() {
            const listContainer = document.getElementById('y-axis-field-list');
            const removeAllBtn = document.getElementById('y-axis-field-remove-all');
            if (!listContainer) return;

            // Clear existing list
            listContainer.innerHTML = '';

            if (selectedYAxisFields.length === 0) {
                // Hide Remove All button
                if (removeAllBtn) {
                    removeAllBtn.classList.add('hidden');
                }
                return;
            }

            // Show Remove All button
            if (removeAllBtn) {
                removeAllBtn.classList.remove('hidden');
            }

            // Create list items
            selectedYAxisFields.forEach((field, index) => {
                const listItem = createYAxisListItem(field, index);
                listContainer.appendChild(listItem);
            });

            // Add drag and drop functionality
            makeYAxisListSortable(listContainer);
        }

        function createYAxisListItem(field, index) {
            const optionLabels = {
                'date': 'Date',
                'time': 'Time',
                'timestamp': 'Timestamp',
                'category': 'Category',
                'region': 'Region',
                'grid_id': 'Grid ID',
                'longitude': 'Longitude',
                'latitude': 'Latitude',
                'population_count': 'Population Count',
                'area_size_km2': 'Area Size (km)',
                'population_density': 'Population Density',
                'sales': 'Sales',
                'revenue': 'Revenue',
                'quantity': 'Quantity',
                'end_longitude': 'End Longitude',
                'end_latitude': 'End Latitude',
                'distance': 'Distance'
            };

            const itemDiv = document.createElement('div');
            itemDiv.className = 'y-axis-item flex items-center justify-between bg-gray-700 border border-gray-600 rounded-md px-3 py-2 cursor-move hover:bg-gray-600 transition duration-200';
            itemDiv.draggable = true;
            itemDiv.dataset.index = index;

            const dragHandle = document.createElement('span');
            dragHandle.className = 'material-symbols-outlined text-gray-400 text-sm mr-2 cursor-move';
            dragHandle.textContent = 'drag_indicator';

            const fieldLabel = document.createElement('span');
            fieldLabel.className = 'text-sm text-white flex-1';
            fieldLabel.textContent = optionLabels[field] || field;

            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'text-red-400 hover:text-red-300 transition duration-200';
            removeBtn.innerHTML = '<span class="material-symbols-outlined text-sm">close</span>';
            removeBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                selectedYAxisFields.splice(index, 1);
                updateYAxisList();
                validateStep3();
                updateWizardState();
            });

            itemDiv.appendChild(dragHandle);
            itemDiv.appendChild(fieldLabel);
            itemDiv.appendChild(removeBtn);

            return itemDiv;
        }

        function makeYAxisListSortable(container) {
            let draggedItem = null;
            let draggedIndex = null;

            // Add drag events to each item
            function addDragEvents(item) {
                item.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    draggedIndex = parseInt(this.dataset.index);
                    this.style.opacity = '0.5';
                    e.dataTransfer.effectAllowed = 'move';
                });

                item.addEventListener('dragend', function(e) {
                    this.style.opacity = '1';
                    draggedItem = null;
                    draggedIndex = null;
                });

                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });

                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (draggedItem && draggedIndex !== null) {
                        const dropIndex = parseInt(this.dataset.index);
                        
                        if (dropIndex !== draggedIndex) {
                            // Reorder the array
                            const item = selectedYAxisFields[draggedIndex];
                            selectedYAxisFields.splice(draggedIndex, 1);
                            selectedYAxisFields.splice(dropIndex, 0, item);
                            
                            // Update the list
                            updateYAxisList();
                            validateStep3();
                            updateWizardState();
                        }
                    }
                });
            }

            // Add drag events to existing items
            container.querySelectorAll('.y-axis-item').forEach(addDragEvents);

            // Add container drop zone for dropping at the end
            container.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });

            container.addEventListener('drop', function(e) {
                e.preventDefault();
                
                if (draggedItem && draggedIndex !== null) {
                    const items = container.querySelectorAll('.y-axis-item');
                    const lastItem = items[items.length - 1];
                    
                    if (lastItem && e.clientY > lastItem.getBoundingClientRect().bottom) {
                        // Drop at the end
                        const item = selectedYAxisFields[draggedIndex];
                        selectedYAxisFields.splice(draggedIndex, 1);
                        selectedYAxisFields.push(item);
                        
                        // Update the list
                        updateYAxisList();
                        validateStep3();
                        updateWizardState();
                    }
                }
            });
        }

        function validateStep1() {
            const componentName = document.getElementById('component-name');
            const componentDescription = document.getElementById('component-description');
            const componentCategory = document.getElementById('component-category');
            
            if (componentName && componentDescription && componentCategory) {
                const isNameValid = componentName.value.trim() !== '';
                const isDescriptionValid = componentDescription.value.trim() !== '';
                const isCategoryValid = componentCategory.value !== '';
                
                const isStep1Valid = isNameValid && isDescriptionValid && isCategoryValid;
                
                // Update Next button state only if we're on step 1
                const nextStepBtn = document.getElementById('next-step-btn');
                if (nextStepBtn) {
                    nextStepBtn.disabled = !isStep1Valid;
                    nextStepBtn.classList.toggle('opacity-50', !isStep1Valid);
                    nextStepBtn.classList.toggle('cursor-not-allowed', !isStep1Valid);
                }
                
                // Update field borders based on validation
                componentName.classList.toggle('border-red-500', !isNameValid && componentName.value !== '');
                componentDescription.classList.toggle('border-red-500', !isDescriptionValid && componentDescription.value !== '');
                componentCategory.classList.toggle('border-red-500', !isCategoryValid && componentCategory.value !== '');
            }
        }

        function updateSelectedAiModelDisplay() {
            if (selectedAiModel) {
                const model = aiModels.find(m => m.id === selectedAiModel);
                if (model) {
                    const nameElement = document.getElementById('selected-ai-model-name');
                    const detailsElement = document.getElementById('selected-ai-model-description');
                    const iconElement = document.getElementById('selected-ai-model-icon');
                    const aiModelSelectionContainer = document.getElementById('ai-model-selection-container');
                    const selectedAiModelDisplay = document.getElementById('selected-ai-model-display');
                    
                    if (nameElement) nameElement.textContent = model.name;
                    if (detailsElement) detailsElement.textContent = model.description;
                    if (iconElement) iconElement.textContent = 'auto_awesome';
                    
                    if (aiModelSelectionContainer && selectedAiModelDisplay) {
                        aiModelSelectionContainer.classList.add('hidden');
                        selectedAiModelDisplay.classList.remove('hidden');
                    }
                }
            } else {
                const aiModelSelectionContainer = document.getElementById('ai-model-selection-container');
                const selectedAiModelDisplay = document.getElementById('selected-ai-model-display');
                if (aiModelSelectionContainer && selectedAiModelDisplay) {
                    aiModelSelectionContainer.classList.remove('hidden');
                    selectedAiModelDisplay.classList.add('hidden');
                }
            }
        }

        // Global wizard state function
        function updateWizardState() {
            const totalSteps = 5;

            // Update step indicators
            for (let i = 1; i <= totalSteps; i++) {
                const stepIndicator = document.getElementById(`step-${i}-indicator`);
                const stepTab = document.getElementById(`step-${i}-tab`);
                const stepLabel = stepTab ? stepTab.querySelector('span') : null;
                
                if (stepIndicator && stepTab) {
                    // Reset all classes first
                    stepIndicator.classList.remove('bg-blue-600', 'bg-green-600', 'bg-gray-600', 'text-white', 'text-gray-400');
                    stepTab.classList.remove('cursor-pointer', 'cursor-not-allowed', 'border-blue-500', 'border-transparent');
                    if (stepLabel) {
                        stepLabel.classList.remove('text-blue-400', 'text-green-400', 'text-gray-400');
                    }
                    
                    // Determine step state
                    let stepState = 'disabled'; // default state
                    
                    if (i === 1) {
                        // Step 1 is always enabled
                        stepState = i === currentStep ? 'current' : 'enabled';
                    } else if (i === 2) {
                        // Step 2 is enabled only if Step 1 is complete
                        const isStep1Complete = validateStep1Fields();
                        if (isStep1Complete) {
                            stepState = i === currentStep ? 'current' : 'enabled';
                        }
                    } else if (i === 3) {
                        // Step 3 is enabled only if Step 2 is complete
                        const isStep2Complete = validateStep2Fields();
                        if (isStep2Complete) {
                            stepState = i === currentStep ? 'current' : 'enabled';
                        }
                    } else if (i === 4) {
                        // Step 4 is enabled only if Step 3 is complete (including data mapping)
                        const isStep3Complete = validateStep3Fields() && validateStep3DataMapping();
                        if (isStep3Complete) {
                            stepState = i === currentStep ? 'current' : 'enabled';
                        }
                    } else if (i === 5) {
                        // Step 5 is enabled when Step 4 is valid (filters are optional or properly mapped)
                        const isStep3Complete = validateStep3Fields() && validateStep3DataMapping();
                        const isStep4Valid = validateStep4Fields();
                        if (isStep3Complete && isStep4Valid) {
                            stepState = i === currentStep ? 'current' : 'enabled';
                        }
                    }
                    
                    // Apply state-specific styling
                    if (stepState === 'current') {
                        // Current step - Blue indicator, blue text, blue bottom border, clickable
                        stepIndicator.classList.add('bg-blue-600', 'text-white');
                        stepTab.classList.add('cursor-pointer', 'border-blue-500');
                        stepTab.classList.remove('border-transparent');
                        if (stepLabel) {
                            stepLabel.classList.add('text-blue-400');
                        }
                    } else if (stepState === 'enabled') {
                        // Enabled step - Blue indicator, blue text, transparent border, clickable
                        stepIndicator.classList.add('bg-blue-600', 'text-white');
                        stepTab.classList.add('cursor-pointer', 'border-transparent');
                        stepTab.classList.remove('border-blue-500');
                        if (stepLabel) {
                            stepLabel.classList.add('text-blue-400');
                        }
                    } else {
                        // Disabled step - Gray indicator, gray text, transparent border, not clickable
                        stepIndicator.classList.add('bg-gray-600', 'text-gray-400');
                        stepTab.classList.add('cursor-not-allowed', 'border-transparent');
                        stepTab.classList.remove('border-blue-500');
                        if (stepLabel) {
                            stepLabel.classList.add('text-gray-400');
                        }
                    }
                }
            }

            // Update step content visibility and tab active states
            for (let i = 1; i <= totalSteps; i++) {
                const stepContent = document.getElementById(`step-${i}-content`);
                const stepTab = document.getElementById(`step-${i}-tab`);
                
                if (stepContent) {
                    if (i === currentStep) {
                        stepContent.classList.remove('hidden');
                    } else {
                        stepContent.classList.add('hidden');
                    }
                }
                
                if (stepTab) {
                    if (i === currentStep) {
                        stepTab.classList.add('active');
                    } else {
                        stepTab.classList.remove('active');
                    }
                }
            }

            // Update navigation buttons
            const prevStepBtn = document.getElementById('prev-step-btn');
            const nextStepBtn = document.getElementById('next-step-btn');
            const finishBtn = document.getElementById('finish-btn');

            if (prevStepBtn) {
                prevStepBtn.disabled = currentStep === 1;
                prevStepBtn.classList.toggle('opacity-50', currentStep === 1);
                prevStepBtn.classList.toggle('cursor-not-allowed', currentStep === 1);
            }

            if (nextStepBtn) {
                nextStepBtn.classList.toggle('hidden', currentStep === totalSteps);
                
                // Disable Next button based on current step validation
                if (currentStep === 1) {
                    const isStep1Complete = validateStep1Fields();
                    nextStepBtn.disabled = !isStep1Complete;
                    nextStepBtn.classList.toggle('opacity-50', !isStep1Complete);
                    nextStepBtn.classList.toggle('cursor-not-allowed', !isStep1Complete);
                } else if (currentStep === 2) {
                    const isStep2Complete = validateStep2Fields();
                    nextStepBtn.disabled = !isStep2Complete;
                    nextStepBtn.classList.toggle('opacity-50', !isStep2Complete);
                    nextStepBtn.classList.toggle('cursor-not-allowed', !isStep2Complete);
                } else if (currentStep === 3) {
                    const isStep3Complete = validateStep3Fields() && validateStep3DataMapping();
                    nextStepBtn.disabled = !isStep3Complete;
                    nextStepBtn.classList.toggle('opacity-50', !isStep3Complete);
                    nextStepBtn.classList.toggle('cursor-not-allowed', !isStep3Complete);
                } else if (currentStep === 4) {
                    const isStep4Complete = validateStep4Fields();
                    nextStepBtn.disabled = !isStep4Complete;
                    nextStepBtn.classList.toggle('opacity-50', !isStep4Complete);
                    nextStepBtn.classList.toggle('cursor-not-allowed', !isStep4Complete);
                } else if (currentStep === 5) {
                    // Step 5 (Access) is always valid since it's optional
                    nextStepBtn.disabled = false;
                    nextStepBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }

            if (finishBtn) {
                finishBtn.classList.toggle('hidden', currentStep !== totalSteps);
            }
        }

        // Create Component Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const createComponentModal = document.getElementById('create-component-modal');
            const createComponentBtn = document.getElementById('create-component-btn');
            const closeCreateComponentModal = document.getElementById('close-create-component-modal');
            const nextStepBtn = document.getElementById('next-step-btn');
            const prevStepBtn = document.getElementById('prev-step-btn');
            const finishBtn = document.getElementById('finish-btn');

            // Initialize wizard state
            const totalSteps = 5;







            // Close modal
            if (closeCreateComponentModal) {
                closeCreateComponentModal.addEventListener('click', function() {
                    if (createComponentModal) {
                        createComponentModal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                });
            }



            // Navigation buttons
            if (nextStepBtn) {
                nextStepBtn.addEventListener('click', function() {
                    if (currentStep < totalSteps) {
                        // Validate current step before allowing progression
                        let canProceed = false;
                        
                        if (currentStep === 1) {
                            canProceed = validateStep1Fields();
                        } else if (currentStep === 2) {
                            canProceed = validateStep2Fields();
                        } else if (currentStep === 3) {
                            canProceed = validateStep3Fields() && validateStep3DataMapping();
                        } else if (currentStep === 4) {
                            canProceed = validateStep4Fields();
                        } else if (currentStep === 5) {
                            // Step 5 (Access) is always valid since it's optional
                            canProceed = true;
                        }
                        
                        if (canProceed) {
                            currentStep++;
                            updateWizardState();
                        }
                    }
                });
            }







            // Add event listeners for Step 1 validation
            const componentName = document.getElementById('component-name');
            const componentDescription = document.getElementById('component-description');
            const componentCategory = document.getElementById('component-category');

            if (componentName) {
                componentName.addEventListener('input', function() {
                    validateStep1();
                    updateWizardState();
                });
                componentName.addEventListener('blur', function() {
                    validateStep1();
                    updateWizardState();
                });
            }

            if (componentDescription) {
                componentDescription.addEventListener('input', function() {
                    validateStep1();
                    updateWizardState();
                });
                componentDescription.addEventListener('blur', function() {
                    validateStep1();
                    updateWizardState();
                });
            }

            if (componentCategory) {
                componentCategory.addEventListener('change', function() {
                    validateStep1();
                    updateWizardState();
                });
            }

            // Add event listeners for Step 4 validation (Configuration)
            const colorScheme = document.getElementById('color-scheme');
            if (colorScheme) {
                colorScheme.addEventListener('change', function() {
                    updateWizardState();
                });
            }



            // Data source option click handlers
            document.querySelectorAll('.data-source-option').forEach(option => {
                option.addEventListener('click', function() {
                    const dataType = this.getAttribute('data-type');
                    selectedDataSourceType = dataType;

                    // Hide query field when data source type changes
                    const queryField = document.getElementById('database-query-field');
                    if (queryField) {
                        queryField.classList.add('hidden');
                    }
                    
                    // Update selected state
                    document.querySelectorAll('.data-source-option').forEach(opt => {
                        opt.classList.remove('selected', 'border-blue-500');
                        opt.classList.add('border-gray-600');
                    });
                    this.classList.add('selected', 'border-blue-500');
                    this.classList.remove('border-gray-600');
                    
                    // Show sub-step 2
                    document.getElementById('data-source-substep-1').classList.add('hidden');
                    document.getElementById('data-source-substep-2').classList.remove('hidden');
                    
                    // Update header with selected type, icon, and label
                    const selectedTypeSpan = document.getElementById('selected-data-source-type');
                    const selectedIcon = document.getElementById('selected-data-source-icon');
                    const selectedLabel = document.getElementById('selected-data-source-label');
                    
                    if (selectedTypeSpan) {
                        selectedTypeSpan.textContent = dataType.charAt(0).toUpperCase() + dataType.slice(1);
                    }
                    
                    if (selectedIcon && selectedLabel) {
                        let iconName = '';
                        let labelText = '';
                        
                        if (dataType === 'database') {
                            iconName = 'storage';
                            labelText = 'Database';
                        } else if (dataType === 'api') {
                            iconName = 'api';
                            labelText = 'API';
                        } else if (dataType === 'file') {
                            iconName = 'upload_file';
                            labelText = 'File Upload';
                        } else if (dataType === 'ai-model') {
                            iconName = 'auto_awesome';
                            labelText = 'AI Model';
                        }
                        
                        selectedIcon.textContent = iconName;
                        selectedIcon.className = `material-symbols-outlined mr-3 text-xl ${dataType === 'database' ? 'text-blue-400' : dataType === 'api' ? 'text-green-400' : dataType === 'file' ? 'text-purple-400' : 'text-orange-400'}`;
                        selectedLabel.textContent = labelText;
                    }
                    
                    // Show appropriate configuration
                    document.querySelectorAll('.data-source-config').forEach(config => {
                        config.classList.add('hidden');
                    });
                    
                    const configElement = document.getElementById(dataType + '-config');
                    if (configElement) {
                        configElement.classList.remove('hidden');
                        
                        // If AI Model is selected, reset selection and update display
                        if (dataType === 'ai-model') {
                            selectedAiModel = null;
                            updateSelectedAiModelDisplay();
                            validateStep2();
                            updateWizardState();
                        } else if (dataType === 'database') {
                            selectedDatabase = null;
                            updateSelectedDatabaseDisplay();
                            validateStep2();
                            updateWizardState();
                        } else if (dataType === 'api') {
                            selectedApi = null;
                            updateSelectedApiDisplay();
                            validateStep2();
                            updateWizardState();
                        }
                    }
                    
                                            // Set current step to 2 for Data Source
                        currentStep = 2;
                        
                        // Run validation and update wizard state
                        validateStep2();
                        updateWizardState();
                });
            });

            // Visualization option click handlers
            document.querySelectorAll('.visualization-option').forEach(option => {
                option.addEventListener('click', function() {
                    const visualizationType = this.getAttribute('data-type');
                    selectedVisualizationType = visualizationType;
                    
                    // Update selected state
                    document.querySelectorAll('.visualization-option').forEach(opt => {
                        opt.classList.remove('selected', 'border-blue-500');
                        opt.classList.add('border-gray-600');
                    });
                    this.classList.add('selected', 'border-blue-500');
                    this.classList.remove('border-gray-600');
                    
                    // Show sub-step 2
                    document.getElementById('visualization-substep-1').classList.add('hidden');
                    document.getElementById('visualization-substep-2').classList.remove('hidden');
                    
                    // Update header with selected type, icon, and label
                    const selectedIcon = document.getElementById('selected-visualization-icon');
                    const selectedLabel = document.getElementById('selected-visualization-label');
                    
                    if (selectedIcon && selectedLabel) {
                        let iconName = '';
                        let labelText = '';
                        
                        if (visualizationType === 'chart') {
                            iconName = 'bar_chart';
                            labelText = 'Chart';
                        } else if (visualizationType === 'map-layer') {
                            iconName = 'map';
                            labelText = 'Map Layer';
                        } else if (visualizationType === 'kpi') {
                            iconName = 'monitoring';
                            labelText = 'KPI';
                        }
                        
                        selectedIcon.textContent = iconName;
                        selectedIcon.className = `material-symbols-outlined mr-3 text-xl ${visualizationType === 'chart' ? 'text-blue-400' : visualizationType === 'map-layer' ? 'text-green-400' : 'text-purple-400'}`;
                        selectedLabel.textContent = labelText;
                    }
                    
                    // Show appropriate configuration
                    document.querySelectorAll('.visualization-config').forEach(config => {
                        config.classList.add('hidden');
                    });
                    
                    const configElement = document.getElementById(visualizationType + '-config');
                    if (configElement) {
                        configElement.classList.remove('hidden');
                        
                        // Show data mapping immediately for KPI (no subtype needed)
                        if (visualizationType === 'kpi') {
                            const dataMappingConfig = document.getElementById('data-mapping-config');
                            if (dataMappingConfig) {
                                dataMappingConfig.classList.remove('hidden');
                                generateDataMappingFields();
                            }
                        }
                        
                        // Reset subtype selections when visualization type changes
                        if (visualizationType === 'chart') {
                            selectedChartSubtype = null;
                            const chartSubtypeSelect = document.getElementById('chart-subtype');
                            if (chartSubtypeSelect) {
                                chartSubtypeSelect.value = '';
                            }
                        } else if (visualizationType === 'map-layer') {
                            selectedMapLayerSubtype = null;
                            const mapLayerSubtypeSelect = document.getElementById('map-layer-subtype');
                            if (mapLayerSubtypeSelect) {
                                mapLayerSubtypeSelect.value = '';
                            }
                        }
                        
                        // Reset data mapping selections
                        selectedXAxisField = null;
                        selectedYAxisField = null;
                        selectedValueField = null;
                        selectedKpiField = null;
                        selectedSeriesFields = [];
                        selectedYAxisFields = [];
                        selectedLabelField = null;
                        
                        // Set current step to 3 for Visualization
                        currentStep = 3;
                        
                        // Run validation and update wizard state
                        validateStep3();
                        updateWizardState();
                    }
                });
            });

            // Change visualization button
            const changeVisualizationBtn = document.getElementById('change-visualization-btn');
            if (changeVisualizationBtn) {
                changeVisualizationBtn.addEventListener('click', function() {
                    // Go back to sub-step 1
                    document.getElementById('visualization-substep-2').classList.add('hidden');
                    document.getElementById('visualization-substep-1').classList.remove('hidden');
                    
                    // Clear selected state
                    document.querySelectorAll('.visualization-option').forEach(opt => {
                        opt.classList.remove('selected', 'border-blue-500');
                        opt.classList.add('border-gray-600');
                    });
                    
                    selectedVisualizationType = null;
                    selectedChartSubtype = null;
                    selectedMapLayerSubtype = null;
                    selectedXAxisField = null;
                    selectedYAxisField = null;
                    selectedValueField = null;
                    selectedKpiField = null;
                    selectedSeriesFields = [];
                    selectedYAxisFields = [];
                    selectedLabelField = null;
                    
                    // Reset subtype selects
                    const chartSubtypeSelect = document.getElementById('chart-subtype');
                    const mapLayerSubtypeSelect = document.getElementById('map-layer-subtype');
                    if (chartSubtypeSelect) chartSubtypeSelect.value = '';
                    if (mapLayerSubtypeSelect) mapLayerSubtypeSelect.value = '';
                    
                    validateStep3();
                    updateWizardState();
                });
            }

            // Add event listeners for Step 3 validation
            const chartSubtypeSelect = document.getElementById('chart-subtype');
            const mapLayerSubtypeSelect = document.getElementById('map-layer-subtype');

            if (chartSubtypeSelect) {
                chartSubtypeSelect.addEventListener('change', function() {
                    selectedChartSubtype = this.value;
                    
                    // Show data mapping after subtype selection
                    if (selectedChartSubtype) {
                        const dataMappingConfig = document.getElementById('data-mapping-config');
                        if (dataMappingConfig) {
                            dataMappingConfig.classList.remove('hidden');
                            generateDataMappingFields();
                        }
                    }
                    
                    validateStep3();
                    updateWizardState();
                });
            }

            if (mapLayerSubtypeSelect) {
                mapLayerSubtypeSelect.addEventListener('change', function() {
                    selectedMapLayerSubtype = this.value;
                    
                    // Show data mapping after subtype selection
                    if (selectedMapLayerSubtype) {
                        const dataMappingConfig = document.getElementById('data-mapping-config');
                        if (dataMappingConfig) {
                            dataMappingConfig.classList.remove('hidden');
                            generateDataMappingFields();
                        }
                    }
                    
                    validateStep3();
                    updateWizardState();
                });
            }



            // Change data source button
            const changeDataSourceBtn = document.getElementById('change-data-source-btn');
            if (changeDataSourceBtn) {
                changeDataSourceBtn.addEventListener('click', function() {
                    // Go back to sub-step 1
                    document.getElementById('data-source-substep-2').classList.add('hidden');
                    document.getElementById('data-source-substep-1').classList.remove('hidden');
                    
                    // Clear selected state
                    document.querySelectorAll('.data-source-option').forEach(opt => {
                        opt.classList.remove('selected', 'border-blue-500');
                        opt.classList.add('border-gray-600');
                    });
                    
                    selectedDataSourceType = null;
                    selectedAiModel = null;
                    selectedDatabase = null;
                    selectedApi = null;
                    updateSelectedAiModelDisplay();
                    updateSelectedDatabaseDisplay();
                    updateSelectedApiDisplay();
                    validateStep2();
                    updateWizardState();
                });
            }

            // Add event listeners for Step 2 validation
            const databaseFields = ['database-type', 'database-host', 'database-port', 'database-name', 'database-username', 'database-password'];
            const apiFields = ['api-url', 'api-auth-method', 'api-token'];

            // Database field validation
            databaseFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', function() {
                        validateStep2();
                        updateWizardState();
                    });
                    field.addEventListener('blur', function() {
                        validateStep2();
                        updateWizardState();
                    });
                    field.addEventListener('change', function() {
                        validateStep2();
                        updateWizardState();
                    });
                }
            });

            // API field validation
            apiFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', function() {
                        validateStep2();
                        updateWizardState();
                    });
                    field.addEventListener('blur', function() {
                        validateStep2();
                        updateWizardState();
                    });
                    field.addEventListener('change', function() {
                        validateStep2();
                        updateWizardState();
                    });
                }
            });

            // API authentication method change handler
            const apiAuthMethod = document.getElementById('api-auth-method');
            if (apiAuthMethod) {
                apiAuthMethod.addEventListener('change', function() {
                    const apiAuthFields = document.getElementById('api-auth-fields');
                    if (apiAuthFields) {
                        if (this.value === 'none') {
                            apiAuthFields.classList.add('hidden');
                        } else {
                            apiAuthFields.classList.remove('hidden');
                        }
                    }
                    validateStep2();
                    updateWizardState();
                });
            }

            // Use global aiModels array instead of local one

            // Use global variables instead of redeclaring
            tempSelectedAiModel = selectedAiModel;

            // AI Model Modal Functionality
            const aiModelSelectionModal = document.getElementById('ai-model-selection-modal');
            const selectAiModelBtn = document.getElementById('select-ai-model-btn');
            const changeAiModelBtn = document.getElementById('change-ai-model-btn');
            const closeAiModelModal = document.getElementById('close-ai-model-modal');
            const cancelAiModelSelection = document.getElementById('cancel-ai-model-selection');
            const confirmAiModelSelection = document.getElementById('confirm-ai-model-selection');
            const aiModelSelectionContainer = document.getElementById('ai-model-selection-container');
            const selectedAiModelDisplay = document.getElementById('selected-ai-model-display');

            function openAiModelModal() {
                aiModelSelectionModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                tempSelectedAiModel = selectedAiModel;
                populateAiModelModalList();
                updateConfirmButton();
            }

            function closeAiModelModalFunction() {
                aiModelSelectionModal.classList.add('hidden');
                document.body.style.overflow = '';
                tempSelectedAiModel = selectedAiModel; // Reset to current selection
            }

            function populateAiModelModalList(models = aiModels) {
                const aiModelModalList = document.getElementById('ai-model-modal-list');
                if (!aiModelModalList) return;

                aiModelModalList.innerHTML = '';
                
                if (models.length === 0) {
                    aiModelModalList.innerHTML = '<div class="p-4 text-center text-gray-400">No models found</div>';
                    return;
                }

                models.forEach(model => {
                    const modelItem = document.createElement('div');
                    const isSelected = tempSelectedAiModel === model.id;
                    modelItem.className = `ai-model-modal-item p-3 cursor-pointer transition duration-200 border border-gray-600 rounded-md ${isSelected ? 'bg-blue-600 border-blue-500' : 'hover:bg-gray-800'}`;
                    modelItem.setAttribute('data-model-id', model.id);
                    
                    modelItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h4 class="text-white font-medium">${model.name}</h4>
                                    <span class="text-xs px-2 py-1 rounded-full bg-gray-700 text-gray-300">${model.provider}</span>
                                    <span class="text-xs px-2 py-1 rounded-full bg-gray-700 text-gray-300">${model.type}</span>
                                </div>
                                <p class="text-sm mt-1 ${isSelected ? 'text-gray-300' : 'text-gray-400'}">${model.description}</p>
                            </div>
                            ${tempSelectedAiModel === model.id ? '<span class="material-symbols-outlined text-white">check_circle</span>' : ''}
                        </div>
                    `;
                    
                    modelItem.addEventListener('click', function() {
                        // Remove previous selection
                        document.querySelectorAll('.ai-model-modal-item').forEach(item => {
                            item.classList.remove('bg-blue-600', 'border-blue-500');
                            item.classList.add('hover:bg-gray-800');
                            // Reset description text color
                            const description = item.querySelector('p');
                            if (description) {
                                description.classList.remove('text-gray-300');
                                description.classList.add('text-gray-400');
                            }
                        });
                        
                        // Set new selection
                        tempSelectedAiModel = model.id;
                        this.classList.remove('hover:bg-gray-800');
                        this.classList.add('bg-blue-600', 'border-blue-500');
                        
                        // Update description text color for selected item
                        const selectedDescription = this.querySelector('p');
                        if (selectedDescription) {
                            selectedDescription.classList.remove('text-gray-400');
                            selectedDescription.classList.add('text-gray-300');
                        }
                        
                        // Update check mark
                        document.querySelectorAll('.ai-model-modal-item .material-symbols-outlined').forEach(icon => {
                            icon.style.display = 'none';
                        });
                        const checkIcon = this.querySelector('.material-symbols-outlined');
                        if (checkIcon) {
                            checkIcon.style.display = 'block';
                        }
                        
                        updateConfirmButton();
                    });
                    
                    aiModelModalList.appendChild(modelItem);
                });
            }

            function updateConfirmButton() {
                if (confirmAiModelSelection) {
                    if (tempSelectedAiModel) {
                        confirmAiModelSelection.disabled = false;
                        confirmAiModelSelection.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        confirmAiModelSelection.disabled = true;
                        confirmAiModelSelection.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
            }



            // Event Listeners for AI Model Modal
            if (selectAiModelBtn) {
                selectAiModelBtn.addEventListener('click', openAiModelModal);
            }

            if (changeAiModelBtn) {
                changeAiModelBtn.addEventListener('click', openAiModelModal);
            }

            if (closeAiModelModal) {
                closeAiModelModal.addEventListener('click', closeAiModelModalFunction);
            }

            if (cancelAiModelSelection) {
                cancelAiModelSelection.addEventListener('click', closeAiModelModalFunction);
            }

            if (confirmAiModelSelection) {
                confirmAiModelSelection.addEventListener('click', function() {
                    if (tempSelectedAiModel) {
                        selectedAiModel = tempSelectedAiModel;
                        updateSelectedAiModelDisplay();
                        closeAiModelModalFunction();
                        
                        // Run validation and update wizard state
                        validateStep2();
                        updateWizardState();
                    }
                });
            }

            // AI Model Modal Search functionality
            const aiModelModalSearch = document.getElementById('ai-model-modal-search');
            if (aiModelModalSearch) {
                aiModelModalSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    filteredAiModels = aiModels.filter(model => 
                        model.name.toLowerCase().includes(searchTerm) ||
                        model.description.toLowerCase().includes(searchTerm) ||
                        model.provider.toLowerCase().includes(searchTerm) ||
                        model.type.toLowerCase().includes(searchTerm)
                    );
                    populateAiModelModalList(filteredAiModels);
                });
            }

            // AI Model Modal Filter functionality
            const aiModelModalFilterBtn = document.getElementById('ai-model-modal-filter-btn');
            const aiModelModalFilterDropdown = document.getElementById('ai-model-modal-filter-dropdown');
            
            if (aiModelModalFilterBtn && aiModelModalFilterDropdown) {
                aiModelModalFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // Toggle dropdown visibility
                    const isVisible = !aiModelModalFilterDropdown.classList.contains('hidden');
                    
                    if (isVisible) {
                        // Hide dropdown
                        aiModelModalFilterDropdown.classList.add('hidden');
                        if (aiModelModalFilterDropdown.parentNode === document.body) {
                            document.body.removeChild(aiModelModalFilterDropdown);
                        }
                    } else {
                        // Show dropdown
                        aiModelModalFilterDropdown.classList.remove('hidden');
                        
                        // Append to body if not already there
                        if (aiModelModalFilterDropdown.parentNode !== document.body) {
                            document.body.appendChild(aiModelModalFilterDropdown);
                        }
                        
                        // Position the dropdown relative to the button
                        const buttonRect = aiModelModalFilterBtn.getBoundingClientRect();
                        aiModelModalFilterDropdown.style.position = 'fixed';
                        aiModelModalFilterDropdown.style.top = (buttonRect.bottom + 5) + 'px';
                        aiModelModalFilterDropdown.style.right = (window.innerWidth - buttonRect.right) + 'px';
                        aiModelModalFilterDropdown.style.zIndex = '9999';
                    }
                });

                // Close filter dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!aiModelModalFilterBtn.contains(e.target) && !aiModelModalFilterDropdown.contains(e.target)) {
                        aiModelModalFilterDropdown.classList.add('hidden');
                        if (aiModelModalFilterDropdown.parentNode === document.body) {
                            document.body.removeChild(aiModelModalFilterDropdown);
                        }
                    }
                });

                // Filter checkboxes
                const filterCheckboxes = aiModelModalFilterDropdown.querySelectorAll('input[type="checkbox"]');
                filterCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const searchTerm = aiModelModalSearch ? aiModelModalSearch.value.toLowerCase() : '';
                        const selectedFilters = Array.from(filterCheckboxes)
                            .filter(cb => cb.checked)
                            .map(cb => cb.getAttribute('data-filter'));

                        if (selectedFilters.length === 0) {
                            // No filters selected, show all models
                            filteredAiModels = aiModels.filter(model => 
                                model.name.toLowerCase().includes(searchTerm) ||
                                model.description.toLowerCase().includes(searchTerm) ||
                                model.provider.toLowerCase().includes(searchTerm) ||
                                model.type.toLowerCase().includes(searchTerm)
                            );
                        } else {
                            // Apply filters
                            filteredAiModels = aiModels.filter(model => {
                                const matchesSearch = model.name.toLowerCase().includes(searchTerm) ||
                                    model.description.toLowerCase().includes(searchTerm) ||
                                    model.provider.toLowerCase().includes(searchTerm) ||
                                    model.type.toLowerCase().includes(searchTerm);
                                
                                const matchesFilter = selectedFilters.some(filter => 
                                    model.provider === filter || model.type === filter
                                );
                                
                                return matchesSearch && matchesFilter;
                            });
                        }
                        
                        populateAiModelModalList(filteredAiModels);
                    });
                });
            }

            // Initialize Step 1 validation when modal opens
            if (createComponentBtn) {
                createComponentBtn.addEventListener('click', function() {
                    if (createComponentModal) {
                        createComponentModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                        currentStep = 1;
                        updateWizardState();
                        
                        // Initialize validation after a short delay to ensure DOM is ready
                        setTimeout(validateStep1, 100);
                    }
                });
            }

            if (prevStepBtn) {
                prevStepBtn.addEventListener('click', function() {
                    if (currentStep > 1) {
                        currentStep--;
                        updateWizardState();
                    }
                });
            }

            if (finishBtn) {
                finishBtn.addEventListener('click', function() {
                    // Handle component creation
                    console.log('Creating component...');
                    if (createComponentModal) {
                        createComponentModal.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                });
            }

            // Step tab navigation
            const wizardStepTabs = document.querySelectorAll('.wizard-step-tab');
            if (wizardStepTabs.length > 0) {
                wizardStepTabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const stepNumber = parseInt(this.getAttribute('data-step'));
                        
                        // Only allow navigation to enabled steps
                        if (stepNumber === 1) {
                            // Step 1 is always enabled
                            currentStep = stepNumber;
                            updateWizardState();
                        } else if (stepNumber === 2) {
                            // Step 2 is only enabled if Step 1 is complete
                            if (validateStep1Fields()) {
                                currentStep = stepNumber;
                                updateWizardState();
                            }
                        } else if (stepNumber === 3) {
                            // Step 3 is only enabled if Step 2 is complete
                            if (validateStep2Fields()) {
                                currentStep = stepNumber;
                                updateWizardState();
                            }
                        } else if (stepNumber === 4) {
                            // Step 4 is only enabled if Step 3 is complete (including data mapping)
                            if (validateStep3Fields() && validateStep3DataMapping()) {
                                currentStep = stepNumber;
                                updateWizardState();
                            }
                        } else if (stepNumber === 5) {
                            // Step 5 is enabled when Step 4 is valid (filters are optional or properly mapped)
                            const isStep3Complete = validateStep3Fields() && validateStep3DataMapping();
                            const isStep4Valid = validateStep4Fields();
                            if (isStep3Complete && isStep4Valid) {
                                currentStep = stepNumber;
                                updateWizardState();
                            }
                        }
                    });
                });
            }
        });

        // Database and API Modal Functionality
        document.addEventListener('DOMContentLoaded', function() {

            // Database Modal Functionality
            const databaseSelectionModal = document.getElementById('database-selection-modal');
            const selectDatabaseBtn = document.getElementById('select-database-btn');
            const changeDatabaseBtn = document.getElementById('change-database-btn');
            const closeDatabaseModal = document.getElementById('close-database-modal');
            const cancelDatabaseSelection = document.getElementById('cancel-database-selection');
            const confirmDatabaseSelection = document.getElementById('confirm-database-selection');
            const databaseSelectionContainer = document.getElementById('database-selection-container');
            const selectedDatabaseDisplay = document.getElementById('selected-database-display');

            // Create Database Modal
            const createDatabaseModal = document.getElementById('create-database-modal');
            const createDatabaseBtn = document.getElementById('create-database-btn');
            const closeCreateDatabaseModal = document.getElementById('close-create-database-modal');
            const cancelCreateDatabase = document.getElementById('cancel-create-database');
            const confirmCreateDatabase = document.getElementById('confirm-create-database');

            function openDatabaseModal() {
                databaseSelectionModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                tempSelectedDatabase = selectedDatabase;
                populateDatabaseModalList();
                updateDatabaseConfirmButton();
            }

            function closeDatabaseModalFunction() {
                databaseSelectionModal.classList.add('hidden');
                document.body.style.overflow = '';
                tempSelectedDatabase = selectedDatabase;
            }

            function openCreateDatabaseModal() {
                createDatabaseModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeCreateDatabaseModalFunction() {
                createDatabaseModal.classList.add('hidden');
                document.body.style.overflow = '';
            }

            function populateDatabaseModalList(models = databases) {
                const databaseModalList = document.getElementById('database-modal-list');
                if (!databaseModalList) return;

                databaseModalList.innerHTML = '';
                
                if (models.length === 0) {
                    databaseModalList.innerHTML = '<div class="p-4 text-center text-gray-400">No database connections found</div>';
                    return;
                }

                models.forEach(db => {
                    const dbItem = document.createElement('div');
                    const isSelected = tempSelectedDatabase === db.id;
                    dbItem.className = `database-modal-item p-3 cursor-pointer transition duration-200 border border-gray-600 rounded-md ${isSelected ? 'bg-blue-600 border-blue-500' : 'hover:bg-gray-800'}`;
                    dbItem.setAttribute('data-database-id', db.id);
                    
                    dbItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h4 class="text-white font-medium">${db.name}</h4>
                                    <span class="text-xs px-2 py-1 rounded-full bg-gray-700 text-gray-300">${db.type}</span>
                                </div>
                                <div class="mt-1 ${isSelected ? 'text-gray-300' : 'text-gray-400'}">
                                    <p class="text-sm">${db.description}</p>
                                    <p class="text-xs mt-1">${db.host}:${db.port} - ${db.dbname}</p>
                                </div>
                            </div>
                            ${tempSelectedDatabase === db.id ? '<span class="material-symbols-outlined text-white">check_circle</span>' : ''}
                        </div>
                    `;
                    
                    dbItem.addEventListener('click', function() {
                        // Remove previous selection
                        document.querySelectorAll('.database-modal-item').forEach(item => {
                            item.classList.remove('bg-blue-600', 'border-blue-500');
                            item.classList.add('hover:bg-gray-800');
                            const descriptionContainer = item.querySelector('div.mt-1');
                            if (descriptionContainer) {
                                descriptionContainer.classList.remove('text-gray-300');
                                descriptionContainer.classList.add('text-gray-400');
                            }
                        });
                        
                        // Set new selection
                        tempSelectedDatabase = db.id;
                        this.classList.remove('hover:bg-gray-800');
                        this.classList.add('bg-blue-600', 'border-blue-500');
                        
                        // Update description text color for selected item
                        const selectedDescriptionContainer = this.querySelector('div.mt-1');
                        if (selectedDescriptionContainer) {
                            selectedDescriptionContainer.classList.remove('text-gray-400');
                            selectedDescriptionContainer.classList.add('text-gray-300');
                        }
                        
                        // Update check mark
                        document.querySelectorAll('.database-modal-item .material-symbols-outlined').forEach(icon => {
                            icon.style.display = 'none';
                        });
                        const checkIcon = this.querySelector('.material-symbols-outlined');
                        if (checkIcon) {
                            checkIcon.style.display = 'block';
                        }
                        
                        updateDatabaseConfirmButton();
                    });
                    
                    databaseModalList.appendChild(dbItem);
                });
            }

            function updateDatabaseConfirmButton() {
                if (confirmDatabaseSelection) {
                    if (tempSelectedDatabase) {
                        confirmDatabaseSelection.disabled = false;
                        confirmDatabaseSelection.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        confirmDatabaseSelection.disabled = true;
                        confirmDatabaseSelection.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
            }



            // API Modal Functionality
            const apiSelectionModal = document.getElementById('api-selection-modal');
            const selectApiBtn = document.getElementById('select-api-btn');
            const changeApiBtn = document.getElementById('change-api-btn');
            const closeApiModal = document.getElementById('close-api-modal');
            const cancelApiSelection = document.getElementById('cancel-api-selection');
            const confirmApiSelection = document.getElementById('confirm-api-selection');
            const apiSelectionContainer = document.getElementById('api-selection-container');
            const selectedApiDisplay = document.getElementById('selected-api-display');

            // Create API Modal
            const createApiModal = document.getElementById('create-api-modal');
            const createApiBtn = document.getElementById('create-api-btn');
            const closeCreateApiModal = document.getElementById('close-create-api-modal');
            const cancelCreateApi = document.getElementById('cancel-create-api');
            const confirmCreateApi = document.getElementById('confirm-create-api');

            function openApiModal() {
                apiSelectionModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                tempSelectedApi = selectedApi;
                populateApiModalList();
                updateApiConfirmButton();
            }

            function closeApiModalFunction() {
                apiSelectionModal.classList.add('hidden');
                document.body.style.overflow = '';
                tempSelectedApi = selectedApi;
            }

            function openCreateApiModal() {
                createApiModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeCreateApiModalFunction() {
                createApiModal.classList.add('hidden');
                document.body.style.overflow = '';
            }

            function populateApiModalList(models = apis) {
                const apiModalList = document.getElementById('api-modal-list');
                if (!apiModalList) return;

                apiModalList.innerHTML = '';
                
                if (models.length === 0) {
                    apiModalList.innerHTML = '<div class="p-4 text-center text-gray-400">No API connections found</div>';
                    return;
                }

                models.forEach(api => {
                    const apiItem = document.createElement('div');
                    const isSelected = tempSelectedApi === api.id;
                    apiItem.className = `api-modal-item p-3 cursor-pointer transition duration-200 border border-gray-600 rounded-md ${isSelected ? 'bg-blue-600 border-blue-500' : 'hover:bg-gray-800'}`;
                    apiItem.setAttribute('data-api-id', api.id);
                    
                    apiItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-2">
                                    <h4 class="text-white font-medium">${api.name}</h4>
                                    <span class="text-xs px-2 py-1 rounded-full bg-gray-700 text-gray-300">${api.method}</span>
                                    <span class="text-xs px-2 py-1 rounded-full ${api.auth === 'none' ? 'bg-green-900 text-green-300' : api.auth === 'bearer' ? 'bg-blue-900 text-blue-300' : api.auth === 'basic' ? 'bg-purple-900 text-purple-300' : 'bg-orange-900 text-orange-300'}">${api.auth}</span>
                                </div>
                                <div class="mt-1 ${isSelected ? 'text-gray-300' : 'text-gray-400'}">
                                    <p class="text-sm">${api.description}</p>
                                    <p class="text-xs mt-1">${api.url}</p>
                                </div>
                            </div>
                            ${tempSelectedApi === api.id ? '<span class="material-symbols-outlined text-white">check_circle</span>' : ''}
                        </div>
                    `;
                    
                    apiItem.addEventListener('click', function() {
                        // Remove previous selection
                        document.querySelectorAll('.api-modal-item').forEach(item => {
                            item.classList.remove('bg-blue-600', 'border-blue-500');
                            item.classList.add('hover:bg-gray-800');
                            const descriptionContainer = item.querySelector('div.mt-1');
                            if (descriptionContainer) {
                                descriptionContainer.classList.remove('text-gray-300');
                                descriptionContainer.classList.add('text-gray-400');
                            }
                        });
                        
                        // Set new selection
                        tempSelectedApi = api.id;
                        this.classList.remove('hover:bg-gray-800');
                        this.classList.add('bg-blue-600', 'border-blue-500');
                        
                        // Update description text color for selected item
                        const selectedDescriptionContainer = this.querySelector('div.mt-1');
                        if (selectedDescriptionContainer) {
                            selectedDescriptionContainer.classList.remove('text-gray-400');
                            selectedDescriptionContainer.classList.add('text-gray-300');
                        }
                        
                        // Update check mark
                        document.querySelectorAll('.api-modal-item .material-symbols-outlined').forEach(icon => {
                            icon.style.display = 'none';
                        });
                        const checkIcon = this.querySelector('.material-symbols-outlined');
                        if (checkIcon) {
                            checkIcon.style.display = 'block';
                        }
                        
                        updateApiConfirmButton();
                    });
                    
                    apiModalList.appendChild(apiItem);
                });
            }

            function updateApiConfirmButton() {
                if (confirmApiSelection) {
                    if (tempSelectedApi) {
                        confirmApiSelection.disabled = false;
                        confirmApiSelection.classList.remove('opacity-50', 'cursor-not-allowed');
                    } else {
                        confirmApiSelection.disabled = true;
                        confirmApiSelection.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                }
            }

            // Database Modal Filter functionality
            const databaseModalFilterBtn = document.getElementById('database-modal-filter-btn');
            const databaseModalFilterDropdown = document.getElementById('database-modal-filter-dropdown');
            
            if (databaseModalFilterBtn && databaseModalFilterDropdown) {
                databaseModalFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // Toggle dropdown visibility
                    const isVisible = !databaseModalFilterDropdown.classList.contains('hidden');
                    
                    if (isVisible) {
                        // Hide dropdown
                        databaseModalFilterDropdown.classList.add('hidden');
                        if (databaseModalFilterDropdown.parentNode === document.body) {
                            document.body.removeChild(databaseModalFilterDropdown);
                        }
                    } else {
                        // Show dropdown
                        databaseModalFilterDropdown.classList.remove('hidden');
                        
                        // Append to body if not already there
                        if (databaseModalFilterDropdown.parentNode !== document.body) {
                            document.body.appendChild(databaseModalFilterDropdown);
                        }
                        
                        // Position the dropdown relative to the button
                        const buttonRect = databaseModalFilterBtn.getBoundingClientRect();
                        databaseModalFilterDropdown.style.position = 'fixed';
                        databaseModalFilterDropdown.style.top = (buttonRect.bottom + 5) + 'px';
                        databaseModalFilterDropdown.style.right = (window.innerWidth - buttonRect.right) + 'px';
                        databaseModalFilterDropdown.style.zIndex = '9999';
                    }
                });

                // Close filter dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!databaseModalFilterBtn.contains(e.target) && !databaseModalFilterDropdown.contains(e.target)) {
                        databaseModalFilterDropdown.classList.add('hidden');
                        if (databaseModalFilterDropdown.parentNode === document.body) {
                            document.body.removeChild(databaseModalFilterDropdown);
                        }
                    }
                });

                // Filter checkboxes
                const databaseFilterCheckboxes = databaseModalFilterDropdown.querySelectorAll('input[type="checkbox"]');
                databaseFilterCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const searchTerm = document.getElementById('database-modal-search') ? document.getElementById('database-modal-search').value.toLowerCase() : '';
                        const selectedFilters = Array.from(databaseFilterCheckboxes)
                            .filter(cb => cb.checked)
                            .map(cb => cb.getAttribute('data-filter'));

                        if (selectedFilters.length === 0) {
                            // No filters selected, show all databases
                            filteredDatabases = databases.filter(db => 
                                db.name.toLowerCase().includes(searchTerm) ||
                                db.description.toLowerCase().includes(searchTerm) ||
                                db.type.toLowerCase().includes(searchTerm)
                            );
                        } else {
                            // Apply filters
                            filteredDatabases = databases.filter(db => {
                                const matchesSearch = db.name.toLowerCase().includes(searchTerm) ||
                                    db.description.toLowerCase().includes(searchTerm) ||
                                    db.type.toLowerCase().includes(searchTerm);
                                
                                const matchesFilter = selectedFilters.some(filter => 
                                    db.type === filter
                                );
                                
                                return matchesSearch && matchesFilter;
                            });
                        }
                        
                        populateDatabaseModalList(filteredDatabases);
                    });
                });
            }

            // API Modal Filter functionality
            const apiModalFilterBtn = document.getElementById('api-modal-filter-btn');
            const apiModalFilterDropdown = document.getElementById('api-modal-filter-dropdown');
            
            if (apiModalFilterBtn && apiModalFilterDropdown) {
                apiModalFilterBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // Toggle dropdown visibility
                    const isVisible = !apiModalFilterDropdown.classList.contains('hidden');
                    
                    if (isVisible) {
                        // Hide dropdown
                        apiModalFilterDropdown.classList.add('hidden');
                        if (apiModalFilterDropdown.parentNode === document.body) {
                            document.body.removeChild(apiModalFilterDropdown);
                        }
                    } else {
                        // Show dropdown
                        apiModalFilterDropdown.classList.remove('hidden');
                        
                        // Append to body if not already there
                        if (apiModalFilterDropdown.parentNode !== document.body) {
                            document.body.appendChild(apiModalFilterDropdown);
                        }
                        
                        // Position the dropdown relative to the button
                        const buttonRect = apiModalFilterBtn.getBoundingClientRect();
                        apiModalFilterDropdown.style.position = 'fixed';
                        apiModalFilterDropdown.style.top = (buttonRect.bottom + 5) + 'px';
                        apiModalFilterDropdown.style.right = (window.innerWidth - buttonRect.right) + 'px';
                        apiModalFilterDropdown.style.zIndex = '9999';
                    }
                });

                // Close filter dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!apiModalFilterBtn.contains(e.target) && !apiModalFilterDropdown.contains(e.target)) {
                        apiModalFilterDropdown.classList.add('hidden');
                        if (apiModalFilterDropdown.parentNode === document.body) {
                            document.body.removeChild(apiModalFilterDropdown);
                        }
                    }
                });

                // Filter checkboxes
                const apiFilterCheckboxes = apiModalFilterDropdown.querySelectorAll('input[type="checkbox"]');
                apiFilterCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const searchTerm = document.getElementById('api-modal-search') ? document.getElementById('api-modal-search').value.toLowerCase() : '';
                        const selectedFilters = Array.from(apiFilterCheckboxes)
                            .filter(cb => cb.checked)
                            .map(cb => cb.getAttribute('data-filter'));

                        if (selectedFilters.length === 0) {
                            // No filters selected, show all APIs
                            filteredApis = apis.filter(api => 
                                api.name.toLowerCase().includes(searchTerm) ||
                                api.description.toLowerCase().includes(searchTerm) ||
                                api.method.toLowerCase().includes(searchTerm) ||
                                api.auth.toLowerCase().includes(searchTerm)
                            );
                        } else {
                            // Apply filters
                            filteredApis = apis.filter(api => {
                                const matchesSearch = api.name.toLowerCase().includes(searchTerm) ||
                                    api.description.toLowerCase().includes(searchTerm) ||
                                    api.method.toLowerCase().includes(searchTerm) ||
                                    api.auth.toLowerCase().includes(searchTerm);
                                
                                const matchesFilter = selectedFilters.some(filter => 
                                    api.method === filter || api.auth === filter
                                );
                                
                                return matchesSearch && matchesFilter;
                            });
                        }
                        
                        populateApiModalList(filteredApis);
                    });
                });
            }

            // Database Modal Search functionality
            const databaseModalSearch = document.getElementById('database-modal-search');
            if (databaseModalSearch) {
                databaseModalSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const selectedFilters = databaseModalFilterDropdown ? Array.from(databaseModalFilterDropdown.querySelectorAll('input[type="checkbox"]:checked'))
                        .map(cb => cb.getAttribute('data-filter')) : [];

                    if (selectedFilters.length === 0) {
                        // No filters selected, show all databases
                        filteredDatabases = databases.filter(db => 
                            db.name.toLowerCase().includes(searchTerm) ||
                            db.description.toLowerCase().includes(searchTerm) ||
                            db.type.toLowerCase().includes(searchTerm)
                        );
                    } else {
                        // Apply filters
                        filteredDatabases = databases.filter(db => {
                            const matchesSearch = db.name.toLowerCase().includes(searchTerm) ||
                                db.description.toLowerCase().includes(searchTerm) ||
                                db.type.toLowerCase().includes(searchTerm);
                            
                            const matchesFilter = selectedFilters.some(filter => 
                                db.type === filter
                            );
                            
                            return matchesSearch && matchesFilter;
                        });
                    }
                    
                    populateDatabaseModalList(filteredDatabases);
                });
            }

            // API Modal Search functionality
            const apiModalSearch = document.getElementById('api-modal-search');
            if (apiModalSearch) {
                apiModalSearch.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const selectedFilters = apiModalFilterDropdown ? Array.from(apiModalFilterDropdown.querySelectorAll('input[type="checkbox"]:checked'))
                        .map(cb => cb.getAttribute('data-filter')) : [];

                    if (selectedFilters.length === 0) {
                        // No filters selected, show all APIs
                        filteredApis = apis.filter(api => 
                            api.name.toLowerCase().includes(searchTerm) ||
                            api.description.toLowerCase().includes(searchTerm) ||
                            api.method.toLowerCase().includes(searchTerm) ||
                            api.auth.toLowerCase().includes(searchTerm)
                        );
                    } else {
                        // Apply filters
                        filteredApis = apis.filter(api => {
                            const matchesSearch = api.name.toLowerCase().includes(searchTerm) ||
                                api.description.toLowerCase().includes(searchTerm) ||
                                api.method.toLowerCase().includes(searchTerm) ||
                                api.auth.toLowerCase().includes(searchTerm);
                            
                            const matchesFilter = selectedFilters.some(filter => 
                                api.method === filter || api.auth === filter
                            );
                            
                            return matchesSearch && matchesFilter;
                        });
                    }
                    
                    populateApiModalList(filteredApis);
                });
            }

            // Event Listeners for Database Modal
            if (selectDatabaseBtn) {
                selectDatabaseBtn.addEventListener('click', openDatabaseModal);
            }

            if (changeDatabaseBtn) {
                changeDatabaseBtn.addEventListener('click', function() {
                    // Hide the query field when changing database connection
                    const queryField = document.getElementById('database-query-field');
                    if (queryField) {
                        queryField.classList.add('hidden');
                    }
                    openDatabaseModal();
                });
            }

            if (closeDatabaseModal) {
                closeDatabaseModal.addEventListener('click', closeDatabaseModalFunction);
            }

            if (cancelDatabaseSelection) {
                cancelDatabaseSelection.addEventListener('click', closeDatabaseModalFunction);
            }

            if (confirmDatabaseSelection) {
                confirmDatabaseSelection.addEventListener('click', function() {
                    if (tempSelectedDatabase) {
                        selectedDatabase = tempSelectedDatabase;
                        updateSelectedDatabaseDisplay();
                        closeDatabaseModalFunction();
                        
                        // Show connection status
                        showDatabaseConnectionStatus();
                        
                        // Run validation and update wizard state
                        validateStep2();
                        updateWizardState();
                    }
                });
            }

            // Event Listeners for Create Database Modal
            if (createDatabaseBtn) {
                createDatabaseBtn.addEventListener('click', openCreateDatabaseModal);
            }

            if (closeCreateDatabaseModal) {
                closeCreateDatabaseModal.addEventListener('click', closeCreateDatabaseModalFunction);
            }

            if (cancelCreateDatabase) {
                cancelCreateDatabase.addEventListener('click', closeCreateDatabaseModalFunction);
            }

            if (confirmCreateDatabase) {
                confirmCreateDatabase.addEventListener('click', function() {
                    // Get form values
                    const name = document.getElementById('new-database-name').value;
                    const type = document.getElementById('new-database-type').value;
                    const host = document.getElementById('new-database-host').value;
                    const port = document.getElementById('new-database-port').value;
                    const dbname = document.getElementById('new-database-dbname').value;
                    const username = document.getElementById('new-database-username').value;
                    const password = document.getElementById('new-database-password').value;

                    if (name && type && host && port && dbname && username && password) {
                        // Create new database connection
                        const newDb = {
                            id: `db-${Date.now()}`,
                            name: name,
                            type: type,
                            host: host,
                            port: port,
                            dbname: dbname,
                            username: username,
                            description: `${type} database at ${host}:${port}`
                        };

                        // Add to databases array
                        databases.push(newDb);
                        filteredDatabases = [...databases];

                        // Select the new database
                        selectedDatabase = newDb.id;
                        tempSelectedDatabase = newDb.id;

                        // Update displays
                        updateSelectedDatabaseDisplay();
                        populateDatabaseModalList();

                        // Close modals
                        closeCreateDatabaseModalFunction();
                        closeDatabaseModalFunction();

                        // Run validation and update wizard state
                        validateStep2();
                        updateWizardState();
                    }
                });
            }

            // Event Listeners for API Modal
            if (selectApiBtn) {
                selectApiBtn.addEventListener('click', openApiModal);
            }

            if (changeApiBtn) {
                changeApiBtn.addEventListener('click', openApiModal);
            }

            if (closeApiModal) {
                closeApiModal.addEventListener('click', closeApiModalFunction);
            }

            if (cancelApiSelection) {
                cancelApiSelection.addEventListener('click', closeApiModalFunction);
            }

            if (confirmApiSelection) {
                confirmApiSelection.addEventListener('click', function() {
                    if (tempSelectedApi) {
                        selectedApi = tempSelectedApi;
                        updateSelectedApiDisplay();
                        closeApiModalFunction();
                        
                        // Show connection status
                        showApiConnectionStatus();
                        
                        // Run validation and update wizard state
                        validateStep2();
                        updateWizardState();
                    }
                });
            }

            // Event Listeners for Create API Modal
            if (createApiBtn) {
                createApiBtn.addEventListener('click', openCreateApiModal);
            }

            if (closeCreateApiModal) {
                closeCreateApiModal.addEventListener('click', closeCreateApiModalFunction);
            }

            if (cancelCreateApi) {
                cancelCreateApi.addEventListener('click', closeCreateApiModalFunction);
            }

            if (confirmCreateApi) {
                confirmCreateApi.addEventListener('click', function() {
                    // Get form values
                    const name = document.getElementById('new-api-name').value;
                    const url = document.getElementById('new-api-url').value;
                    const auth = document.getElementById('new-api-auth-method').value;
                    const method = document.getElementById('new-api-method').value;

                    if (name && url && method) {
                        // Create new API connection
                        const newApi = {
                            id: `api-${Date.now()}`,
                            name: name,
                            url: url,
                            auth: auth,
                            method: method,
                            description: `${method} API at ${url}`
                        };

                        // Add to apis array
                        apis.push(newApi);
                        filteredApis = [...apis];

                        // Select the new API
                        selectedApi = newApi.id;
                        tempSelectedApi = newApi.id;

                        // Update displays
                        updateSelectedApiDisplay();
                        populateApiModalList();

                        // Close modals
                        closeCreateApiModalFunction();
                        closeApiModalFunction();

                        // Run validation and update wizard state
                        validateStep2();
                        updateWizardState();
                    }
                });
            }

            // API Authentication method change handler for Create API Modal
            const newApiAuthMethod = document.getElementById('new-api-auth-method');
            if (newApiAuthMethod) {
                newApiAuthMethod.addEventListener('change', function() {
                    const newApiAuthFields = document.getElementById('new-api-auth-fields');
                    if (newApiAuthFields) {
                        if (this.value === 'none') {
                            newApiAuthFields.classList.add('hidden');
                        } else {
                            newApiAuthFields.classList.remove('hidden');
                        }
                    }
                });
            }
        });
    </script>

    <!-- Create Component Modal -->
    <div id="create-component-modal" class="fixed inset-0 p-10 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-full max-w-[1520px] flex flex-col">
            <!-- Modal Header -->
            <div class="py-4 px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-white">Create Component</h2>
                    <button id="close-create-component-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Wizard Steps Indicator -->
            <div class="px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-6 user-select-none">
                        <div id="step-1-tab" class="wizard-step-tab flex flex-col items-center cursor-pointer py-3 border-b-2 border-blue-500" data-step="1">
                            <div id="step-1-indicator" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-medium mb-1">1</div>
                            <span class="text-blue-400 text-xs text-center">General Info</span>
                        </div>
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-gray-600 text-lg">arrow_forward</span>
                        </div>
                        
                        <div id="step-2-tab" class="wizard-step-tab flex flex-col items-center cursor-not-allowed py-3 border-b-2 border-transparent" data-step="2">
                            <div id="step-2-indicator" class="w-8 h-8 rounded-full bg-gray-600 text-gray-400 flex items-center justify-center text-sm font-medium mb-1">2</div>
                            <span class="text-gray-400 text-xs text-center">Data Source</span>
                        </div>
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-gray-600 text-lg">arrow_forward</span>
                        </div>
                        
                        <div id="step-3-tab" class="wizard-step-tab flex flex-col items-center cursor-not-allowed py-3 border-b-2 border-transparent" data-step="3">
                            <div id="step-3-indicator" class="w-8 h-8 rounded-full bg-gray-600 text-gray-400 flex items-center justify-center text-sm font-medium mb-1">3</div>
                            <span class="text-gray-400 text-xs text-center">Visualization & Mapping</span>
                        </div>
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-gray-600 text-lg">arrow_forward</span>
                        </div>
                        
                        <div id="step-4-tab" class="wizard-step-tab flex flex-col items-center cursor-not-allowed py-3 border-b-2 border-transparent" data-step="4">
                            <div id="step-4-indicator" class="w-8 h-8 rounded-full bg-gray-600 text-gray-400 flex items-center justify-center text-sm font-medium mb-1">4</div>
                            <span class="text-gray-400 text-xs text-center">Filters</span>
                        </div>
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-gray-600 text-lg">arrow_forward</span>
                        </div>
                        
                        <div id="step-5-tab" class="wizard-step-tab flex flex-col items-center cursor-not-allowed py-3 border-b-2 border-transparent" data-step="5">
                            <div id="step-5-indicator" class="w-8 h-8 rounded-full bg-gray-600 text-gray-400 flex items-center justify-center text-sm font-medium mb-1">5</div>
                            <span class="text-gray-400 text-xs text-center">Access</span>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Step Content -->
            <div class="flex flex-1 overflow-hidden">
                <!-- Left Column - Step Content -->
                <div class="w-7/12 flex flex-col">
                    <div class="flex-1 overflow-y-auto">
                <!-- Step 1: General Info -->
                <div id="step-1-content" class="wizard-step-content h-full">
                    <div class="p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">General Info</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Component Name <span class="text-red-400">*</span></label>
                                <input type="text" id="component-name" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter name" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description <span class="text-red-400">*</span></label>
                                <textarea id="component-description" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" rows="3" placeholder="Enter description" required style="display: block;"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Category <span class="text-red-400">*</span></label>
                                <div class="relative">
                                    <select id="component-category" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none" required>
                                        <option value="">Select category</option>
                                        <option value="sales">Sales</option>
                                        <option value="marketing">Marketing</option>
                                        <option value="finance">Finance</option>
                                        <option value="operations">Operations</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Data Source -->
                <div id="step-2-content" class="wizard-step-content h-full hidden">
                    <!-- Sub-step 1: Select Data Source Type -->
                    <div id="data-source-substep-1" class="data-source-substep flex flex-col h-full">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Select Data Source Type</h3>
                            <div class="space-y-3">
                                <div class="data-source-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="database">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-blue-400 mr-3 text-xl">storage</span>
                                            <div>
                                                <h4 class="text-white font-medium">Database</h4>
                                                <p class="text-gray-400 text-sm">Connect to SQL, PostgreSQL, MySQL, or other databases</p>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                                
                                <div class="data-source-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="api">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-green-400 mr-3 text-xl">api</span>
                                            <div>
                                                <h4 class="text-white font-medium">API</h4>
                                                <p class="text-gray-400 text-sm">Connect to REST APIs, GraphQL, or web services</p>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                                
                                <div class="data-source-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="file">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-purple-400 mr-3 text-xl">upload_file</span>
                                            <div>
                                                <h4 class="text-white font-medium">File Upload</h4>
                                                <p class="text-gray-400 text-sm">Upload CSV, Excel, JSON, or other file formats</p>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                                
                                <div class="data-source-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="ai-model">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-orange-400 mr-3 text-xl">auto_awesome</span>
                                            <div>
                                                <h4 class="text-white font-medium">AI Model</h4>
                                                <p class="text-gray-400 text-sm">Select from available AI models for data processing</p>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sub-step 2: Configure Selected Data Source -->
                    <div id="data-source-substep-2" class="data-source-substep flex flex-col h-full hidden">
                        <div class="p-6">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Selected Data Source Type</h3>
                            <div class="flex items-center justify-between bg-gray-800 border border-gray-600 rounded-lg p-3">
                                <div class="flex items-center">
                                    <span id="selected-data-source-icon" class="material-symbols-outlined mr-3 text-xl"></span>
                                    <span id="selected-data-source-label" class="text-white font-medium"></span>
                                </div>
                                <button id="change-data-source-btn" class="text-blue-400 hover:text-blue-300 text-sm font-medium transition duration-200">
                                    Change
                                </button>
                            </div>
                        </div>
                        
                        <!-- Database Configuration -->
                        <div id="database-config" class="data-source-config px-6 pb-6 hidden">
                            <div id="database-selection-container">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Database Connection <span class="text-red-400">*</span></label>
                                <button id="select-database-btn" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 transition duration-200 text-left flex items-center">
                                    <span class="material-symbols-outlined text-xl mr-3">storage</span>
                                    <span class="text-blue-400">Select Database Connection</span>
                                </button>
                            </div>
                            
                            <div id="selected-database-display" class="hidden">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Database Connection</label>
                                <div class="flex items-center justify-between bg-gray-800 border border-gray-600 rounded-md px-3 py-2">
                                    <div class="flex items-center">
                                        <span id="selected-database-icon" class="material-symbols-outlined text-xl mr-3 text-blue-400">storage</span>
                                        <div>
                                            <div id="selected-database-name" class="text-sm text-white font-medium"></div>
                                            <div id="selected-database-details" class="text-xs text-gray-400"></div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <div id="database-connection-status" class="hidden">
                                            <div id="database-loading-status" class="flex items-center space-x-2 text-yellow-400">
                                                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-400"></div>
                                                <span class="text-sm">Connecting...</span>
                                            </div>
                                            <div id="database-success-status" class="flex items-center space-x-2 text-green-400 hidden">
                                                <span class="material-symbols-outlined text-sm">check_circle</span>
                                                <span class="text-sm">Connection established</span>
                                            </div>
                                        </div>
                                        <button id="change-database-btn" class="text-blue-400 hover:text-blue-300 text-sm font-medium transition duration-200">
                                            Change
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Query Field (appears after successful database connection) -->
                            <div id="database-query-field" class="hidden mt-6">
                                <label class="block text-sm font-medium text-gray-300 mb-2">Query <span class="text-red-400">*</span></label>
                                <div class="bg-gray-800 rounded-lg p-4 relative">
                                    <!-- Floating Controls -->
                                    <div class="absolute top-4 right-4 flex items-center space-x-4 z-10">
                                        <div class="flex items-center space-x-1">
                                            <span class="material-symbols-outlined text-gray-400 text-sm">schedule</span>
                                            <span class="text-sm text-gray-400">1 min ago</span>
                                        </div>
                                        <button class="border border-green-600 text-green-600 hover:bg-green-600 hover:text-white px-3 h-8 rounded-md text-sm font-medium transition duration-200 flex items-center">
                                            <span class="material-symbols-outlined text-md mr-1">play_arrow</span>
                                            Run Query
                                        </button>
                                        <div class="flex items-center">
                                            <button class="bg-blue-600 text-white px-3 py-1.5 text-sm transition duration-200 rounded-l-md border-r border-gray-600">SQL</button>
                                            <button class="bg-gray-700 hover:bg-gray-600 text-gray-400 px-3 py-1.5 text-sm transition duration-200 rounded-r-md">Python</button>
                                        </div>
                                    </div>
                                    <pre class="text-sm text-gray-300 font-mono">
<code>SELECT 
    g.grid_id,
    g.longitude,
    g.latitude,
    g.area_size_km2,
    p.population_count,
    p.population_count / g.area_size_km2 as population_density
FROM grid g
JOIN population_data p ON g.grid_id = p.grid_id
WHERE g.district_name = 'Abu Dhabi Island'
    AND p.date BETWEEN '2024-04-10 00:00:00' 
    AND '2024-04-12 23:59:59'
ORDER BY population_density DESC;</code></pre>
                                </div>
                                
                                <!-- Database Query Results Tabs -->
                                <div class="mt-6 mb-4">
                                    <div class="flex items-center">
                                        <button class="database-results-tab bg-blue-600 text-white px-3 py-1.5 text-sm transition duration-200 rounded-l-md border-r border-gray-600" data-database-results-tab="database-query-result">Query Result</button>
                                        <button class="database-results-tab bg-gray-700 hover:bg-gray-600 text-gray-400 px-3 py-1.5 text-sm transition duration-200 rounded-r-md" data-database-results-tab="database-datapoints-summary">Datapoints Summary</button>
                                    </div>
                                </div>
                                    
                                    <!-- Database Query Result Tab Content -->
                                    <div id="database-query-result-content" class="database-results-tab-content">
                                        <div class="bg-gray-800 rounded-lg overflow-x-auto">
                                        <table class="w-full">
                                            <thead class="border-b border-gray-700">
                                                <tr>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-300 flex items-center">
                                                        grid_id
                                                        <span class="material-symbols-outlined text-sm ml-1 text-blue-400">arrow_upward</span>
                                                    </th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">longitude</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">latitude</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">area_size_km2</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">population_count</th>
                                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-300">population_density</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-700">
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">1</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.363716</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.488927</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">11.1</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">120,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">10,810</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">2</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.369329</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.481558</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">13.4</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">100,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">7,462</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">3</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.408431</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.430092</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">35.3</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">41,696</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">1,181</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">4</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.516095</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.403521</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">20.3</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">80,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">3,940</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">5</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.578195</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.419918</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">15.8</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">60,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">3,797</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">6</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.635928</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.321339</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">18.5</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">90,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">4,864</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">7</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.502884</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.3472</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">12.3</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">110,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">8,943</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">8</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">54.588875</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.286284</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">10.8</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">50,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">4,629</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">9</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">55.765832</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.225859</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">14.5</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">70,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">4,827</td>
                                                </tr>
                                                <tr class="hover:bg-gray-700">
                                                    <td class="px-4 py-2 text-sm text-gray-300">10</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">55.704869</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">24.259183</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">19.2</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">85,000</td>
                                                    <td class="px-4 py-2 text-sm text-gray-300">4,427</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- Database Datapoints Summary Tab Content -->
                                <div id="database-datapoints-summary-content" class="database-results-tab-content hidden">
                                    <!-- GRIDS Section -->
                                    <div class="mb-6">
                                        <h3 class="text-sm font-medium text-gray-300 mb-4">GRIDS, with columns:</h3>
                                        <div class="overflow-x-auto">
                                            <div class="flex gap-4 min-w-max">
                                            <!-- grid_id -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">grid_id</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">1</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">50.5</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- longitude -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">longitude</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">54.350</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">54.449</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">54.400</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- latitude -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">latitude</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">24.450</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">24.549</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">24.500</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- area_size_km2 -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">area_size_km2</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">1</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">50.5</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- district_name -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">district_name</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">VARCHAR(255)</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">9.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">0</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">19</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">9.5</div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- POPULATION_DATA Section -->
                                    <div>
                                        <h3 class="text-sm font-medium text-gray-300 mb-4">POPULATION_DATA, with columns:</h3>
                                        <div class="overflow-x-auto">
                                            <div class="flex gap-4 min-w-max">
                                            <!-- population_id -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">population_id</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">1</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">50.5</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- population_count -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">population_count</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">41,696</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">120,000</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">80,000</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- date -->
                                            <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                <div class="text-sm font-medium text-white mb-2">date</div>
                                                <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">DATETIME</div>
                                                <div class="grid grid-cols-3 gap-4 text-xs">
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Count</div>
                                                        <div class="text-gray-300">100</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Missing</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Zeroes</div>
                                                        <div class="text-gray-300">0.0%</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Min</div>
                                                        <div class="text-gray-300">2024-04-10</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Max</div>
                                                        <div class="text-gray-300">2024-04-12</div>
                                                    </div>
                                                    <div class="space-y-1">
                                                        <div class="text-gray-400">Median</div>
                                                        <div class="text-gray-300">2024-04-11</div>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- API Configuration -->
                        <div id="api-config" class="data-source-config px-6 pb-6 hidden">
                            <div id="api-selection-container">
                                <label class="block text-sm font-medium text-gray-300 mb-2">API Connection <span class="text-red-400">*</span></label>
                                <button id="select-api-btn" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 transition duration-200 text-left flex items-center">
                                    <span class="material-symbols-outlined text-xl mr-3">api</span>
                                    <span class="text-blue-400">Select API Connection</span>
                                </button>
                            </div>
                            
                            <div id="selected-api-display" class="hidden">
                                <label class="block text-sm font-medium text-gray-300 mb-2">API Connection</label>
                                <div class="flex items-center justify-between bg-gray-800 border border-gray-600 rounded-md px-3 py-2">
                                    <div class="flex items-center">
                                        <span id="selected-api-icon" class="material-symbols-outlined text-xl mr-3 text-blue-400">api</span>
                                        <div>
                                            <div id="selected-api-name" class="text-sm text-white font-medium"></div>
                                            <div id="selected-api-details" class="text-xs text-gray-400"></div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <div id="api-connection-status" class="hidden">
                                            <div id="api-loading-status" class="flex items-center space-x-2 text-yellow-400">
                                                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-400"></div>
                                                <span class="text-sm">Connecting...</span>
                                            </div>
                                            <div id="api-success-status" class="flex items-center space-x-2 text-green-400 hidden">
                                                <span class="material-symbols-outlined text-sm">check_circle</span>
                                                <span class="text-sm">Connection established</span>
                                            </div>
                                        </div>
                                        <button id="change-api-btn" class="text-blue-400 hover:text-blue-300 text-sm font-medium transition duration-200">
                                            Change
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- API Parameters Field (appears after successful API connection) -->
                            <div id="api-parameters-field" class="hidden mt-6">
                                <label class="block text-sm font-medium text-gray-300 mb-2">API Parameters <span class="text-red-400">*</span></label>
                                <div class="bg-gray-800 rounded-lg p-4 relative">
                                    <!-- Floating Controls -->
                                    <div class="absolute top-4 right-4 flex items-center space-x-4 z-10">
                                        <div class="flex items-center space-x-1">
                                            <span class="material-symbols-outlined text-gray-400 text-sm">schedule</span>
                                            <span class="text-sm text-gray-400">1 min ago</span>
                                        </div>
                                        <button class="border border-green-600 text-green-600 hover:bg-green-600 hover:text-white px-3 h-8 rounded-md text-sm font-medium transition duration-200 flex items-center">
                                            <span class="material-symbols-outlined text-md mr-1">play_arrow</span>
                                            Make API Call
                                        </button>
                                        <div class="flex items-center">
                                            <button class="bg-blue-600 text-white px-3 py-1.5 text-sm transition duration-200 rounded-l-md border-r border-gray-600">JSON</button>
                                            <button class="bg-gray-700 hover:bg-gray-600 text-gray-400 px-3 py-1.5 text-sm transition duration-200 rounded-r-md">Form</button>
                                        </div>
                                    </div>
                                    <pre class="text-sm text-gray-300 font-mono">
<code>{
  "endpoint": "/api/weather/current",
  "method": "GET",
  "parameters": {
    "city": "Abu Dhabi",
    "country": "AE",
    "units": "metric",
    "api_key": "your_api_key_here"
  },
  "headers": {
    "Content-Type": "application/json",
    "Accept": "application/json"
  }
}</code></pre>
                                </div>
                                
                                <!-- API Call Results Tabs -->
                                <div class="mt-6 mb-4">
                                    <div class="flex items-center">
                                        <button class="api-results-tab bg-blue-600 text-white px-3 py-1.5 text-sm transition duration-200 rounded-l-md border-r border-gray-600" data-api-results-tab="api-call-result">API Call Results</button>
                                        <button class="api-results-tab bg-gray-700 hover:bg-gray-600 text-gray-400 px-3 py-1.5 text-sm transition duration-200 rounded-r-md" data-api-results-tab="api-datapoints-summary">Datapoints Summary</button>
                                    </div>
                                </div>
                                    
                                    <!-- API Call Result Tab Content -->
                                    <div id="api-call-result-content" class="api-results-tab-content">
                                        <div class="bg-gray-800 rounded-lg p-4">
                                            <pre class="text-sm text-gray-300 font-mono overflow-x-auto">
<code>{
  "coord": {
    "lon": 54.3773,
    "lat": 24.4539
  },
  "weather": [
    {
      "id": 800,
      "main": "Clear",
      "description": "clear sky",
      "icon": "01d"
    }
  ],
  "base": "stations",
  "main": {
    "temp": 32.5,
    "feels_like": 35.2,
    "temp_min": 30.1,
    "temp_max": 34.8,
    "pressure": 1012,
    "humidity": 65
  },
  "visibility": 10000,
  "wind": {
    "speed": 3.6,
    "deg": 280
  },
  "clouds": {
    "all": 0
  },
  "dt": 1640995200,
  "sys": {
    "type": 2,
    "id": 2007,
    "country": "AE",
    "sunrise": 1640956800,
    "sunset": 1640995200
  },
  "timezone": 14400,
  "id": 292968,
  "name": "Abu Dhabi",
  "cod": 200
}</code></pre>
                                        </div>
                                    </div>
                                    
                                    <!-- API Datapoints Summary Tab Content -->
                                    <div id="api-datapoints-summary-content" class="api-results-tab-content hidden">
                                        <!-- Weather Data Section -->
                                        <div class="mb-6">
                                            <h3 class="text-sm font-medium text-gray-300 mb-4">Weather Data, with fields:</h3>
                                            <div class="overflow-x-auto">
                                                <div class="flex gap-4 min-w-max">
                                                <!-- temperature -->
                                                <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                    <div class="text-sm font-medium text-white mb-2">temperature</div>
                                                    <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                    <div class="grid grid-cols-3 gap-4 text-xs">
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Count</div>
                                                            <div class="text-gray-300">1</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Missing</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Zeroes</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Min</div>
                                                            <div class="text-gray-300">32.5</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Max</div>
                                                            <div class="text-gray-300">32.5</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Mean</div>
                                                            <div class="text-gray-300">32.5</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- humidity -->
                                                <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                    <div class="text-sm font-medium text-white mb-2">humidity</div>
                                                    <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">INT</div>
                                                    <div class="grid grid-cols-3 gap-4 text-xs">
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Count</div>
                                                            <div class="text-gray-300">1</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Missing</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Zeroes</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Min</div>
                                                            <div class="text-gray-300">65</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Max</div>
                                                            <div class="text-gray-300">65</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Mean</div>
                                                            <div class="text-gray-300">65</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- wind_speed -->
                                                <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                    <div class="text-sm font-medium text-white mb-2">wind_speed</div>
                                                    <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">FLOAT</div>
                                                    <div class="grid grid-cols-3 gap-4 text-xs">
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Count</div>
                                                            <div class="text-gray-300">1</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Missing</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Zeroes</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Min</div>
                                                            <div class="text-gray-300">3.6</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Max</div>
                                                            <div class="text-gray-300">3.6</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Mean</div>
                                                            <div class="text-gray-300">3.6</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- weather_condition -->
                                                <div class="bg-gray-800 rounded-lg p-4 w-64">
                                                    <div class="text-sm font-medium text-white mb-2">weather_condition</div>
                                                    <div class="inline-block bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-full mb-3">STRING</div>
                                                    <div class="grid grid-cols-3 gap-4 text-xs">
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Count</div>
                                                            <div class="text-gray-300">1</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Missing</div>
                                                            <div class="text-gray-300">0.0%</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Unique</div>
                                                            <div class="text-gray-300">1</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Top Value</div>
                                                            <div class="text-gray-300">Clear</div>
                                                        </div>
                                                        <div class="space-y-1">
                                                            <div class="text-gray-400">Top Freq</div>
                                                            <div class="text-gray-300">100%</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- File Upload Configuration -->
                        <div id="file-config" class="data-source-config hidden">
                            <div class="px-6 pb-6 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Upload File <span class="text-red-400">*</span></label>
                                    <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center hover:border-gray-500 transition duration-200">
                                        <span class="material-symbols-outlined text-gray-400 text-3xl mb-2">cloud_upload</span>
                                        <p class="text-gray-400 mb-4">Drag and drop your file here, or</p>
                                        <div class="flex justify-center">
                                            <button type="button" class="flex items-center space-x-2 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white hover:bg-gray-700 transition duration-200 h-[38px]">
                                                <span class="material-symbols-outlined text-lg">add</span>
                                                <span class="text-sm">Select File</span>
                                            </button>
                                        </div>
                                        <p class="text-gray-500 text-sm mt-4">Maximum file size: 20MB</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Model Configuration -->
                        <div id="ai-model-config" class="data-source-config px-6 pb-6 hidden">
                            <div id="ai-model-selection-container">
                                <label class="block text-sm font-medium text-gray-300 mb-2">AI Model <span class="text-red-400">*</span></label>
                                <button id="select-ai-model-btn" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-gray-400 hover:bg-gray-700 transition duration-200 text-left flex items-center">
                                    <span class="material-symbols-outlined text-xl mr-3">auto_awesome</span>
                                    <span class="text-blue-400">Select AI Model</span>
                                </button>
                            </div>
                            
                            <div id="selected-ai-model-display" class="hidden">
                                <label class="block text-sm font-medium text-gray-300 mb-2">AI Model</label>
                                <div class="flex items-center justify-between bg-gray-800 border border-gray-600 rounded-md px-3 py-2">
                                    <div class="flex items-center">
                                        <span id="selected-ai-model-icon" class="material-symbols-outlined text-xl mr-3 text-blue-400">auto_awesome</span>
                                        <div>
                                            <div id="selected-ai-model-name" class="text-sm text-white font-medium"></div>
                                            <div id="selected-ai-model-description" class="text-xs text-gray-400"></div>
                                        </div>
                                    </div>
                                    <button id="change-ai-model-btn" class="text-blue-400 hover:text-blue-300 text-sm font-medium transition duration-200">
                                        Change
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Visualization -->
                <div id="step-3-content" class="wizard-step-content h-full hidden">
                    <!-- Sub-step 1: Select Visualization Type -->
                    <div id="visualization-substep-1" class="visualization-substep flex flex-col h-full">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Select Visualization Type</h3>
                            <div class="space-y-3">
                                <div class="visualization-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="chart">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-xl mr-3 text-blue-400">bar_chart</span>
                                            <div>
                                                <div class="text-white font-medium">Chart</div>
                                                <div class="text-gray-400 text-sm">Bar, Line, Area, Scatter, Donut, Radial</div>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                                
                                <div class="visualization-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="map-layer">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-xl mr-3 text-green-400">map</span>
                                            <div>
                                                <div class="text-white font-medium">Map Layer</div>
                                                <div class="text-gray-400 text-sm">Heatmap, Area, Disc, Pillar, Arcs</div>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                                
                                <div class="visualization-option bg-gray-800 border border-gray-600 rounded-lg p-4 hover:bg-gray-700 transition duration-200 cursor-pointer" data-type="kpi">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <span class="material-symbols-outlined text-xl mr-3 text-purple-400">monitoring</span>
                                            <div>
                                                <div class="text-white font-medium">KPI</div>
                                                <div class="text-gray-400 text-sm">Key Performance Indicators</div>
                                            </div>
                                        </div>
                                        <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sub-step 2: Configure Selected Visualization Type -->
                    <div id="visualization-substep-2" class="visualization-substep flex flex-col h-full hidden">
                        <div class="p-6">
                            <h3 class="text-sm font-medium text-gray-400 mb-2">Selected Visualization Type</h3>
                            <div class="flex items-center justify-between bg-gray-800 border border-gray-600 rounded-lg p-3">
                                <div class="flex items-center">
                                    <span id="selected-visualization-icon" class="material-symbols-outlined mr-3 text-xl"></span>
                                    <span id="selected-visualization-label" class="text-white font-medium"></span>
                                </div>
                                <button id="change-visualization-btn" class="text-blue-400 hover:text-blue-300 text-sm font-medium transition duration-200">
                                    Change
                                </button>
                            </div>
                        </div>
                        
                        <!-- Chart Configuration -->
                        <div id="chart-config" class="visualization-config px-6 pb-6 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Chart Subtype <span class="text-red-400">*</span></label>
                                <div class="relative">
                                    <select id="chart-subtype" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                        <option value="">Select chart subtype</option>
                                        <option value="horizontal-bar">Horizontal Bar</option>
                                        <option value="vertical-bar">Vertical Bar</option>
                                        <option value="line">Line</option>
                                        <option value="area">Area</option>
                                        <option value="scatter-plot">Scatter Plot</option>
                                        <option value="donut">Donut</option>
                                        <option value="radial">Radial</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Map Layer Configuration -->
                        <div id="map-layer-config" class="visualization-config px-6 pb-6 hidden">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Map Layer Subtype <span class="text-red-400">*</span></label>
                                <div class="relative">
                                    <select id="map-layer-subtype" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                        <option value="">Select map layer subtype</option>
                                        <option value="heatmap">Heatmap</option>
                                        <option value="area">Area</option>
                                        <option value="disc">Disc</option>
                                        <option value="pillar">Pillar</option>
                                        <option value="arcs">Arcs</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                        <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- KPI Configuration (no subtype needed) -->
                        <div id="kpi-config" class="visualization-config px-6 pb-6 hidden">
                            <div class="text-center py-8">
                                <span class="material-symbols-outlined text-purple-400 text-4xl mb-4">monitoring</span>
                                <p class="text-gray-400 text-sm">KPI visualization selected. No additional configuration needed.</p>
                            </div>
                        </div>
                        
                        <!-- Data Mapping Configuration (appears after subtype selection) -->
                        <div id="data-mapping-config" class="visualization-config px-6 pb-6 hidden">
                            <div>
                                <h4 class="text-md font-medium text-white mb-4">Mapping & Customization</h4>
                                <div id="data-mapping-fields" class="space-y-4">
                                    <!-- Dynamic fields will be populated here based on visualization type/subtype -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Step 4: Configuration -->
                <div id="step-4-content" class="wizard-step-content h-full hidden">
                    <div class="p-6">
                        <div class="space-y-6">
                            <!-- Create the Add Filter field structure -->
                            <div class="relative">
                                <!-- Header with label and remove all button -->
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-lg font-semibold text-white">Filters</label>
                                    <button id="filter-field-remove-all" class="text-red-400 hover:text-red-300 text-xs font-medium transition duration-200 hidden">
                                        Remove All
                                    </button>
                                </div>
                                
                                <!-- Filter list container -->
                                <div id="filter-field-list" class="space-y-2 mb-3">
                                    <!-- Dynamic filter items will be added here -->
                                </div>
                                
                                <!-- Add Filter dropdown button -->
                                <button id="filter-field-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-md transition duration-200 flex items-center space-x-2 text-sm">
                                    <span class="material-symbols-outlined">add</span>
                                    <span>Add Filter</span>
                                </button>
                                
                                <!-- Dropdown container -->
                                <div id="filter-field-dropdown" class="absolute z-50 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto hidden mt-2" style="width: 100%; max-width: 400px;">
                                    <!-- Dynamic filter options will be added here -->
                                </div>
                                
                                <script>
                                    // Initialize filter functionality when step 4 is shown
                                    document.addEventListener('DOMContentLoaded', function() {
                                        const filterBtn = document.getElementById('filter-field-btn');
                                        const filterDropdown = document.getElementById('filter-field-dropdown');
                                        const removeAllBtn = document.getElementById('filter-field-remove-all');
                                        
                                        if (filterBtn && filterDropdown) {
                                            // Store filter options with rich metadata
                                            const filterOptions = [
                                                {
                                                    id: 'date_range_filter',
                                                    name: 'Date Range Filter',
                                                    type: 'DateRange',
                                                    icon: 'date_range',
                                                    namespace: 'date_range_filter',
                                                    description: 'Allows users to select date ranges for filtering data across time periods.'
                                                },
                                                {
                                                    id: 'location_filter',
                                                    name: 'Location Filter',
                                                    type: 'Lookup',
                                                    icon: 'location_on',
                                                    namespace: 'location_filter',
                                                    description: 'Filter data based on geographic location and coordinates.'
                                                },
                                                {
                                                    id: 'category_filter',
                                                    name: 'Category Filter',
                                                    type: 'Dropdown',
                                                    icon: 'category',
                                                    namespace: 'category_filter',
                                                    description: 'Filter data by predefined categories and classifications.'
                                                },
                                                {
                                                    id: 'range_slider_filter',
                                                    name: 'Range Slider Filter',
                                                    type: 'Slider',
                                                    icon: 'tune',
                                                    namespace: 'range_slider_filter',
                                                    description: 'Filter data using a range slider for numeric values.'
                                                },
                                                {
                                                    id: 'user_filter',
                                                    name: 'User Filter',
                                                    type: 'Text',
                                                    icon: 'person',
                                                    namespace: 'user_filter',
                                                    description: 'Filter data based on user input and text search.'
                                                }
                                            ];
                                            filterDropdown.dataset.options = JSON.stringify(filterOptions);
                                            
                                            // Add click event to filter button
                                            filterBtn.addEventListener('click', function(e) {
                                                e.stopPropagation();
                                                toggleFilterDropdown('filter-field');
                                            });
                                            
                                            // Add click event to remove all button
                                            if (removeAllBtn) {
                                                                                            removeAllBtn.addEventListener('click', function() {
                                                selectedFilterFields = [];
                                                updateFilterList();
                                                validateStep4Fields();
                                                updateWizardState();
                                            });
                                            }
                                        }
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Access -->
                <div id="step-5-content" class="wizard-step-content h-full hidden">
                    <div class="p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Access</h3>
                        <div class="space-y-4">
                            <!-- Planning Section -->
                            <div>
                                <h3 class="text-sm font-medium text-gray-300 mb-3">Planning</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=JD" alt="">
                                            <div>
                                                <div class="text-sm font-medium text-white flex items-center space-x-2">
                                                    <span>John Doe</span>
                                                    <span class="text-xs bg-gray-900 text-gray-300 px-2 py-1 rounded">Admin</span>
                                                </div>
                                                <div class="text-xs text-gray-400">john.doe@company.com</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-gray-400">Full access</span>
                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=JS" alt="">
                                            <div>
                                                <div class="text-sm font-medium text-white">Jane Smith</div>
                                                <div class="text-xs text-gray-400">jane.smith@company.com</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-gray-400">Limited access</span>
                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Chairman Office Section -->
                            <div>
                                <h3 class="text-sm font-medium text-gray-300 mb-3">Chairman Office</h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=MB" alt="">
                                            <div>
                                                <div class="text-sm font-medium text-white">Mike Brown</div>
                                                <div class="text-xs text-gray-400">mike.brown@company.com</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-gray-400">Limited access</span>
                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/555/fff?text=SW" alt="">
                                            <div>
                                                <div class="text-sm font-medium text-white">Sarah Wilson</div>
                                                <div class="text-xs text-gray-400">sarah.wilson@company.com</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-gray-400">View only</span>
                                            <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                </div>

                <!-- Right Column - Component Preview -->
                <div class="w-5/12 bg-gray-800 p-6">
                    <h3 class="text-md font-semibold text-white mb-4">Component Preview</h3>
                    <div class="bg-gray-700 rounded-lg p-4">
                        <div class="h-48 relative">
                            <svg class="w-full h-full" viewBox="0 0 200 100">
                                <path d="M0,80 L50,20 L100,70 L150,30 L200,60" stroke="#14b8a6" stroke-width="2" fill="none"/>
                                <circle cx="50" cy="20" r="2" fill="#14b8a6"/>
                                <circle cx="100" cy="70" r="2" fill="#14b8a6"/>
                                <circle cx="150" cy="30" r="2" fill="#14b8a6"/>
                                <circle cx="200" cy="60" r="2" fill="#14b8a6"/>
                            </svg>
                            <div class="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-gray-400">
                                <span>12:00 am</span>
                                <span>6:00 am</span>
                                <span>12:00 pm</span>
                                <span>6:00 pm</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex items-center justify-between">
                    <button id="prev-step-btn" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        Previous
                    </button>
                    <div class="flex items-center space-x-3">
                        <button id="next-step-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200">
                            Next
                        </button>
                        <button id="finish-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition duration-200 hidden">
                            Create Component
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Model Selection Modal -->
    <div id="ai-model-selection-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-5/6 max-w-4xl flex flex-col">
            <!-- Modal Header -->
            <div class="py-4 px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-white">Select AI Model</h2>
                    <button id="close-ai-model-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-hidden flex flex-col">
                <!-- Search and Filter Bar -->
                <div class="p-6 border-b border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="flex-1 relative">
                            <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg">search</span>
                            <input type="text" id="ai-model-modal-search" class="w-full bg-gray-800 border border-gray-600 rounded-md pl-10 pr-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Search AI models...">
                        </div>
                        <div class="relative">
                            <button id="ai-model-modal-filter-btn" class="flex items-center space-x-2 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white hover:bg-gray-700 transition duration-200 h-[38px]">
                                <span class="material-symbols-outlined text-lg">filter_list</span>
                                <span class="text-sm">Filter</span>
                            </button>
                            <div id="ai-model-modal-filter-dropdown" class="bg-gray-800 border border-gray-600 rounded-md shadow-lg hidden min-w-48 max-h-80 overflow-auto">
                                <div class="p-3 space-y-2">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-400 mb-2">Model Type</label>
                                        <div class="space-y-1">
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="predictive"> Predictive
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="nlp"> NLP
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="simulation"> Simulation
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="optimization"> Optimization
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="anomaly"> Anomaly Detection
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="diagnostic"> Diagnostic
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="computer-vision"> Computer Vision
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="analytics"> Analytics
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-400 mb-2">Industry</label>
                                        <div class="space-y-1">
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="utility"> Utility
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="retail"> Retail
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="municipal"> Municipal
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="logistics"> Logistics
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="finance"> Finance
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="agriculture"> Agriculture
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="healthcare"> Healthcare
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="manufacturing"> Manufacturing
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="real-estate"> Real Estate
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="telecom"> Telecom
                                            </label>
                                            <label class="flex items-center text-sm">
                                                <input type="checkbox" class="mr-2" data-filter="insurance"> Insurance
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Models List -->
                <div class="flex-1 overflow-y-auto p-6">
                    <div id="ai-model-modal-list" class="space-y-2 user-select-none">
                        <!-- AI Model items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex items-center justify-end space-x-3">
                    <button id="cancel-ai-model-selection" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200">
                        Cancel
                    </button>
                    <button id="confirm-ai-model-selection" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Select Model
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Selection Modal -->
    <div id="database-selection-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-5/6 max-w-4xl flex flex-col">
            <!-- Modal Header -->
            <div class="py-4 px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-white">Select Database Connection</h2>
                    <button id="close-database-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-hidden flex flex-col">
                <!-- Header with Create Button -->
                <div class="p-6 border-b border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="flex-1 relative">
                                    <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg">search</span>
                                    <input type="text" id="database-modal-search" class="w-full bg-gray-800 border border-gray-600 rounded-md pl-10 pr-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Search database connections...">
                                </div>
                                <div class="relative">
                                    <button id="database-modal-filter-btn" class="flex items-center space-x-2 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white hover:bg-gray-700 transition duration-200 h-[38px]">
                                        <span class="material-symbols-outlined text-lg">filter_list</span>
                                        <span class="text-sm">Filter</span>
                                    </button>
                                    <div id="database-modal-filter-dropdown" class="bg-gray-800 border border-gray-600 rounded-md shadow-lg hidden min-w-48 max-h-80 overflow-auto">
                                        <div class="p-3 space-y-2">
                                            <div>
                                                <label class="block text-xs font-medium text-gray-400 mb-2">Database Type</label>
                                                <div class="space-y-1">
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="mysql"> MySQL
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="postgresql"> PostgreSQL
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="sqlserver"> SQL Server
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="oracle"> Oracle
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="sqlite"> SQLite
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button id="create-database-btn" class="flex items-center space-x-2 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white hover:bg-gray-700 transition duration-200 h-[38px] ml-4">
                            <span class="material-symbols-outlined text-lg">add</span>
                            <span class="text-sm">New Connection</span>
                        </button>
                    </div>
                </div>

                <!-- Database Connections List -->
                <div class="flex-1 overflow-y-auto p-6">
                    <div id="database-modal-list" class="space-y-2 user-select-none">
                        <!-- Database connection items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex items-center justify-end space-x-3">
                    <button id="cancel-database-selection" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200">
                        Cancel
                    </button>
                    <button id="confirm-database-selection" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Select Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Database Modal -->
    <div id="create-database-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-4/6 max-w-2xl flex flex-col">
            <!-- Modal Header -->
            <div class="py-4 px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-white">Create Database Connection</h2>
                    <button id="close-create-database-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Connection Name <span class="text-red-400">*</span></label>
                        <input type="text" id="new-database-name" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter connection name" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Database Type <span class="text-red-400">*</span></label>
                        <div class="relative">
                            <select id="new-database-type" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none" required>
                                <option value="">Select database type</option>
                                <option value="mysql">MySQL</option>
                                <option value="postgresql">PostgreSQL</option>
                                <option value="sqlserver">SQL Server</option>
                                <option value="oracle">Oracle</option>
                                <option value="sqlite">SQLite</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Host <span class="text-red-400">*</span></label>
                        <input type="text" id="new-database-host" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="localhost" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Port <span class="text-red-400">*</span></label>
                        <input type="number" id="new-database-port" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="3306" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Database Name <span class="text-red-400">*</span></label>
                        <input type="text" id="new-database-dbname" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter database name" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Username <span class="text-red-400">*</span></label>
                        <input type="text" id="new-database-username" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter username" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Password <span class="text-red-400">*</span></label>
                        <input type="password" id="new-database-password" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter password" required>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex items-center justify-end space-x-3">
                    <button id="cancel-create-database" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200">
                        Cancel
                    </button>
                    <button id="confirm-create-database" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200">
                        Create Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Selection Modal -->
    <div id="api-selection-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-5/6 max-w-4xl flex flex-col">
            <!-- Modal Header -->
            <div class="py-4 px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-white">Select API Connection</h2>
                    <button id="close-api-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-hidden flex flex-col">
                <!-- Header with Create Button -->
                <div class="p-6 border-b border-gray-700">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3">
                                <div class="flex-1 relative">
                                    <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg">search</span>
                                    <input type="text" id="api-modal-search" class="w-full bg-gray-800 border border-gray-600 rounded-md pl-10 pr-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Search API connections...">
                                </div>
                                <div class="relative">
                                    <button id="api-modal-filter-btn" class="flex items-center space-x-2 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white hover:bg-gray-700 transition duration-200 h-[38px]">
                                        <span class="material-symbols-outlined text-lg">filter_list</span>
                                        <span class="text-sm">Filter</span>
                                    </button>
                                    <div id="api-modal-filter-dropdown" class="bg-gray-800 border border-gray-600 rounded-md shadow-lg hidden min-w-48 max-h-80 overflow-auto">
                                        <div class="p-3 space-y-2">
                                            <div>
                                                <label class="block text-xs font-medium text-gray-400 mb-2">Authentication</label>
                                                <div class="space-y-1">
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="none"> No Authentication
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="bearer"> Bearer Token
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="basic"> Basic Auth
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="api-key"> API Key
                                                    </label>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-gray-400 mb-2">Method</label>
                                                <div class="space-y-1">
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="GET"> GET
                                                    </label>
                                                    <label class="flex items-center text-sm">
                                                        <input type="checkbox" class="mr-2" data-filter="POST"> POST
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button id="create-api-btn" class="flex items-center space-x-2 bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-white hover:bg-gray-700 transition duration-200 h-[38px] ml-4">
                            <span class="material-symbols-outlined text-lg">add</span>
                            <span class="text-sm">New Connection</span>
                        </button>
                    </div>
                </div>

                <!-- API Connections List -->
                <div class="flex-1 overflow-y-auto p-6">
                    <div id="api-modal-list" class="space-y-2 user-select-none">
                        <!-- API connection items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex items-center justify-end space-x-3">
                    <button id="cancel-api-selection" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200">
                        Cancel
                    </button>
                    <button id="confirm-api-selection" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Select Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create API Modal -->
    <div id="create-api-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-900 rounded-lg shadow-xl w-11/12 h-4/6 max-w-2xl flex flex-col">
            <!-- Modal Header -->
            <div class="py-4 px-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-white">Create API Connection</h2>
                    <button id="close-create-api-modal" class="flex items-center text-gray-400 hover:text-white transition duration-200">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Connection Name <span class="text-red-400">*</span></label>
                        <input type="text" id="new-api-name" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter connection name" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">API URL <span class="text-red-400">*</span></label>
                        <input type="url" id="new-api-url" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="https://api.example.com/data" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Authentication Method</label>
                        <div class="relative">
                            <select id="new-api-auth-method" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="none">No Authentication</option>
                                <option value="bearer">Bearer Token</option>
                                <option value="basic">Basic Auth</option>
                                <option value="api-key">API Key</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                    <div id="new-api-auth-fields" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">API Key/Token</label>
                            <input type="password" id="new-api-token" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter API key or token">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Request Method</label>
                        <div class="relative">
                            <select id="new-api-method" class="w-full bg-gray-800 border border-gray-600 rounded-md px-3 py-2 pr-8 text-sm text-white focus:outline-none focus:ring-2 focus:ring-red-500 appearance-none">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <span class="material-symbols-outlined text-gray-400 text-md">expand_more</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-700">
                <div class="flex items-center justify-end space-x-3">
                    <button id="cancel-create-api" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200">
                        Cancel
                    </button>
                    <button id="confirm-create-api" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200">
                        Create Connection
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html> 